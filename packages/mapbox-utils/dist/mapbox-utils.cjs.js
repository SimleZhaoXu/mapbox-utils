"use strict";var t=require("mapbox-gl"),e=require("@turf/turf"),i=require("nanoid");function o(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var r=o(e),n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)};function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var a,h=function(){return h=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},h.apply(this,arguments)};function l(t,e,i){if(i||2===arguments.length)for(var o,r=0,n=e.length;r<n;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var u="[object Array]",p="[object Function]",c="[object Map]",_="[object Set]",d="[object Date]",g="[object RegExp]",f=((a={})["[object Object]"]=function(t,e){return Object.keys(e).forEach((function(i){return t[i]=v(e[i])})),t},a[u]=function(t,e){return e.forEach((function(e){return t.push(v(e))})),t},a[c]=function(t,e){return e.forEach((function(e,i){return t.set(i,v(e))})),t},a[_]=function(t,e){return e.forEach((function(e){return t.add(v(e))})),t},a[p]=function(t,e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.call.apply(e,l([this],t,!1))}},a[d]=function(t,e){return new Date(e)},a[g]=function(t,e){return new RegExp(e.source,e.flags)},a),y=new WeakMap;function v(t){var e;if(!(t instanceof Object))return t;if(y.has(t))return y.get(t);var i=function(t){var e=t.constructor;return new e}(t);return y.set(t,i),i=(null!==(e=f[function(t){return Object.prototype.toString.call(t)}(t)])&&void 0!==e?e:function(){return t})(i,t)}function m(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var L={"circle-color":"#fff","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#44cef6"},b={"line-width":2,"line-color":"#44cef6","line-opacity":.5,"line-dasharray":[5,3]},k={"fill-color":"#44cef6","fill-opacity":.2},x=["default","crosshair","pointer","move","e-resize","ne-resize","nw-resize","n-resize","se-resize","sw-resize","s-resize","w-resize","text","wait","help"],M=function(){function t(t){var e;this._id=null!==(e=t.id)&&void 0!==e?e:i.nanoid(),this._type=t.type,this._layerId="".concat(this._type,"-").concat(this._id),this._data=t.data,this._paint=t.paint,this._layout=t.layout,this._layerCursor=t.layerCursor&&x.includes(t.layerCursor)?t.layerCursor:void 0,this._mapCursor=t.mapCursor&&x.includes(t.mapCursor)?t.mapCursor:void 0,m(["_onMouseEnter","_onMouseLeave","_onData"],this)}return Object.defineProperty(t.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),t.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this.on("mouseenter",this._onMouseEnter),this.on("mouseleave",this._onMouseLeave),this._map.on("data",this._onData)),this},t.prototype.remove=function(){return this._map&&(this._removeLayerAndSource(),this.off("mouseenter",this._onMouseEnter),this.off("mouseleave",this._onMouseLeave),this._map.off("data",this._onData),this._map=void 0),this},t.prototype.setData=function(t){if(this._data=t,this._map){var e=this._map.getSource(this._layerId);null==e||e.setData(t)}return this},t.prototype.on=function(t,e){var i;return null===(i=this._map)||void 0===i||i.on(t,this._layerId,e),this},t.prototype.off=function(t,e){var i;return null===(i=this._map)||void 0===i||i.off(t,this._layerId,e),this},t.prototype.setStyle=function(t){var e=this,i=t.paint,o=t.layout;i&&(this._paint=h(h({},this._paint),i),this._map&&Object.keys(i).forEach((function(t){e._map.setPaintProperty(e._layerId,t,i[t])})));o&&(this._layout=h(h({},this._layout),o),this._map&&Object.keys(o).forEach((function(t){e._map.setLayoutProperty(e._layerId,t,o[t])})));return this},t.prototype.querySourceFeature=function(t){var e;return null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,h(h({},t||{}),{sourceLayer:this._layerId}))},t.prototype.queryFeatureFormData=function(t,e){var i,o=void 0;return this._data?"FeatureCollection"===this._data.type?this._data.features.find((function(i){var o;return(null===(o=i.properties)||void 0===o?void 0:o[t])===e})):("Feature"===this._data.type&&(null===(i=this._data.properties)||void 0===i?void 0:i[t])===e&&(o=r.clone(this._data)),o):o},t.prototype.getSource=function(){var t;return null===(t=this._map)||void 0===t?void 0:t.getSource(this._layerId)},t.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:this._type,source:{type:"geojson",data:null!==(t=this._data)&&void 0!==t?t:r.featureCollection([])},layout:this._layout||{},paint:this._paint||{}}))},t.prototype._onMouseEnter=function(t){this._layerCursor&&(t.target.getCanvas().style.cursor=this._layerCursor)},t.prototype._onMouseLeave=function(t){var e;this._layerCursor&&(t.target.getCanvas().style.cursor=null!==(e=this._mapCursor)&&void 0!==e?e:"")},t.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},t.prototype._removeLayerAndSource=function(){var t,e;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getSource(this._layerId))&&this._map.removeSource(this._layerId)},t}(),P=["line-color","line-width","line-blur","line-opacity","line-pattern","line-gap-width","line-offset","line-dasharray","line-gradient","line-translate","line-translate-anchor"],O=["line-cap","line-join","line-miter-limit","line-round-limit"],C=["circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity"],S=["symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],E=["icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],B=["text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],F=["text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],D=["fill-extrusion-opacity","fill-extrusion-pattern","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient"],T={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},H=function(e){function o(t){var o,r,n=e.call(this)||this;return n._lngLatBounds=null,n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._key=null!==(o=t.key)&&void 0!==o?o:"id",n._id=i.nanoid(),n._layer=new M({id:"circle-point-layer-".concat(n._id),type:"circle",layerCursor:"pointer",data:t.data,paint:n._getPaint(t.style),layout:{visibility:"visible"}}),n._fitBoundsOptions=n._getFitBoundsOptions(t.fitBoundsOptions),n._setLngLatBounds(t.data),n._highlightTrigger=null===(r=t.highlightOptions)||void 0===r?void 0:r.trigger,t.highlightOptions&&n._initHighlight(t.style,t.highlightOptions.style),m(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(T).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:T[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){C.includes(i)&&(e[i]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){return{data:h({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o=this,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",h(h({},this._getPoint(r)),{originalMapEvent:t,points:null===(i=t.features)||void 0===i?void 0:i.map((function(t){return o._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var n=r.properties[this._key];this._clickHighlightPropVal!==n&&(this._clickHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",h(h({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",h(h({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=l(["case",t],i,!0)})),i["circle-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),w={"icon-image":"","icon-size":1,"text-field":"","text-size":16},j={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},V=function(e){function o(t){var o,r,n=e.call(this)||this;return n._layoutStyleMap=new Map,n._paintStyleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=i.nanoid(),n._layer=new M(h({id:"symbol-point-".concat(n._id),type:"symbol",layerCursor:"pointer",data:t.data},n._getStyle(t.style))),n._key=null!==(o=t.key)&&void 0!==o?o:"id",n._fitBoundsOptions=n._getFitBoundsOptions(t.fitBoundsOptions),n._setLngLatBounds(t.data),n._highlightTrigger=null===(r=t.highlightOptions)||void 0===r?void 0:r.trigger,t.highlightOptions&&n._initHighlight(t.style,t.highlightOptions.style),m(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(w).forEach((function(o){var r,n=e[o];void 0!==n&&i._layoutStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:w[o]])})),Object.keys(j).forEach((function(o){var r,n=e[o];void 0!==n&&i._paintStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:j[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){S.includes(o)?i[o]=t[o]:E.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){return{data:h({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i=this,o=t.features[0];if(this.fire("click",h(h({},this._getPoint(o)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return i._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var r=o.properties[this._key];this._clickHighlightPropVal!==r&&(this._clickHighlightPropVal=r,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",h(h({},this._getPoint(i)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var o=t.features[0].properties[this._key];this._hoverHighlightPropVal!==o&&(this._hoverHighlightPropVal=o,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",h(h({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._paintStyleMap.forEach((function(i,o){e[o]=l(["case",t],i,!0)})),this._layoutStyleMap.forEach((function(e,o){i[o]=l(["case",t],e,!0)})),i["symbol-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),I=function(e){function i(t){var i,o=e.call(this)||this;return o._key=null!==(i=t.key)&&void 0!==i?i:"id",o._data=t.data,o._fitBoundsOptions=o._getFitBoundsOptions(t.fitBoundsOptions),o._setLngLatBounds(t.data),o._markerOptions=t.markerOptions?h(h({},t.markerOptions),{draggable:!1}):{},o._markerMap=new Map,o._init(),o}return s(i,e),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){var e=this;return t===this._map||(this.remove(),this._map=t,this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._markerMap.forEach((function(t){t.remove()})),this._map=void 0),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.setData=function(t){var e=this;return this._data=t,this._setLngLatBounds(t),this._clear(),this._init(),this._map&&(this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},i.prototype._clear=function(){this._markerMap.forEach((function(t){t.remove()})),this._markerMap.clear()},i.prototype._getFeature=function(t){var e=this;return this._data.features.find((function(i){var o;return(null===(o=i.properties)||void 0===o?void 0:o[e._key])===t}))},i.prototype._getElement=function(t,e){return"function"==typeof t?t(e):t.cloneNode(!0)},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:void 0},i.prototype._init=function(){var e=this;this._data.features.forEach((function(i){var o,r,n=h(h({},e._markerOptions),{element:(null===(o=e._markerOptions)||void 0===o?void 0:o.element)?e._getElement(e._markerOptions.element,i.properties):void 0}),s=new t.Marker(n).setLngLat(i.geometry.coordinates);e._setMarkerEvent(s,i.properties),e._markerMap.set(null===(r=i.properties)||void 0===r?void 0:r[e._key],s)}))},i.prototype._setMarkerEvent=function(t,e){var i=this,o=t.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i.fire("click",{lngLat:t.getLngLat(),data:JSON.parse(JSON.stringify(e))}),o.stopPropagation()}))},i}(t.Evented),A={"line-color":"#000000","line-width":1,"line-blur":0,"line-opacity":1,"line-gap-width":0},R=function(e){function o(t){var o,r,n=e.call(this)||this;return n._lngLatBounds=null,n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._key=null!==(o=t.key)&&void 0!==o?o:"id",n._id=i.nanoid(),n._layer=new M(h({id:"line-layer-".concat(n._id),type:"line",layerCursor:"pointer",data:t.data},n._getStyle(t.style))),n._fitBoundsOptions=n._getFitBoundsOptions(t.fitBoundsOptions),n._setLngLatBounds(t.data),n._highlightTrigger=null===(r=t.highlightOptions)||void 0===r?void 0:r.trigger,t.highlightOptions&&n._initHighlight(t.style,t.highlightOptions.style),m(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.fitTo=function(e,i){if(!this._map)return this;var o=this._getFeature(e);o&&this._map.fitBounds(new t.LngLatBounds(r.bboxPolygon(r.bbox(o)).bbox),i||{})},o.prototype.easeTo=function(e,i){if(!this._map)return this;var o=this._getFeature(e);if(o){var n=r.getCoord(r.centroid(o)),s=new t.LngLat(n[0],n[1]);this._map.easeTo(h(h({},i),{center:s}))}return this},o.prototype.flyTo=function(e,i){if(!this._map)return this;var o=this._getFeature(e);if(o){var n=r.getCoord(r.centroid(o)),s=new t.LngLat(n[0],n[1]);this._map.flyTo(h(h({},i||{}),{center:s}))}return this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){return this._layer.queryFeatureFormData(this._key,t)},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(A).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:A[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){O.includes(o)?i[o]=t[o]:P.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._onClick=function(e){var i,o=null===(i=e.features)||void 0===i?void 0:i[0],n=this._getFeature(o.properties[this._key]),s=r.getCoord(r.centroid(n)),a=new t.LngLat(s[0],s[1]),l=r.bboxPolygon(r.bbox(n)).bbox;if(this.fire("click",{center:a,data:h({},o.properties),lngLatBounds:new t.LngLatBounds(l),originalMapEvent:e}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var u=o.properties[this._key];this._clickHighlightPropVal!==u&&(this._clickHighlightPropVal=u,this._setHighlight())}},o.prototype._onMouseMove=function(e){var i,o,n,s=null===(i=e.features)||void 0===i?void 0:i[0],a=this._getFeature(s.properties[this._key]),l=r.getCoord(r.centroid(a)),u=new t.LngLat(l[0],l[1]);if(this.fire("mousemove",{center:u,data:h({},s.properties),lngLat:e.lngLat,originalMapEvent:e}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var p=null===(n=null===(o=e.features)||void 0===o?void 0:o[0].properties)||void 0===n?void 0:n[this._key];this._hoverHighlightPropVal!==p&&(this._hoverHighlightPropVal=p,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(e){var i,o=null===(i=e.features)||void 0===i?void 0:i[0],n=this._getFeature(o.properties[this._key]),s=r.getCoord(r.centroid(n)),a=new t.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:h({},o.properties),lngLat:e.lngLat,originalMapEvent:e})},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=l(["case",t],i,!0)})),i["line-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),N=["fill-opacity","fill-color","fill-pattern"],z=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray","stroke-pattern"],$={"stroke-opacity":1,"stroke-pattern":"","stroke-color":"#000000","stroke-width":1,"stroke-blur":0},q={"fill-opacity":1,"fill-pattern":"","fill-color":"#000000"},G=function(e){function o(t){var o,r,n,s,a=e.call(this)||this;return a._strokePaintStyleMap=new Map,a._strokeLayoutStyleMap=new Map,a._fillPaintStyleMap=new Map,a._fillLayoutStyleMap=new Map,a._expressionMap=new Map,a._id=i.nanoid(),a._fillLayer=new M({id:"polygon-fill-".concat(a._id),type:"fill",layerCursor:"pointer",data:t.data,paint:a._getFillPaint(t.style),layout:{visibility:"visible","fill-sort-key":null!==(o=null==t?void 0:t.style["sort-key"])&&void 0!==o?o:1}}),a._strokeLayer=new M({id:"polygon-stroke-".concat(a._id),type:"line",data:t.data,paint:a._getStrokePaint(t.style),layout:{visibility:"visible","line-sort-key":null!==(r=null==t?void 0:t.style["sort-key"])&&void 0!==r?r:1}}),a._key=null!==(n=t.key)&&void 0!==n?n:"id",a._fitBoundsOptions=a._getFitBoundsOptions(t.fitBoundsOptions),a._setLngLatBounds(t.data),a._highlightTrigger=null===(s=t.highlightOptions)||void 0===s?void 0:s.trigger,t.highlightOptions&&a._initHighlight(t.style,t.highlightOptions.style),m(["_onMouseClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],a),a}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._fillLayer.addTo(t),this._strokeLayer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._fillLayer.remove(),this._strokeLayer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._fillLayer.setData(t),this._strokeLayer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.fitTo=function(e,i){if(!this._map)return this;var o=this._getFeature(e);o&&this._map.fitBounds(new t.LngLatBounds(r.bboxPolygon(r.bbox(o)).bbox),i||{})},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=r.getCoord(r.centroid(i));this._map.easeTo(h(h({},e),{center:[o[0],o[1]]}))}return this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=r.getCoord(r.centroid(i));this._map.flyTo(h(h({},e||{}),{center:[o[0],o[1]]}))}return this},o.prototype.fitBounds=function(t){var e;this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{}))},o.prototype._getFeature=function(t){return this._fillLayer.queryFeatureFormData(this._key,t)},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:null},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getFillPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){N.includes(i)&&(e[i]=t[i])})),e},o.prototype._getStrokePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){z.includes(i)&&(e[i.replace("stroke","line")]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._fillLayer[t]("click",this._onMouseClick),this._fillLayer[t]("mousemove",this._onMouseMove),this._fillLayer[t]("mouseleave",this._onMouseLeave),this._fillLayer[t]("mouseenter",this._onMouseEnter)},o.prototype._onMouseClick=function(e){var i=e.features[0],o=this._getFeature(i.properties[this._key]),n=r.getCoord(r.centroid(o)),s=new t.LngLat(n[0],n[1]),a=r.bboxPolygon(r.bbox(o)).bbox;if(this.fire("click",{center:s,data:h({},i.properties),lngLatBounds:new t.LngLatBounds(a),originalMapEvent:e}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var l=i.properties[this._key];this._clickHighlightPropVal!==l&&(this._clickHighlightPropVal=l,this._setHighlight())}},o.prototype._onMouseMove=function(e){var i,o=null===(i=e.features)||void 0===i?void 0:i[0],n=this._getFeature(o.properties[this._key]),s=r.getCoord(r.centroid(n)),a=new t.LngLat(s[0],s[1]);if(this.fire("mousemove",{center:a,data:h({},o.properties),lngLat:e.lngLat,originalMapEvent:e}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var l=e.features[0].properties[this._key];this._hoverHighlightPropVal!==l&&(this._hoverHighlightPropVal=l,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(e){var i,o=null===(i=e.features)||void 0===i?void 0:i[0],n=this._getFeature(o.properties[this._key]),s=r.getCoord(r.centroid(n)),a=new t.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:h({},o.properties),lngLat:e.lngLat,originalMapEvent:e})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);this._strokePaintStyleMap.forEach((function(e,i){o[i]=l(["case",t],e,!0)})),this._strokeLayoutStyleMap.forEach((function(e,i){r[i]=l(["case",t],e,!0)})),this._fillPaintStyleMap.forEach((function(i,o){e[o]=l(["case",t],i,!0)})),this._fillLayoutStyleMap.forEach((function(e,o){i[o]=l(["case",t],e,!0)})),this._fillLayer.setStyle({paint:e,layout:i}),this._strokeLayer.setStyle({paint:o,layout:r})},o.prototype._initHighlight=function(t,e){var i,o,r=this;Object.keys($).forEach((function(i){var o,n=e[i];void 0!==n&&r._strokePaintStyleMap.set(i.replace("stroke","line"),[n,null!==(o=t[i])&&void 0!==o?o:$[i]])})),Object.keys(q).forEach((function(i){var o,n=e[i];void 0!==n&&r._fillPaintStyleMap.set(i,[n,null!==(o=t[i])&&void 0!==o?o:q[i]])}));var n=e["sort-key"];void 0!==n&&(this._strokeLayoutStyleMap.set("line-sort-key",[n,null!==(i=t["sort-key"])&&void 0!==i?i:1]),this._fillLayoutStyleMap.set("fill-sort-key",[n,null!==(o=t["sort-key"])&&void 0!==o?o:1]));var s="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",r._key],null!==(t=r._hoverHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s],["==",["get",r._key],null!==(e=r._hoverHighlightPropVal)&&void 0!==e?e:s]]}))},o}(t.Evented),W=function(t){function e(e){var o,r,n=t.call(this)||this;return n._id=i.nanoid(),n._sourceAndLayerId="heatmap-layer-".concat(n._id),n._data=e.data,n._styleOptions=e.style,n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(),n._minZoom=null!==(o=e.minZoom)&&void 0!==o?o:0,n._maxZoom=null!==(r=e.maxZoom)&&void 0!==r?r:24,m(["_onData"],n),n}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addSourceAndLayer(),this._map.on("data",this._onData),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.remove=function(){return this._map&&(this._map.off("data",this._onData),this._map.removeLayer(this._sourceAndLayerId),this._map.removeSource(this._sourceAndLayerId),this._map=void 0),this},e.prototype.setData=function(t){(this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this._sourceAndLayerId).setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions));return this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAndLayer()}),10)},e.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?r.bboxPolygon(r.bbox(this._data)).bbox:void 0},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._addSourceAndLayer=function(){var t;this._map&&(this._map.getLayer(this._sourceAndLayerId)||this._map.addLayer({id:this._sourceAndLayerId,type:"heatmap",minzoom:this._minZoom,maxzoom:this._maxZoom,source:{type:"geojson",data:this._data},paint:null!==(t=this._styleOptions)&&void 0!==t?t:{}}))},e}(t.Evented),Z=function(e){function o(t){var i,o,r=e.call(this)||this;return r._pointMap=new Map,r._multiple=null!==(i=null==t?void 0:t.multiple)&&void 0!==i&&i,r._removeOnClick=null!==(o=null==t?void 0:t.removeOnClick)&&void 0!==o&&o,r._markerOptions=null==t?void 0:t.markerOptions,m(["_onMapClick"],r),r}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._map.getCanvas().style.cursor="crosshair",this._map.on("click",this._onMapClick)),this},o.prototype.remove=function(){return this._map&&(this.removePoints(),this._map.getCanvas().style.cursor="",this._map.off("click",this._onMapClick),this._map=void 0),this},o.prototype.setPoint=function(e){var o,r;if(!this._map)return this;this._multiple||this.removePoints();var n=i.nanoid(),s=this._markerOptions?h(h({},this._markerOptions),{draggable:!1,element:null!==(r=null===(o=this._markerOptions.element)||void 0===o?void 0:o.cloneNode())&&void 0!==r?r:void 0}):{},a=new t.Marker(s).setLngLat(e).addTo(this._map);return this._setMarkerEvent(n,a),this._pointMap.set(n,{lngLat:a.getLngLat(),marker:a}),this},o.prototype.getPoints=function(){return Array.from(this._pointMap).map((function(t){return t[1].lngLat.toArray()}))},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype._onMapClick=function(t){this.setPoint(t.lngLat),this.fire("get-point",{point:t.lngLat.toArray(),pointList:this.getPoints()})},o.prototype._setMarkerEvent=function(t,e){var i=this,o=e.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i._removeOnClick?(e.remove(),i._pointMap.delete(t),i.fire("remove-point",{point:e.getLngLat().toArray(),pointList:i.getPoints()})):i.fire("click-point",{point:e.getLngLat().toArray()}),o.stopPropagation()}))},o.prototype.removePoints=function(){this._pointMap.forEach((function(t){t.marker.remove()})),this._pointMap.clear()},o}(t.Evented),U=["line-opacity","line-color","line-width","line-blur","line-dasharray"],Y=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],K=function(t){function e(e){var o,r,n=t.call(this)||this;return n._id=i.nanoid(),n._initState(),n._initStyle(null==e?void 0:e.style),n._initFinishedStyle(null==e?void 0:e.finishedStyle),n._enableBackspace=null!==(o=null==e?void 0:e.enableBackspace)&&void 0!==o&&o,n._enableEnter=null!==(r=null==e?void 0:e.enableEnter)&&void 0!==r&&r,m(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],n),n}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished?r.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._lineLayer)||void 0===i||i.remove(),this._vertexLayer=new M({id:"line-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._lineLayer=new M({id:"line-picker-line-".concat(this._id),type:"line",data:this._getLineSourceData(),paint:t.line}),null===(o=this._lineLayer)||void 0===o||o.addTo(this._map),null===(r=this._vertexLayer)||void 0===r||r.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){U.includes(o)?i[o]=t[o]:Y.includes(o)&&(e[o.replace("vertex","circle")]=t[o])})),{line:i,vertex:e}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={line:h(h({},b),e.line),vertex:h(h(h({},L),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={line:h(h(h({},this._style.line),{"line-dasharray":[1,0]}),e.line),vertex:h(h({},this._style.vertex),e.vertex)}},e.prototype._initState=function(){this._data=null,this._vertexList=[],this._lineCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!1,this._preFinishedOnVertex=!1,this._mouseOnVertex=!1},e.prototype._removeLayer=function(){var t,e;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._lineLayer)||void 0===e||e.remove(),this._vertexLayer=void 0,this._lineLayer=void 0},e.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateLine=function(){var t;this._data=this._getLineSourceData(),null===(t=this._lineLayer)||void 0===t||t.setData(r.clone(this._data))},e.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},e.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},e.prototype._getIndex=function(t,e){return t.findIndex((function(t){return r.booleanEqual(r.point(t),r.point(e))}))},e.prototype._handleMouseMove=function(t){this._lineCoordinates=l([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,this._preFinishedOnVertex=!1,-1===e?(this._lineCoordinates.push(t),this._preFinished=!0):this._vertexList.length>1&&(e===this._vertexList.length-2||e===this._vertexList.length-1?this._preFinished=!0:(this._lineCoordinates.push(t),0===e?this._preFinished=!0:this._preFinishedOnVertex=!0)),this._updateLine()},e.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},e.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?this._vertexList=l([],this._lineCoordinates,!0):(this._picking=!0,this._vertexList=[t.lngLat.toArray()],this._lineCoordinates=l([],this._vertexList,!0)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateLine(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},e.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:r.clone(this._data),length:r.length(this._data,{units:"meters"})})},e.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},e.prototype._enterComplete=function(){!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&(this._vertexList=l([],this._lineCoordinates,!0),this._complete())},e.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&this._complete()},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e.prototype._getVertexSourceData=function(){return r.featureCollection(this._vertexList.map((function(t,e){return r.point(t,{id:e})})))},e.prototype._getLineSourceData=function(){return this._lineCoordinates.length>1?r.lineString(this._lineCoordinates):r.featureCollection([])},e}(t.Evented),J=["fill-opacity","fill-color"],X=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],Q=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],tt=function(t){function e(e){var o,r,n=t.call(this)||this;return n._id=i.nanoid(),n._initState(),n._initStyle(null==e?void 0:e.style),n._initFinishedStyle(null==e?void 0:e.finishedStyle),n._enableBackspace=null!==(o=null==e?void 0:e.enableBackspace)&&void 0!==o&&o,n._enableEnter=null!==(r=null==e?void 0:e.enableEnter)&&void 0!==r&&r,m(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],n),n}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished?r.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._fillLayer=new M({id:"polygon-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new M({id:"polygon-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._vertexLayer=new M({id:"polygon-area-picker-vertex-".concat(this._id),type:"circle",data:this._getVertexSourceData(),layerCursor:"pointer",mapCursor:"crosshair",paint:t.vertex}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){J.includes(r)?o[r]=t[r]:X.includes(r)?i[r.replace("stroke","line")]=t[r]:Q.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:h(h({},this._style.fill),e.fill),stroke:h(h(h({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:h(h({},this._style.vertex),e.vertex)}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:h(h({},k),e.fill),stroke:h(h({},b),e.stroke),vertex:h(h(h({},L),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initState=function(){this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!0,this._mouseOnVertex=!1},e.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},e.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},e.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},e.prototype._getIndex=function(t,e){return t.findIndex((function(t){return r.booleanEqual(r.point(t),r.point(e))}))},e.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?(this._vertexList=l([],this._strokeCoordinates,!0),this._strokeCoordinates=l([],this._fillCoordinates,!0)):(this._picking=!0,this._vertexList.push(t.lngLat.toArray()),this._strokeCoordinates=l([],this._vertexList,!0),this._fillCoordinates=l(l([],this._vertexList,!0),[this._vertexList[0]],!1)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateStroke(),this._updateFill(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},e.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&this._preFinished&&this._complete()},e.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},e.prototype._handleMouseMove=function(t){this._strokeCoordinates=l([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,-1===e?(this._strokeCoordinates.push(t),this._fillCoordinates=l(l([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1),this._vertexList.length>1&&(this._preFinished=!0)):this._vertexList.length>2?e===this._vertexList.length-1?(this._preFinished=!0,this._fillCoordinates=l(l([],this._strokeCoordinates,!0),[this._vertexList[0]],!1)):0===e?(this._preFinished=!0,this._strokeCoordinates.push(t),this._fillCoordinates=l([],this._strokeCoordinates,!0)):(this._preFinished=!0,this._fillCoordinates=l(l([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1)):this._fillCoordinates=l([],this._strokeCoordinates,!0),this._updateStroke(),this._updateFill()},e.prototype._enterComplete=function(){!this._finished&&this._picking&&this._preFinished&&(this._vertexList=l([],this._strokeCoordinates,!0),this._strokeCoordinates=l([],this._fillCoordinates,!0),this._complete())},e.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:r.clone(this._data),acreage:r.area(this._data)})},e.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(r.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e.prototype._getVertexSourceData=function(){return r.featureCollection(this._vertexList.map((function(t,e){return r.point(t,{id:e})})))},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?r.lineString(this._strokeCoordinates):r.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?r.combine(r.unkinkPolygon(r.polygon([this._fillCoordinates]))).features[0]:r.featureCollection([])},e}(t.Evented),et=["fill-opacity","fill-color"],it=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],ot=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],rt=function(t){function e(e){var o=t.call(this)||this;return o._id=i.nanoid(),o._initState(),o._initStyle(null==e?void 0:e.style),o._initFinishedStyle(null==e?void 0:e.finishedStyle),m(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],o),o}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished&&this._data?r.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._vertexLayer=new M({id:"rect-area-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._strokeLayer=new M({id:"rect-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._fillLayer=new M({id:"rect-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){et.includes(r)?o[r]=t[r]:it.includes(r)?i[r.replace("stroke","line")]=t[r]:ot.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:h(h({},k),e.fill),stroke:h(h({},b),e.stroke),vertex:h(h(h({},L),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:h(h({},this._style.fill),e.fill),stroke:h(h(h({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:h(h({},this._style.vertex),e.vertex)}},e.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._initState=function(){this._nw=null,this._se=null,this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},e.prototype._getVertexSourceData=function(){return r.featureCollection(this._vertexList.map((function(t,e){return r.point(t,{id:e})})))},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?r.lineString(this._strokeCoordinates):r.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?r.polygon([this._fillCoordinates]):r.featureCollection([])},e.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},e.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._nw=t.lngLat.toArray(),t.preventDefault())},e.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._vertexList.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:r.clone(this._data),acreage:r.area(this._data)})))},e.prototype._onMapDoubleClick=function(t){t.preventDefault()},e.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){this._se=t.lngLat.toArray();var e=r.bboxPolygon(r.bbox(r.lineString([this._nw,this._se])));0===r.area(e)?(this._fillCoordinates=[],this._strokeCoordinates=[],this._vertexList=[]):(this._fillCoordinates=l([],e.geometry.coordinates[0],!0),this._strokeCoordinates=l([],this._fillCoordinates,!0),this._vertexList=this._fillCoordinates.slice(0,-1)),this._updateVertex(),this._updateStroke(),this._updateFill()}},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(r.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e}(t.Evented),nt=["fill-opacity","fill-color"],st=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],at=function(t){function e(e){var o=t.call(this)||this;return o._id=i.nanoid(),o._initState(),o._initStyle(null==e?void 0:e.style),o._initFinishedStyle(null==e?void 0:e.finishedStyle),o._steps=(null==e?void 0:e.steps)||64,m(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],o),o}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished&&this._data?r.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._removeLayer=function(){var t,e;null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._initState=function(){this._center=null,this._radius=null,this._data=null,this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){nt.includes(o)?i[o]=t[o]:st.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),{fill:i,stroke:e}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:h(h({},this._style.fill),e.fill),stroke:h(h(h({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke)}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:h(h({},k),e.fill),stroke:h(h({},b),e.stroke)}},e.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._fillLayer=new M({id:"circle-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new M({id:"circle-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),null===(o=this._fillLayer)||void 0===o||o.addTo(this._map),null===(r=this._strokeLayer)||void 0===r||r.addTo(this._map)},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?r.featureCollection([r.lineString(this._strokeCoordinates)]):r.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?r.polygon([this._fillCoordinates]):r.featureCollection([])},e.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},e.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._center=t.lngLat.toArray(),t.preventDefault())},e.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._fillCoordinates.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:r.clone(this._data),center:l([],this._center,!0),radius:this._radius,acreage:r.area(this._data)})))},e.prototype._onMapDoubleClick=function(t){t.preventDefault()},e.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){var e={units:"kilometers"};this._radius=r.distance(this._center,t.lngLat.toArray(),e);var i=r.circle(this._center,this._radius,h(h({},e),{steps:this._steps}));0===r.area(i)?(this._fillCoordinates=[],this._strokeCoordinates=[]):(this._fillCoordinates=l([],i.geometry.coordinates[0],!0),this._strokeCoordinates=l([],this._fillCoordinates,!0)),this._updateStroke(),this._updateFill()}},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(r.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e}(t.Evented),ht={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},lt={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},ut=["fill-opacity","fill-color"],pt=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],ct=["meters","kilometers"],_t=function(t){function e(e){var o,r=t.call(this)||this;return r._id=i.nanoid(),r._center=null==e?void 0:e.center,r._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:5,r._units=(null==e?void 0:e.units)&&ct.includes(e.units)?e.units:"kilometers",r._steps=(null==e?void 0:e.steps)&&e.steps>2?e.steps:64,r._manual=null!==(o=e.manual)&&void 0!==o&&o,r._initData(),r._initStyle(e.style),r._initLayer(e.centerLayer?h({show:!0,type:"circle"},e.centerLayer):{show:!0,type:"circle"}),m(["_onMapClick"],r),r}return s(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){var e,i,o;return t===this._map||(this.remove(),this._map=t,null===(e=this._strokeLayer)||void 0===e||e.addTo(t).setData(this._bufferData),null===(i=this._fillLayer)||void 0===i||i.addTo(t).setData(this._bufferData),null===(o=this._centerLayer)||void 0===o||o.addTo(t).setData(this._centerData),this._manual&&(this._map.on("click",this._onMapClick),this._map.getCanvas().style.cursor="crosshair")),this},e.prototype.remove=function(){var t,e,i;return this._map&&(null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),null===(i=this._centerLayer)||void 0===i||i.remove(),this._manual&&(this._map.off("click",this._onMapClick),this._map.getCanvas().style.cursor=""),this._map=void 0),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype.clear=function(){return this._center=void 0,this._update(),this},e.prototype.setOptions=function(t){return t.center&&(this._center=t.center),t.radius&&(this._radius=t.radius),t.units&&ct.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>2&&(this._steps=t.steps),this._update(),this},e.prototype.getData=function(){return this._center?r.clone(this._bufferData):null},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);Object.keys(t).forEach((function(o){ut.includes(o)?i[o]=t[o]:pt.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),this._style={fill:i,stroke:e}},e.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){C.includes(i)&&(e[i]=t[i])})),e},e.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){S.includes(o)?i[o]=t[o]:E.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._initLayer=function(t){var e,i;this._fillLayer=new M({id:"buffer-fill-".concat(this._id),type:"fill",paint:this._style.fill}),this._strokeLayer=new M({id:"buffer-stroke-".concat(this._id),type:"line",paint:this._style.stroke}),t.show&&"symbol"!==t.type&&(this._centerLayer=new M({id:"buffer-center-".concat(this._id),type:"circle",paint:this._getCirclePaint(h(h({},ht),null!==(e=null==t?void 0:t.style)&&void 0!==e?e:{}))})),t.show&&"symbol"===t.type&&(this._centerLayer=new M(h({id:"buffer-center-".concat(this._id),type:"symbol"},this._getSymbolStyle(h(h({},lt),null!==(i=t.style)&&void 0!==i?i:{})))))},e.prototype._onMapClick=function(t){this._center=t.lngLat.toArray(),this._update(),this.fire("change",{center:t.lngLat,radius:this._radius,units:this._units,buffer:r.clone(this._bufferData)})},e.prototype._update=function(){var t,e,i;this._initData(),null===(t=this._fillLayer)||void 0===t||t.setData(this._bufferData),null===(e=this._strokeLayer)||void 0===e||e.setData(this._bufferData),null===(i=this._centerLayer)||void 0===i||i.setData(this._centerData)},e.prototype._initData=function(){this._center?(this._centerData=r.point(this._center),this._bufferData=r.circle(this._center,this._radius,{units:this._units,steps:this._steps})):(this._centerData=r.featureCollection([]),this._bufferData=r.featureCollection([]))},e}(t.Evented),dt={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},gt=function(e){function o(t){var o,r,n=e.call(this)||this;return n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=i.nanoid(),n._layerId="circle-cluster-layer-point-".concat(n._id),n._clusterLayerId="circle-cluster-layer-cluster-".concat(n._id),n._clusterLabelLayerId="circle-cluster-label-layer-cluster-".concat(n._id),n._key=null!==(o=t.key)&&void 0!==o?o:"id",n._data=t.data,n._styleOptions=t.style,n._clusterStyleOptions=t.clusterStyle,n._clusterRadius=null!==(r=t.clusterRadius)&&void 0!==r?r:250,n._highlightOptions=t.highlightOptions,n._fitBoundsOptions=n._getFitBoundsOptions(t.fitBoundsOptions),n._setLngLatBounds(),n._highlightOptions&&n._initHighlight(),m(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_OnData"],n),n}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},o.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},o.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},o.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?r.bboxPolygon(r.bbox(this._data)).bbox:null},o.prototype._initHighlight=function(){var t=this;Object.keys(dt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._styleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:dt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._addLayerAndSource=function(){var t;if(this._map){this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50});var e=this._getStyle(this._clusterStyleOptions),i=e.textStyle,o=e.circleStyle;this._map.getLayer(this._clusterLayerId)||this._map.addLayer(h({id:this._clusterLayerId,type:"circle",source:this._layerId,filter:["has","cluster_id"]},o)),this._map.getLayer(this._clusterLabelLayerId)||this._map.addLayer(h({id:this._clusterLabelLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},i)),this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:"circle",source:this._layerId,filter:["!",["has","cluster_id"]],paint:this._getPaint(this._styleOptions),layout:{visibility:"visible"}}),this._highlightOptions&&this._setHighlight()}},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){C.includes(i)&&(e[i]=t[i])})),e},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);return Object.keys(t).forEach((function(r){B.includes(r)?i[r]=t[r]:F.includes(r)?e[r]=t[r]:C.includes(r)&&(o[r]=t[r])})),i.visibility="visible",r.visibility="visible",{textStyle:{paint:e,layout:i},circleStyle:{paint:o,layout:r}}},o.prototype._OnData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._OnData)},o.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},o.prototype._getPoint=function(e){return{data:h({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",h(h({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",h(h({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",h(h({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._styleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,l(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"circle-sort-key",["case",e,2,0])},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._removeLayerAndSource=function(){var t,e,i,o;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getLayer(this._clusterLabelLayerId))&&this._map.removeLayer(this._clusterLabelLayerId),(null===(o=this._map)||void 0===o?void 0:o.getSource(this._layerId))&&this._map.removeSource(this._layerId)},o}(t.Evented),ft={"icon-image":"","icon-size":1,"icon-offset":[0,0],"text-field":"","text-size":16,"text-offset":[0,0]},yt={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},vt=function(e){function o(t){var o,r,n=e.call(this)||this;return n._layoutStyleMap=new Map,n._paintStyleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=i.nanoid(),n._layerId="symbol-cluster-layer-point-".concat(n._id),n._clusterLayerId="symbol-cluster-layer-cluster-".concat(n._id),n._key=null!==(o=t.key)&&void 0!==o?o:"id",n._data=t.data,n._styleOptions=t.style,n._clusterStyleOptions=t.clusterStyle,n._clusterRadius=null!==(r=t.clusterRadius)&&void 0!==r?r:250,n._highlightOptions=t.highlightOptions,n._fitBoundsOptions=n._getFitBoundsOptions(t.fitBoundsOptions),n._setLngLatBounds(),n._highlightOptions&&n._initHighlight(),m(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_onData"],n),n}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},o.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},o.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},o.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?r.bboxPolygon(r.bbox(this._data)).bbox:null},o.prototype._initHighlight=function(){var t=this;Object.keys(ft).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._layoutStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:ft[e]])})),Object.keys(yt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._paintStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:yt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50}),this._map.getLayer(this._clusterLayerId)||this._map.addLayer(h({id:this._clusterLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},this._getStyle(this._clusterStyleOptions))),this._map.getLayer(this._layerId)||this._map.addLayer(h({id:this._layerId,type:"symbol",source:this._layerId,filter:["!",["has","cluster_id"]]},this._getStyle(this._styleOptions))),this._highlightOptions&&this._setHighlight())},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){S.includes(o)?i[o]=t[o]:E.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._onData)},o.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},o.prototype._getPoint=function(e){return{data:h({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",h(h({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",h(h({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",h(h({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._paintStyleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,l(["case",e],i,!0))})),this._layoutStyleMap.forEach((function(i,o){t._map.setLayoutProperty(t._layerId,o,l(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"symbol-sort-key",["case",e,2,0])},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._removeLayerAndSource=function(){var t,e,i;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getSource(this._layerId))&&this._map.removeSource(this._layerId)},o}(t.Evented),mt={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},Lt={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},bt={"line-width":5,"line-color":"#f00","line-cap":"round","line-join":"round"},kt={"line-width":5,"line-color":"#0f0","line-cap":"round","line-join":"round"},xt=function(t){function e(e){var o,n,s,a,l=t.call(this)||this;return l._id=i.nanoid(),l._data=e.data,l._isFull=null===(n=null===(o=e.pathLayer)||void 0===o?void 0:o.isFull)||void 0===n||n,l._units="kilometers",l._speed=null!==(s=e.speed)&&void 0!==s?s:5,l._loop=null===(a=e.loop)||void 0===a||a,l._originPathLayerData=r.lineString(l._data),l._initLength(),l._initState(),l._layerOptions={carLayer:e.carLayer?h({show:!1,type:"circle"},e.carLayer):{show:!1,type:"circle"},currentPathLayer:e.currentPathLayer?h({show:!0},e.currentPathLayer):{show:!0},pathLayer:e.pathLayer?h({show:!0},e.pathLayer):{show:!0}},l._fitBoundsOptions=l._getFitBoundsOptions(e.fitBoundsOptions),l._lngLatBounds=r.bboxPolygon(r.bbox(l._originPathLayerData)).bbox,m(["_animate"],l),l}return s(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.remove=function(){var t,e,i;return this._map&&(cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._pathLayer)||void 0===t||t.remove(),null===(e=this._currentPathLayer)||void 0===e||e.remove(),null===(i=this._carLayer)||void 0===i||i.remove(),this._map=void 0),this},e.prototype.setSpeed=function(t){return this._speed=t,this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype.stop=function(){var t,e,i;cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._carLayer)||void 0===t||t.setData(this._carLayerData),null===(e=this._currentPathLayer)||void 0===e||e.setData(r.featureCollection([])),this._isFull||null===(i=this._pathLayer)||void 0===i||i.setData(this._originPathLayerData)},e.prototype.play=function(){this._isPlaying||(this._finished&&this._initState(),this._isPlaying=!0,this._fRecord=requestAnimationFrame(this._animate))},e.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,cancelAnimationFrame(this._fRecord),this._pending=!0)},e.prototype.replay=function(){cancelAnimationFrame(this._fRecord),this._initState(),this.play()},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initState=function(){this._current=0,this._isPlaying=!1,this._startTime=0,this._finished=!1,this._currentLength=0,this._pending=!1,this._bearing=r.bearing(r.point(this._data[0]),r.point(this._data[1])),this._carLayerData=r.point(this._data[0],{bearing:this._bearing}),this._currentPathLayerData=void 0},e.prototype._initLength=function(){var t=this;this._pointLength=[];var e=0;this._data.forEach((function(i,o){if(0!==o){var n=r.distance(r.point(i),r.point(t._data[o-1]),{units:t._units});e+=n}t._pointLength.push(e)})),this._routeLength=e},e.prototype._animate=function(t){var e,i,o,n;if(this._pending)return this._pending=!1,this._startTime=t,void(this._fRecord=requestAnimationFrame(this._animate));var s=void 0;if(0===this._startTime)this._startTime=t,s=this._originPathLayerData;else{var a=t-this._startTime;if(this._startTime=t,this._currentLength+=a/1e3*this._speed,this._currentLength>=this._routeLength)this._carLayerData=r.point(this._data[this._data.length-1]),this._currentLength=this._routeLength,this._finished=!0,this._currentPathLayerData=this._originPathLayerData;else{this._carLayerData=r.along(this._originPathLayerData,this._currentLength);for(var h=this._current;h<this._pointLength.length&&!(this._pointLength[h]>this._currentLength);)h++;h!==this._current&&(this._current=h,this._bearing=r.bearing(this._carLayerData,r.point(this._data[this._current]))),this._currentPathLayerData=r.lineString(l(l([],this._data.slice(0,this._current),!0),[this._carLayerData.geometry.coordinates],!1)),s=r.lineString(l([this._carLayerData.geometry.coordinates],this._data.slice(this._current),!0))}}this._carLayerData.properties={bearing:this._bearing},null===(e=this._carLayer)||void 0===e||e.setData(this._carLayerData),this._isFull||null===(i=this._pathLayer)||void 0===i||i.setData(null!=s?s:r.featureCollection([])),null===(o=this._currentPathLayer)||void 0===o||o.setData(null!==(n=this._currentPathLayerData)&&void 0!==n?n:r.featureCollection([])),this._finished&&(this._loop?(this._initState(),this._isPlaying=!0):(this._isPlaying=!1,this.fire("finish"))),this._isPlaying&&(this._fRecord=requestAnimationFrame(this._animate))},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){C.includes(i)&&(e[i]=t[i])})),e},e.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){S.includes(o)?i[o]=t[o]:E.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._getPathStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){O.includes(o)?i[o]=t[o]:P.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._initLayer=function(){var t,e,i,o,r,n,s,a=this._layerOptions,l=a.carLayer,u=a.currentPathLayer,p=a.pathLayer;p.show&&(this._pathLayer=new M(h({id:"car-track-full-path-".concat(this._id),type:"line",data:this._originPathLayerData},this._getPathStyle(h(h({},kt),null!==(t=null==p?void 0:p.style)&&void 0!==t?t:{}))))),u.show&&(this._currentPathLayer=new M(h({id:"car-track-current-path-".concat(this._id),type:"line"},this._getPathStyle(h(h({},bt),null!==(e=null==u?void 0:u.style)&&void 0!==e?e:{}))))),l.show&&"symbol"!==l.type&&(this._carLayer=new M({id:"car-track-car-".concat(this._id),type:"circle",data:this._carLayerData,paint:this._getCirclePaint(h(h({},mt),null!==(i=null==l?void 0:l.style)&&void 0!==i?i:{}))})),l.show&&"symbol"===l.type&&(this._carLayer=new M(h({id:"car-track-car-".concat(this._id),type:"symbol",data:this._carLayerData},this._getSymbolStyle(h(h({},Lt),null!==(o=l.style)&&void 0!==o?o:{}))))),null===(r=this._pathLayer)||void 0===r||r.addTo(this._map),null===(n=this._currentPathLayer)||void 0===n||n.addTo(this._map),null===(s=this._carLayer)||void 0===s||s.addTo(this._map)},e}(t.Evented);function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}var Pt="object"===("undefined"==typeof HTMLElement?"undefined":Mt(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===Mt(t)&&(1===t.nodeType||9===t.nodeType)&&"string"==typeof t.nodeName};function Ot(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(arguments.length<2)){for(var i=[],o=0;o<arguments.length;o++)i.push(t[o]);var r=[];return i.forEach((function(t,e){r[e]=a.bind(null,t,i.filter((function(t,i){return i!==e})))})),n(),function(){s(),r=[],i=[]}}function n(){i.forEach((function(t,e){t.on("move",r[e])}))}function s(){i.forEach((function(t,e){t.off("move",r[e])}))}function a(t,e){s(),function(t,e){var i=t.getCenter(),o=t.getZoom(),r=t.getBearing(),n=t.getPitch();e.forEach((function(t){t.jumpTo({center:i,zoom:o,bearing:r,pitch:n})}))}(t,e),n()}}var Ct=function(){function e(e){if(this._removed=!1,this._horizontal=Boolean(e.horizontal),"string"==typeof e.container){var i=document.querySelector(e.container);if(!i)throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=i}else{if(!Pt(e.container))throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=e.container}this._container.classList.add("map-comparer-container"),this._container.style.position="relative";var o=document.createElement("div");o.classList.add("before-map-container"),o.style.position="absolute",o.style.width="100%",o.style.height="100%",this._container.appendChild(o);var r=document.createElement("div");r.classList.add("after-map-container"),r.style.position="absolute",r.style.width="100%",r.style.height="100%",this._container.appendChild(r),this._swiper=document.createElement("div"),this._swiper.className="comparer-swiper",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"map-comparer-control comparer-control-horizontal":"map-comparer-control comparer-control-vertical",this._controlContainer.appendChild(this._swiper),this._container.appendChild(this._controlContainer),this._firstMap=new t.Map(h(h({},e.mapOptions),{style:e.firstMapStyle,container:o})),this._secondMap=new t.Map(h(h({},e.mapOptions),{style:e.secondMapStyle,container:r})),Ot(this._firstMap,this._secondMap),m(["_onResize","_onMove","_onDown","_onTouchEnd","_onMouseUp"],this),this._secondMap.on("resize",this._onResize),this._bounds=this._secondMap.getContainer().getBoundingClientRect();var n=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(n),this._mousemove&&(this._firstMap.getContainer().addEventListener("mousemove",this._onMove),this._secondMap.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}return Object.defineProperty(e.prototype,"firstMap",{get:function(){return this._firstMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"secondMap",{get:function(){return this._secondMap},enumerable:!1,configurable:!0}),e.prototype._onResize=function(){var t=this._horizontal?this._bounds.height:this._bounds.width,e=this.currentPosition/t;this._bounds=this._secondMap.getContainer().getBoundingClientRect(),t=this._horizontal?this._bounds.height:this._bounds.width,this._setPosition(t*e)},e.prototype._setPosition=function(t){t=Math.min(t,this._horizontal?this._bounds.height:this._bounds.width);var e=this._horizontal?"translate(0, "+t+"px)":"translate("+t+"px, 0)";this._controlContainer.style.transform=e,this._controlContainer.style.webkitTransform=e;var i=this._horizontal?"rect(0, 999em, "+t+"px, 0)":"rect(0, "+t+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+t+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+t+"px)";this._firstMap.getContainer().style.clip=i,this._secondMap.getContainer().style.clip=o,this.currentPosition=t},e.prototype._setPointerEvents=function(t){this._controlContainer.style.pointerEvents=t,this._swiper.style.pointerEvents=t},e.prototype._onMove=function(t){this._mousemove&&this._setPointerEvents(t.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(t)):this._setPosition(this._getX(t))},e.prototype._getY=function(t){var e=(t=t.touches?t.touches[0]:t).clientY-this._bounds.top;return e<0&&(e=0),e>this._bounds.height&&(e=this._bounds.height),e},e.prototype._getX=function(t){var e=(t=t.touches?t.touches[0]:t).clientX-this._bounds.left;return e<0&&(e=0),e>this._bounds.width&&(e=this._bounds.width),e},e.prototype._onTouchEnd=function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)},e.prototype._onMouseUp=function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp)},e.prototype._onDown=function(t){t.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},e.prototype.setSlider=function(t){if(!this._removed){var e=this._horizontal?this._bounds.height:this._bounds.width;t>1?t=1:t<0&&(t=0),this._setPosition(t*e)}},e.prototype.remove=function(){var t,e;this._removed||(null===(t=this._firstMap)||void 0===t||t.remove(),null===(e=this._secondMap)||void 0===e||e.remove(),this._container.innerHTML="",this._container.style.position="",this._container.classList.remove("map-comparer-container"),this._removed=!0)},e}(),St={"fill-extrusion-opacity":1,"fill-extrusion-pattern":"","fill-extrusion-color":"#000000"},Et=function(e){function o(t){var o,r,n,s,a=e.call(this)||this;return a._lngLatBounds=null,a._styleMap=new Map,a._clickHighlightPropVal=void 0,a._hoverHighlightPropVal=void 0,a._expressionMap=new Map,a._radius=null!==(o=t.radius)&&void 0!==o?o:10,a._steps=null!==(r=t.steps)&&void 0!==r?r:64,a._key=null!==(n=t.key)&&void 0!==n?n:"id",a._id=i.nanoid(),a._layer=new M({id:"prismoid-layer-".concat(a._id),type:"fill-extrusion",layerCursor:"pointer",data:a._transformData(t.data),paint:a._getPaint(t.style),layout:{visibility:"visible"}}),a._fitBoundsOptions=a._getFitBoundsOptions(t.fitBoundsOptions),a._setLngLatBounds(t.data),a._highlightTrigger=null===(s=t.highlightOptions)||void 0===s?void 0:s.trigger,t.highlightOptions&&a._initHighlight(t.style,t.highlightOptions.style),m(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],a),a}return s(o,e),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(this._transformData(t)),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:JSON.parse(i.properties.originCoordinates)})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:JSON.parse(i.properties.originCoordinates)})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._transformData=function(t){var e=this,i=t.features.filter((function(t){return"Point"===t.geometry.type})).map((function(t){return r.circle(t.geometry.coordinates,e._radius,{units:"meters",steps:e._steps,properties:h(h({},t.properties),{originCoordinates:t.geometry.coordinates})})}));return r.featureCollection(i)},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?r.bboxPolygon(r.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(St).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:St[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){D.includes(i)&&(e[i]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){var i=e.properties,o=i.originCoordinates,r=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(i[o[r]]=t[o[r]])}return i}(i,["originCoordinates"]),n=JSON.parse(o);return{data:r,lngLat:new t.LngLat(n[0],n[1])}},o.prototype._onClick=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",h(h({},this._getPoint(i)),{originalMapEvent:t})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var o=i.properties[this._key];this._clickHighlightPropVal!==o&&(this._clickHighlightPropVal=o,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",h(h({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",h(h({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=l(["case",t],i,!0)})),this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),Bt=["none","click","hover","manual"],Ft=function(o){function r(t){var e=o.call(this)||this;return t=v(t),e._map=null,e._lngLatBounds=null,e._highlightFeatureId=null,e._source="advance-point-layer".concat(i.nanoid()),e._key=t.key||"id",e._data=t.data,e._layerPool=t.layerPool||{},e._layers=t.layers||[],e._highlightTrigger=t.highlightTrigger&&Bt.includes(t.highlightTrigger)?t.highlightTrigger:"none",e._highlightLayers="none"===e._highlightTrigger?[]:t.highlightLayers||[],e._cluster=t.cluster||!1,e._clusterLayers=e._cluster&&t.clusterLayers||[],e._clusterRadius=t.clusterRadius,e._clusterMaxZoom=t.clusterMaxZoom,e._clusterMinPoints=t.clusterMinPoints,e._clusterProperties=t.clusterProperties,e._maxzoom=t.maxzoom,e._fitBoundsOptions=t.fitBoundsOptions||!1,e._isMouseOver=!1,e._setLngLatBounds(),m(["_onClick","_onMouseMove","_onData","_onMouseLeave"],e),e}return s(r,o),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clusterLayers",{get:function(){var t=this;return this._clusterLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-cluster")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i]),t._clusterLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-cluster")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,h({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||e.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(h(h({},e),{center:i.geometry.coordinates})),this},r.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(h(h({},e||{}),{center:i.geometry.coordinates})),this},r.prototype.on=function(t,e){return o.prototype.on.call(this,t,e)},r.prototype.fire=function(t,e){return o.prototype.fire.call(this,t,e)},r.prototype.once=function(t,e){return o.prototype.once.call(this,t,e)},r.prototype.off=function(t,e){return o.prototype.off.call(this,t,e)},r.prototype._getFeature=function(t){var i,o,r,n=this;if(this._data&&"string"!=typeof this._data){var s=null===(o=null===(i=this._map)||void 0===i?void 0:i.querySourceFeatures(this.source,{filter:["==",["get",this._key],t]}))||void 0===o?void 0:o[0];return s||("FeatureCollection"===this._data.type?s=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[n._key])===t})):"Feature"===this._data.type&&(null===(r=this._data.properties)||void 0===r?void 0:r[this._key])===t&&(s=e.clone(this._data)),s)}},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,h({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=e.bboxPolygon(e.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(e){var i,o,r=this;if(this._map){var n=this._getEventFeature(e.point);if(n)if(this._isDefault(n)&&this._setHighlight(n.id,"click"),this._isBasic(n))this.fire("click",h(h({},this._getData(n)),{originMapEvent:e}));else if(this._isClustered(n)){this._map.getSource(this.source).getClusterLeaves(null===(i=n.properties)||void 0===i?void 0:i.cluster_id,null===(o=n.properties)||void 0===o?void 0:o.point_count,0,(function(i,o){if(!i){var s=n.geometry.coordinates;r.fire("cluster-click",{clusterLeaves:null==o?void 0:o.map((function(t){return r._getData(t)})),originMapEvent:e,lngLat:new t.LngLat(s[0],s[1])})}}))}}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return l(l([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._isClustered=function(t){return this.clusterLayers.includes(t.layer.id)},r.prototype._getData=function(e){var i=e.geometry.coordinates;return{data:h({},e.properties),lngLat:new t.LngLat(i[0],i[1])}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)],["!",i._getClusterFilter()]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t),["!",i._getClusterFilter()]])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(t){var e=this._getEventFeature(t.point);if(e&&this._isBasic(e)){var i=h(h({},this._getData(e)),{originMapEvent:t});this._isMouseOver?this.fire("mousemove",i):(this.fire("mouseenter",i),this._isMouseOver=!0),this._addCursor(),this._setHighlight(e.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:t}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-utils-advance-point-layer")&&this._map.getContainer().classList.add("mapbox-utils-advance-point-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-utils-advance-point-layer")},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var i={data:this._data||e.featureCollection([]),type:"geojson",promoteId:this._key};void 0!==this._cluster&&(i.cluster=this._cluster),void 0!==this._clusterMaxZoom&&(i.clusterMaxZoom=this._clusterMaxZoom),void 0!==this._clusterMinPoints&&(i.clusterMinPoints=this._clusterMinPoints),void 0!==this._clusterProperties&&(i.clusterProperties=this._clusterProperties),void 0!==this._clusterRadius&&(i.clusterRadius=this._clusterRadius),void 0!==this._maxzoom&&(i.maxzoom=this._maxzoom),this._map.addSource(this.source,i)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)],["!",t._getClusterFilter()]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId),["!",t._getClusterFilter()]]}))}})),this._cluster&&this.clusterLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),t._getClusterFilter(),null===(r=n.filter)||void 0===r||r]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._getClusterFilter=function(){return!!this._cluster&&["all",["has","cluster_id"],["==",["get","cluster"],!0]]},r.prototype._getGeometryFilter=function(){return["==",["geometry-type"],"Point"]},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),this._cluster&&this.clusterLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r}(t.Evented),Dt=["none","click","hover","manual"],Tt=function(o){function r(t){var e,r=o.call(this)||this;return t=v(t),r._map=null,r._lngLatBounds=null,r._highlightFeatureId=null,r._source="advance-line-layer".concat(i.nanoid()),r._key=t.key||"id",r._data=t.data,r._lineMetrics=null!==(e=t.lineMetrics)&&void 0!==e&&e,r._layerPool=t.layerPool||{},r._layers=t.layers||[],r._highlightTrigger=t.highlightTrigger&&Dt.includes(t.highlightTrigger)?t.highlightTrigger:"none",r._highlightLayers="none"===r._highlightTrigger?[]:t.highlightLayers||[],r._fitBoundsOptions=t.fitBoundsOptions||!1,r._isMouseOver=!1,r._setLngLatBounds(),m(["_onClick","_onMouseMove","_onData","_onMouseLeave"],r),r}return s(r,o),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,h({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(this._data||e.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.easeTo(h(h({},i),{center:[r[0],r[1]]}))}return this},r.prototype.flyTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.flyTo(h(h({},i||{}),{center:[r[0],r[1]]}))}return this},r.prototype.fitTo=function(i,o){if(void 0===o&&(o={}),!this._map)return this;var r=this._getFeature(i);r&&this._map.fitBounds(new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox),o)},r.prototype.on=function(t,e){return o.prototype.on.call(this,t,e)},r.prototype.fire=function(t,e){return o.prototype.fire.call(this,t,e)},r.prototype.once=function(t,e){return o.prototype.once.call(this,t,e)},r.prototype.off=function(t,e){return o.prototype.off.call(this,t,e)},r.prototype._getFeature=function(t){var i,o,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?o=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(i=this._data.properties)||void 0===i?void 0:i[this._key])===t&&(o=e.clone(this._data)),o},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,h({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=e.bboxPolygon(e.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-utils-advance-line-layer")&&this._map.getContainer().classList.add("mapbox-utils-advance-line-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-utils-advance-line-layer")},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(i){var o=this._getEventFeature(i.point);if(o&&(this._isDefault(o)&&this._setHighlight(o.id,"click"),this._isBasic(o))){var r=this._getFeature(o.properties[this._key]),n=r?e.getCoord(e.centroid(r)):void 0,s=h(h({},this._getData(o)),{originMapEvent:i});n&&(s.center=new t.LngLat(n[0],n[1])),r&&(s.lngLatBounds=new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox)),this.fire("click",h({},s))}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return l(l([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._getData=function(t){return{data:h({},t.properties)}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(i){var o=this._getEventFeature(i.point);if(o&&this._isBasic(o)){var r=this._getFeature(o.properties[this._key]),n=r?e.getCoord(e.centroid(r)):void 0,s=h(h({},this._getData(o)),{originMapEvent:i});n&&(s.center=new t.LngLat(n[0],n[1])),this._isMouseOver?this.fire("mousemove",s):(this.fire("mouseenter",s),this._isMouseOver=!0),this._addCursor(),this._setHighlight(o.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:i}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var i={data:this._data||e.featureCollection([]),type:"geojson",promoteId:this._key,lineMetrics:this._lineMetrics};this._map.addSource(this.source,i)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"],["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},r}(t.Evented),Ht=["none","click","hover","manual"],wt=function(o){function r(t){var e=o.call(this)||this;return t=v(t),e._map=null,e._lngLatBounds=null,e._highlightFeatureId=null,e._source="advance-polygon-layer".concat(i.nanoid()),e._key=t.key||"id",e._data=t.data,e._layerPool=t.layerPool||{},e._layers=t.layers||[],e._highlightTrigger=t.highlightTrigger&&Ht.includes(t.highlightTrigger)?t.highlightTrigger:"none",e._highlightLayers="none"===e._highlightTrigger?[]:t.highlightLayers||[],e._fitBoundsOptions=t.fitBoundsOptions||!1,e._isMouseOver=!1,e._setLngLatBounds(),m(["_onClick","_onMouseMove","_onData","_onMouseLeave"],e),e}return s(r,o),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,h({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||e.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.easeTo(h(h({},i),{center:[r[0],r[1]]}))}return this},r.prototype.flyTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.flyTo(h(h({},i||{}),{center:[r[0],r[1]]}))}return this},r.prototype.fitTo=function(i,o){if(void 0===o&&(o={}),!this._map)return this;var r=this._getFeature(i);r&&this._map.fitBounds(new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox),o)},r.prototype.on=function(t,e){return o.prototype.on.call(this,t,e)},r.prototype.fire=function(t,e){return o.prototype.fire.call(this,t,e)},r.prototype.once=function(t,e){return o.prototype.once.call(this,t,e)},r.prototype.off=function(t,e){return o.prototype.off.call(this,t,e)},r.prototype._getFeature=function(t){var i,o,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?o=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(i=this._data.properties)||void 0===i?void 0:i[this._key])===t&&(o=e.clone(this._data)),o},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,h({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=e.bboxPolygon(e.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(i){var o=this._getEventFeature(i.point);if(o&&(this._isDefault(o)&&this._setHighlight(o.id,"click"),this._isBasic(o))){var r=this._getFeature(o.properties[this._key]),n=r?e.getCoord(e.centroid(r)):void 0,s=h(h({},this._getData(o)),{originMapEvent:i});n&&(s.center=new t.LngLat(n[0],n[1])),r&&(s.lngLatBounds=new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox)),this.fire("click",h({},s))}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return l(l([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._getData=function(t){return{data:h({},t.properties)}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(i){var o=this._getEventFeature(i.point);if(o&&this._isBasic(o)){var r=this._getFeature(o.properties[this._key]),n=r?e.getCoord(e.centroid(r)):void 0,s=h(h({},this._getData(o)),{originMapEvent:i});n&&(s.center=new t.LngLat(n[0],n[1])),this._isMouseOver?this.fire("mousemove",s):(this.fire("mouseenter",s),this._isMouseOver=!0),this._addCursor(),this._setHighlight(o.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:i}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-utils-advance-polygon-layer")&&this._map.getContainer().classList.add("mapbox-utils-advance-polygon-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-utils-advance-polygon-layer")},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var i={data:this._data||e.featureCollection([]),type:"geojson",promoteId:this._key};this._map.addSource(this.source,i)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},r}(t.Evented),jt=[{id:"mapbox-utils-distance-measure-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-distance-measure-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-utils-distance-measure-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-distance-measure-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],Vt=function(t){function e(e){var i,o=t.call(this)||this;return o._source="mapbox-utils-distance-measurer-source",o._map=null,o._enabled=!1,o._currentPath=[],o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||jt,m(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return s(e,t),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._render(),this},e.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-utils-distance-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},e.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-utils-distance-measurer-cursor"))},e.prototype.disable=function(){0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-utils-distance-measurer-cursor"),this._render())},e.prototype.clear=function(){return this._cacheMap.forEach((function(t){t.data.forEach((function(t){t.marker.remove()}))})),this._cacheMap.clear(),0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._map&&this._render(),this},e.prototype.getAllPath=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({pathId:i,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))})})),t},e.prototype.getPathById=function(t){var e=this._cacheMap.get(t);return e?{pathId:t,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))}:null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},e.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},e.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._currentPath[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},e.prototype._finish=function(){var t=this;if(!(this._next<2)){this._next=0;var e=Date.now().toString(),i=It(this._currentPath,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(i.data[i.data.length-1].marker,(function(){return t._remove(e)})),this._cacheMap.set(e,i),this._currentPath=[],setTimeout((function(){t.fire("complete",{pathId:e,length:i.length,pathData:i.features.find((function(t){return"LineString"===t.geometry.type}))})}),10)}},e.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.data.forEach((function(t){var e;null===(e=t.marker)||void 0===e||e.remove()})),this._cacheMap.delete(t),this.fire("delete",{pathId:t}),this._render()},e.prototype._add=function(t){this._update(t),this._next++},e.prototype._update=function(t){var e=this._currentPath.length>1?function(t){var e=r.length(r.lineString(t),{units:"kilometers"});if(e<1)return(1e3*e).toFixed(0)+"米";return e.toFixed(1)+"公里"}(l(l([],this._currentPath.map((function(t){return t.coordinates})),!0),[t],!1)):"起点";this._currentPath[this._next]?(this._currentPath[this._next].coordinates=t,this._currentPath[this._next].marker.getElement().innerText=e,this._currentPath[this._next].marker.setLngLat(t)):this._currentPath[this._next]={coordinates:t,marker:At(t,e)}},e.prototype._render=function(){var t=this;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.features)}));var o=It(this._currentPath,"true");i.push.apply(i,o.features),o.data.forEach((function(e){var i;null===(i=e.marker)||void 0===i||i.addTo(t._map)})),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(h(h({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e}(t.Evented);function It(t,e){var i=[],o=t.map((function(t){return t.coordinates})),n=function(t,e){try{return r.lineString(t,{active:e})}catch(t){return null}}(o,e),s=0;return n&&(i.push(n),s=r.length(n,{units:"kilometers"})),o.forEach((function(t){var o=r.point(t,{active:e});i.push(o)})),{data:l([],t,!0),features:i,length:s}}function At(e,i){var o=document.createElement("div");o.classList.add("mapbox-utils-distance-measurer-marker");var r=new t.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(e),r.getElement().innerText=i,r}var Rt=[{id:"mapbox-utils-area-measurer-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.3}},{id:"mapbox-utils-area-measurer-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-area-measurer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-utils-area-measurer-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.4}},{id:"mapbox-utils-area-measurer-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-area-measurer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],Nt=function(t){function e(e){var i,o=t.call(this)||this;return o._source="mapbox-utils-area-measurer-source",o._map=null,o._enabled=!1,o._current={path:[],marker:null},o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||Rt,m(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return s(e,t),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-utils-area-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},e.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-utils-area-measurer-cursor"))},e.prototype.disable=function(){var t;0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-utils-area-measurer-cursor"),this._render())},e.prototype.clear=function(){var t;return this._cacheMap.forEach((function(t){t.marker.remove()})),this._cacheMap.clear(),0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._map&&this._render(),this},e.prototype.getAllArea=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({areaId:i,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})})),t},e.prototype.getAreaById=function(t){var e=this._cacheMap.get(t);return e?{areaId:t,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))}:null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},e.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},e.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._current.path[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},e.prototype._finish=function(){var t,e=this;if(!(this._next<3)){this._next=0;var i=Date.now().toString(),o=zt(this._current.path,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(o.marker,(function(){return e._remove(i)})),o.marker.addTo(this._map),this._cacheMap.set(i,o),null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},setTimeout((function(){e.fire("complete",{areaId:i,acreage:o.acreage,areaData:o.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})}),10)}},e.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.marker.remove(),this._cacheMap.delete(t),this.fire("delete",{areaId:t}),this._render()},e.prototype._add=function(t){this._update(t),this._next>=2&&!$t(l(l([],this._current.path,!0),[this._current.path[0]],!1),"true")||this._next++},e.prototype._update=function(t){this._current.path[this._next]=t},e.prototype._render=function(){var t,e;if(this._map){var i=this._map.getSource(this._source),o=[];this._cacheMap.forEach((function(t){o.push.apply(o,t.features)}));var r=zt(this._current.path,"true");o.push.apply(o,r.features),null===(t=this._current.marker)||void 0===t||t.remove(),this._current.marker=r.marker,null===(e=this._current.marker)||void 0===e||e.addTo(this._map),i.setData({type:"FeatureCollection",features:o})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(h(h({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e}(t.Evented);function zt(e,i){var o=[],n=null,s=function(t,e){try{return r.lineString(t,{active:e})}catch(t){return null}}(l(l([],e,!0),[e[0]],!1),i);s&&o.push(s);var a=$t(l(l([],e,!0),[e[0]],!1),i),h=0;a&&(o.push(a),n=function(e,i){var o=document.createElement("div");o.classList.add("mapbox-utils-area-measurer-marker");var r=new t.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(e),r.getElement().innerText=i,r}(r.center(a).geometry.coordinates,(h=r.area(a))>1e6?(h/1e6).toFixed(2)+"平方公里":h.toFixed(2)+"平方米"));return e.forEach((function(t){var e=r.point(t,{active:i});o.push(e)})),{data:l([],e,!0),features:o,marker:n,acreage:h}}function $t(t,e){try{var i=void 0,o=r.unkinkPolygon(r.polygon([t]));return(i=o.features.length>1?r.combine(o).features[0]:o.features[0]).properties={active:e},i}catch(t){return null}}var qt=[{id:"mapbox-utils-draw-util-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-utils-draw-util-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-draw-util-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-draw-util-point-active",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-utils-draw-util-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-utils-draw-util-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-draw-util-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-draw-util-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-utils-draw-util-circle-center-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["==","type","circle-center"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],Gt=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return s(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(t.Evented);function Wt(t,i){void 0===i&&(i={});try{return e.lineString(t,h({},i))}catch(t){return null}}var Zt=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],i=e.point(this._path[0],{origin:"point"});return t.push(i),{feature:i,renderFeatures:t}},i.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},i.prototype.onMouseMove=function(){return!1},i.prototype.onDblClick=function(){},i.prototype.clear=function(){this._path=[]},i}(Gt),Ut=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=this._next-1;"false"===t&&(o=this._next);var r=Wt(l([],this._path,!0),{active:t,origin:"line"});r&&i.push(r);for(var n=0;n<=o;n++)if(this._path[n]){var s=e.point(this._path[n],{active:t,type:"vertex",origin:"line"});i.push(s)}return{feature:r,renderFeatures:i}},i.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(Gt),Yt=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=l([],this._path,!0),r=this._next-1;"false"===t&&(o=l(l([],this._path,!0),[this._path[0]],!1),r=this._next);var n=Wt(o,{active:t,type:"border",origin:"polygon"});n&&i.push(n);var s=Kt(l(l([],this._path,!0),[this._path[0]],!1),t);s&&i.push(s);for(var a=0;a<=r;a++)if(this._path[a]){var h=e.point(this._path[a],{active:t,type:"vertex",origin:"polygon"});i.push(h)}return{feature:s,renderFeatures:i}},i.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!Kt(l(l([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||Kt(l(l([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(Gt);function Kt(t,i){try{var o=void 0,r=e.unkinkPolygon(e.polygon([t]));return(o=r.features.length>1?e.combine(r).features[0]:r.features[0]).properties={active:i,origin:"polygon"},o}catch(t){return null}}var Jt,Xt=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=null;if(2===this._path.length){var r=e.point(this._path[0]),n=e.rhumbDistance(r,e.point(this._path[1]));o=e.circle(r,n,{steps:512,properties:{active:t,origin:"circle"}}),i.push(o);var s=e.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"circle"});i.push(s)}if(this._path[0]){var a=e.point(this._path[0],{active:t,type:"circle-center",origin:"circle"});i.push(a)}return{feature:o,renderFeatures:i}},i.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault()},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(Gt),Qt=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=null;if(2===this._path.length){delete(o=e.bboxPolygon(e.bbox(e.featureCollection([e.point(this._path[0]),e.point(this._path[1])])),{properties:{active:t,origin:"rect"}})).bbox,i.push(o);var r=e.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"rect"});i.push(r),o.geometry.coordinates[0].forEach((function(o){var r=e.point(o,{active:t,type:"vertex",origin:"rect"});i.push(r)}))}else if(this._path[0]){var n=e.point(this._path[0],{active:t,type:"vertex",origin:"rect"});i.push(n)}return{feature:o,renderFeatures:i}},i.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault()},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(Gt),te={NONE:"NONE",DRAW_POINT:"DRAW_POINT",DRAW_LINE:"DRAW_LINE",DRAW_POLYGON:"DRAW_POLYGON",DRAW_CIRCLE:"DRAW_CIRCLE",DRAW_RECT:"DRAW_RECT"},ee=((Jt={})[te.DRAW_POINT]=Zt,Jt[te.DRAW_LINE]=Ut,Jt[te.DRAW_POLYGON]=Yt,Jt[te.DRAW_CIRCLE]=Xt,Jt[te.DRAW_RECT]=Qt,Jt),ie=function(t){function o(e){var o,r,n,s,a,h=t.call(this)||this;return h._map=null,h._source="mapbox-utils-draw-util-source-".concat(i.nanoid(8)),h._currentModeType=te.NONE,h._currentMode=null,h._cacheMap=new Map,h._multiple=null!==(o=null==e?void 0:e.multiple)&&void 0!==o&&o,h._layers=(null==e?void 0:e.layers)||qt,h._onClick=(r=h,n=h._onClick,s=250,a=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a||(n.call.apply(n,l([r],t,!1)),a=setTimeout((function(){a=void 0}),s))}),m(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],h),h}return s(o,t),Object.defineProperty(o.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},o.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-utils-draw-util-cursor")),this._currentModeType=te.NONE,this._currentMode=null,this._map=null,this.clear()},o.prototype.changeMode=function(t){var o,r,n,s=this;if(this._currentModeType!==t)return null===(o=this._currentMode)||void 0===o||o.clear(),this._currentModeType=t,t===te.NONE?(this._currentMode=null,null===(r=this._map)||void 0===r||r.getContainer().classList.remove("mapbox-utils-draw-util-cursor")):(this._currentMode=new ee[t],null===(n=this._map)||void 0===n||n.getContainer().classList.add("mapbox-utils-draw-util-cursor"),this._currentMode.on("finished",(function(t){var o=i.nanoid(8),r=e.clone(t.data.feature);r.properties={},s._cacheMap.set(o,{renderFeatures:t.data.renderFeatures,feature:r}),setTimeout((function(){s._render()})),setTimeout((function(){s.fire("add",{data:{id:o,feature:e.clone(r)}})}))}))),this._render(),this},o.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},o.prototype.add=function(t,i){void 0===i&&(i=!1);var o=Date.now().toString();if("Polygon"===t.geometry.type){var r=function(t,i,o){void 0===o&&(o=!1);var r=t.geometry,n=[],s=Wt(r.coordinates[0],{active:i,type:"border",origin:o?"circle":"polygon"});s&&n.push(s);var a=e.clone(t);if(a.properties={active:i,origin:o?"circle":"polygon"},n.push(a),!o){var h=e.multiPoint(r.coordinates[0]);e.cleanCoords(h).geometry.coordinates.forEach((function(t){var o=e.point(t,{active:i,type:"vertex",origin:"polygon"});n.push(o)}))}return{renderFeatures:n,feature:e.clone(t)}}(t,"false",i);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("MultiPolygon"===t.geometry.type){r=function(t,i){var o=t.geometry,r=[];o.coordinates.forEach((function(t){var e=Wt(t[0],{active:i,type:"border",origin:"polygon"});e&&r.push(e)}));var n=e.clone(t);n.properties={active:i,origin:"polygon"},r.push(n);var s=[];o.coordinates.forEach((function(t){s.push.apply(s,t[0])}));var a=e.multiPoint(s);return e.cleanCoords(a).geometry.coordinates.forEach((function(t){var o=e.point(t,{active:i,type:"vertex",origin:"polygon"});r.push(o)})),{feature:e.clone(t),renderFeatures:r}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("LineString"===t.geometry.type){r=function(t,i){var o=[],r=e.clone(t);return r.properties={active:i,origin:"line"},o.push(r),t.geometry.coordinates.forEach((function(t){var r=e.point(t,{active:i,type:"vertex",origin:"line"});o.push(r)})),{renderFeatures:o,feature:e.clone(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("MultiLineString"===t.geometry.type){r=function(t,i){var o=[],r=e.clone(t);return r.properties={active:i,origin:"line"},o.push(r),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var r=e.point(t,{active:i,type:"vertex",origin:"line"});o.push(r)}))})),{renderFeatures:o,feature:e.clone(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else{if("Point"!==t.geometry.type&&"MultiPoint"!==t.geometry.type)return null;r=function(t){var i=[],o=e.clone(t);return o.properties={origin:"point"},i.push(o),{renderFeatures:i,feature:e.clone(t)}}(t);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}return this._map&&this._render(),o},o.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},o.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){return{id:t[0],feature:t[1].feature}}))},o.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},o.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},o.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},o.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},o.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},o.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},o.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},o.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},o.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.renderFeatures)}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},o.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(h(h({},e),{source:t._source}))})))},o.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},o.MODE_TYPE=te,o}(t.Evented);var oe=function(t){function o(e){var o=t.call(this)||this;return e=v(e),o._renderData=[],o._data=e.data||[],o._fullPathData=null,o._splittedPathData=[],o._useTimeStamp=!1,o._layerPool=e.layerPool||{},o._currentPathLayers=e.currentPathLayers||[],o._fullPathLayers=e.fullPathLayers||[],o._carLayers=e.carLayers||[],o._nodeLayers=e.nodeLayers||[],o._trackTimeStamp=0,o._realTimeStamp=0,o._animationFrame=0,o._state=0,o._speed=e.speed||1,o._map=null,o._finished=!1,o._loop=e.loop||!1,o._source="mapbox-utils-car-track-".concat(i.nanoid(8)),o._fitBoundsOptions=o._getFitBoundsOptions(e.fitBoundsOptions),o._lngLatBounds=null,o._calcFullPath(),o._calcSplittedPath(),m(["_animate","_onData"],o),o}return s(o,t),Object.defineProperty(o.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentPathLayers",{get:function(){var t=this;return this._currentPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-current-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fullPathLayers",{get:function(){var t=this;return this._fullPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-full-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"carLayers",{get:function(){var t=this;return this._carLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-car")}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"nodeLayers",{get:function(){var t=this;return this._nodeLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-node")}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._currentPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-current-path")]=t._layerPool[i]),t._fullPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-full-path")]=t._layerPool[i]),t._carLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-car")]=t._layerPool[i]),t._nodeLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-node")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return this._map===t||(this.remove(),this._map=t,this._addSourceAnyLayer(),this._map.on("data",this._onData),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype.remove=function(){var t;return null===(t=this._map)||void 0===t||t.off("data",this._onData),this.stop(),this._removeSourceAndLayer(),this._map=null,this._renderData=[],this},o.prototype.play=function(){return this._map&&this._fullPathData?(1===this._state||(this._state=1,this._realTimeStamp=Date.now(),this._finished&&(this._finished=!1,this._init()),this._animationFrame=requestAnimationFrame(this._animate)),this):this},o.prototype.pause=function(){return this._map?(1!==this._state||(cancelAnimationFrame(this._animationFrame),this._state=2),this):this},o.prototype.stop=function(){return this._map?(cancelAnimationFrame(this._animationFrame),this._state=0,this._animationFrame=0,this._trackTimeStamp=0,this._realTimeStamp=0,this._finished=!1,this._init(),this):this},o.prototype.setSpeed=function(t){return this._speed=t,this},o.prototype.setTimestamp=function(t){return this._map&&this._useTimeStamp?(this.pause(),this._init(t),this._firePlayingEvent(),this):this},o.prototype.setData=function(t){return this.stop(),this._data=t||[],this._calcFullPath(),this._calcSplittedPath(),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions),this},o.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},o.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},o.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},o.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},o.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:this._renderData},lineMetrics:!0}),this.fullPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","full-path"]]}))}})),this.currentPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","current-path"]]}))}})),this.nodeLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","node"]]}))}})),this.carLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(h(h({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","car"]]}))}})))},o.prototype._removeSourceAndLayer=function(){var t=this;this._map&&(this.fullPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.currentPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.carLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.nodeLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this._map.getSource(this._source)&&this._map.removeSource(this._source))},o.prototype._calcSplittedPath=function(){var t=this;this._splittedPathData=[],this._fullPathData&&this._data.reduce((function(i,o,r){var n,s,a,u=e.point(i.coordinates),p=e.point(o.coordinates),c=e.distance(u,p,{units:"meters"}),_=h({},o);(1===r&&(t._useTimeStamp=!!i.timestamp),t._useTimeStamp)?(n=c/(o.timestamp-i.timestamp),s=i.timestamp,a=o.timestamp):(n=.001,a=(s=1===r?0:i.timestamp)+Math.floor(c/n),_.timestamp=a);return t._splittedPathData.push({speed:n,length:c,startTime:s,endTime:a,start:l([],i.coordinates,!0),end:l([],o.coordinates,!0),bearing:e.bearing(u,p)}),_}))},o.prototype._calcFullPath=function(){this._data.length>1?(this._fullPathData=e.lineString(this._data.map((function(t){return t.coordinates})),{type:"full-path"}),this._lngLatBounds=e.bboxPolygon(e.bbox(this._fullPathData)).bbox):(this._fullPathData=null,this._lngLatBounds=null)},o.prototype._search=function(t){if(t>=this._splittedPathData[this._splittedPathData.length-1].endTime)return this._splittedPathData.length-1;if(t<=this._splittedPathData[0].startTime)return 0;for(var e=0,i=this._splittedPathData.length-1;e<=i;){var o=Math.floor((i-e)/2)+e,r=this._splittedPathData[o];if(r.startTime<=t&&r.endTime>t)return o;r.startTime>t?i=o-1:e=o+1}return-1},o.prototype._getNodeData=function(t){var i=this;return this._data.map((function(o,r){return e.point(o.coordinates,{type:"node",nodeType:0===r?"start":r===i._data.length-1?"end":"common",nodeState:r>t?0:1})}))},o.prototype._init=function(t){var i;if(this._map){if(this._fullPathData)if(t)this._trackTimeStamp=t,this._renderData=this._getRenderData();else{this._renderData=l([this._fullPathData],this._getNodeData(0),!0);var o=this._splittedPathData[0],r=o.start,n=o.bearing,s=o.startTime;this._trackTimeStamp=s,this._renderData.push(e.point(r,{bearing:n,type:"car"}))}else this._renderData=[];var a=null===(i=this._map)||void 0===i?void 0:i.getSource(this._source);null==a||a.setData({type:"FeatureCollection",features:this._renderData})}},o.prototype._animate=function(){if(this._map&&0!==this._state&&2!==this._state){if(this._finished)return this._state=0,this.fire("complete"),void(this._loop&&this.play());var t=Date.now(),e=t-this._realTimeStamp;this._realTimeStamp=t,this._trackTimeStamp+=e*this._speed;var i=this._map.getSource(this._source);this._renderData=this._getRenderData(),null==i||i.setData({type:"FeatureCollection",features:this._renderData}),this._useTimeStamp&&this._firePlayingEvent(),1===this._state&&(this._animationFrame=requestAnimationFrame(this._animate))}},o.prototype._firePlayingEvent=function(){this.fire("moving",{timestamp:this._trackTimeStamp})},o.prototype._getRenderData=function(){var t,i=[this._fullPathData],o=this._search(this._trackTimeStamp),r=this._splittedPathData[o],n=r.start,s=r.end,a=r.startTime,h=r.endTime,u=r.speed,p=r.length,c=r.bearing,_=this._splittedPathData.slice(0,o+1),d=(this._trackTimeStamp-a)*u;this._finished=!1,d>=p?(t=e.point(s),this._trackTimeStamp=h,this._finished=o===this._splittedPathData.length-1,i.push.apply(i,this._getNodeData(o+1))):(t=e.along(e.lineString([n,s]),d,{units:"meters"}),i.push.apply(i,this._getNodeData(o))),t.properties={bearing:c,type:"car"},i.push(t);var g=e.lineString(l(l([],_.map((function(t){return t.start})),!0),[t.geometry.coordinates],!1),{type:"current-path"});return i.push(g),i},o}(t.Evented),re=[{id:"mapbox-utils-advance-buffer-fill",type:"fill",filter:["all",["==","$type","Polygon"],["==","origin","buffer"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-utils-advance-buffer-border",type:"line",filter:["all",["==","$type","LineString"],["==","origin","buffer"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-advance-buffer-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","origin","polygon"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-utils-advance-buffer-polygon-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-advance-buffer-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-advance-buffer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-utils-advance-buffer-point",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-utils-advance-buffer-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-utils-advance-buffer-polygon-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-advance-buffer-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-utils-advance-buffer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],ne=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return s(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(t.Evented);function se(t,i){void 0===i&&(i={});try{return e.lineString(t,h({},i))}catch(t){return null}}var ae=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],i=e.point(this._path[0],{origin:"point"});return t.push(i),{feature:i,renderFeatures:t}},i.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},i.prototype.onMouseMove=function(){return!1},i.prototype.onDblClick=function(){},i.prototype.clear=function(){this._path=[]},i}(ne),he=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=this._next-1;"false"===t&&(o=this._next);var r=se(l([],this._path,!0),{active:t,origin:"line"});r&&i.push(r);for(var n=0;n<=o;n++)if(this._path[n]){var s=e.point(this._path[n],{active:t,type:"vertex",origin:"line"});i.push(s)}return{feature:r,renderFeatures:i}},i.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(ne),le=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=l([],this._path,!0),r=this._next-1;"false"===t&&(o=l(l([],this._path,!0),[this._path[0]],!1),r=this._next);var n=se(o,{active:t,type:"border",origin:"polygon"});n&&i.push(n);var s=ue(l(l([],this._path,!0),[this._path[0]],!1),t);s&&i.push(s);for(var a=0;a<=r;a++)if(this._path[a]){var h=e.point(this._path[a],{active:t,type:"vertex",origin:"polygon"});i.push(h)}return{feature:s,renderFeatures:i}},i.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!ue(l(l([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||ue(l(l([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(ne);function ue(t,i){try{var o=void 0,r=e.unkinkPolygon(e.polygon([t]));return(o=r.features.length>1?e.combine(r).features[0]:r.features[0]).properties={active:i,origin:"polygon"},o}catch(t){return null}}var pe,ce=function(t){function i(){return t.call(this)||this}return s(i,t),i.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var i=[],o=null;if(2===this._path.length){delete(o=e.bboxPolygon(e.bbox(e.featureCollection([e.point(this._path[0]),e.point(this._path[1])])),{properties:{active:t,origin:"polygon"}})).bbox,i.push(o);var r=e.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"polygon"});i.push(r),o.geometry.coordinates[0].forEach((function(o){var r=e.point(o,{active:t,type:"vertex",origin:"polygon"});i.push(r)}))}else if(this._path[0]){var n=e.point(this._path[0],{active:t,type:"vertex",origin:"polygon"});i.push(n)}return{feature:o,renderFeatures:i}},i.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},i.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},i.prototype.onDblClick=function(t){t.preventDefault()},i.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},i}(ne),_e={NONE:"NONE",POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON",RECT:"RECT"},de=((pe={})[_e.POINT]=ae,pe[_e.LINE]=he,pe[_e.POLYGON]=le,pe[_e.RECT]=ce,pe),ge=["meters","kilometers"],fe=function(t){function o(e){var o,r,n,s,a,h=t.call(this)||this;return h._map=null,h._source="mapbox-utils-advance-buffer-source-".concat(i.nanoid(8)),h._currentModeType=_e.NONE,h._currentMode=null,h._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:1,h._units=(null==e?void 0:e.units)&&ge.includes(e.units)?e.units:"kilometers",h._steps=(null==e?void 0:e.steps)&&e.steps>0?e.steps:16,h._cacheMap=new Map,h._multiple=null!==(o=null==e?void 0:e.multiple)&&void 0!==o&&o,h._layers=(null==e?void 0:e.layers)||re,h._onClick=(r=h,n=h._onClick,s=250,a=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a||(n.call.apply(n,l([r],t,!1)),a=setTimeout((function(){a=void 0}),s))}),m(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],h),h}return s(o,t),Object.defineProperty(o.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},o.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-utils-advance-buffer-cursor")),this._currentModeType=_e.NONE,this._currentMode=null,this._map=null,this.clear()},o.prototype.changeMode=function(t){var o,r,n,s=this;if(this._currentModeType!==t)return null===(o=this._currentMode)||void 0===o||o.clear(),this._currentModeType=t,t===_e.NONE?(this._currentMode=null,null===(r=this._map)||void 0===r||r.getContainer().classList.remove("mapbox-utils-advance-buffer-cursor")):(this._currentMode=new de[t],null===(n=this._map)||void 0===n||n.getContainer().classList.add("mapbox-utils-advance-buffer-cursor"),this._currentMode.on("finished",(function(t){var o=i.nanoid(8),r=e.clone(t.data.feature);r.properties={};var n=ye(r,s._radius,s._steps,s._units),a=n.renderFeatures,h=n.bufferFeature;s._cacheMap.set(o,{bufferRenderFeatures:a,baseRenderFeatures:t.data.renderFeatures,bufferFeature:h,feature:r}),setTimeout((function(){s._render()})),setTimeout((function(){s.fire("add",{data:{id:o,feature:e.clone(r),bufferFeature:e.clone(h)}})}))}))),this._render(),this},o.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},o.prototype.add=function(t){var o=this,r=i.nanoid(8),n=ye(t,this._radius,this._steps,this._units),s=n.renderFeatures,a=n.bufferFeature;return this._multiple||this._cacheMap.clear(),this._cacheMap.set(r,{bufferRenderFeatures:s,baseRenderFeatures:ve(t),bufferFeature:a,feature:t}),this._map&&setTimeout((function(){o._render()})),{id:r,feature:e.clone(t),bufferFeature:e.clone(a)}},o.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},o.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){var e=t[0],i=t[1];return{id:e,feature:i.feature,bufferFeature:i.bufferFeature}}))},o.prototype.setBufferOptions=function(t){var e=this;return t.radius&&(this._radius=t.radius),t.units&&ge.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>0&&(this._steps=t.steps),this._cacheMap.forEach((function(t){var i=ye(t.feature,e._radius,e._steps,e._units),o=i.renderFeatures,r=i.bufferFeature;t.bufferRenderFeatures=o,t.bufferFeature=r})),this._render(),this},o.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},o.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},o.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},o.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},o.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},o.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},o.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},o.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},o.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,l(l([],t.baseRenderFeatures,!1),t.bufferRenderFeatures,!1))}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},o.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(h(h({},e),{source:t._source}))})))},o.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},o.MODE_TYPE=_e,o}(t.Evented);function ye(t,i,o,r){var n=[],s=e.cleanCoords(e.buffer(t,i,{units:r,steps:o})),a=e.clone(s);a.properties={origin:"buffer"};var h=e.polygonToLine(a);return"FeatureCollection"===h.type?h.features.forEach((function(t){t.properties={origin:"buffer"},n.push(t)})):(h.properties={origin:"buffer"},n.push(h)),n.push(a),{renderFeatures:n,bufferFeature:s}}function ve(t){return"Point"===t.geometry.type||"MultiPoint"===t.geometry.type?function(t){var i=e.clone(t);return i.properties={origin:"point"},[i]}(t):"LineString"===t.geometry.type?function(t){var i=[],o=e.clone(t);return o.properties={active:"false",origin:"line"},i.push(o),t.geometry.coordinates.forEach((function(t){var o=e.point(t,{active:"false",type:"vertex",origin:"line"});i.push(o)})),i}(t):"MultiLineString"===t.geometry.type?function(t){var i=[],o=e.clone(t);return o.properties={active:"false",origin:"line"},i.push(o),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var o=e.point(t,{active:"false",type:"vertex",origin:"line"});i.push(o)}))})),i}(t):"Polygon"===t.geometry.type?function(t){var i=[],o=e.clone(t);o.properties={active:"false",origin:"polygon"},i.push(o);var r=se(t.geometry.coordinates[0],{active:"false",type:"border",origin:"polygon"});r&&i.push(r);var n=e.multiPoint(t.geometry.coordinates[0]);return e.cleanCoords(n).geometry.coordinates.forEach((function(t){var o=e.point(t,{active:"false",type:"vertex",origin:"polygon"});i.push(o)})),i}(t):"MultiPolygon"===t.geometry.type?function(t){var i=[],o=e.clone(t);o.properties={active:"false",origin:"polygon"},i.push(o),t.geometry.coordinates.forEach((function(t){var e=se(t[0],{active:"false",type:"border",origin:"polygon"});e&&i.push(e)}));var r=[];t.geometry.coordinates.forEach((function(t){r.push.apply(r,t[0])}));var n=e.multiPoint(r);return e.cleanCoords(n).geometry.coordinates.forEach((function(t){var o=e.point(t,{active:"false",type:"vertex",origin:"polygon"});i.push(o)})),i}(t):[]}exports.AdvanceBuffer=fe,exports.AdvanceCarTrack=oe,exports.AdvanceLineLayer=Tt,exports.AdvancePointLayer=Ft,exports.AdvancePolygonLayer=wt,exports.AnyLayer=M,exports.AreaMeasurer=Nt,exports.BufferLayer=_t,exports.CarTrack=xt,exports.CircleAreaPicker=at,exports.CircleClusterLayer=gt,exports.CirclePointLayer=H,exports.DistanceMeasurer=Vt,exports.DrawUtil=ie,exports.HeatmapLayer=W,exports.LineLayer=R,exports.LinePicker=K,exports.MapComparer=Ct,exports.MarkerPointLayer=I,exports.PointPicker=Z,exports.PolygonAreaPicker=tt,exports.PolygonLayer=G,exports.PrismoidLayer=Et,exports.RectAreaPicker=rt,exports.SymbolClusterLayer=vt,exports.SymbolPointLayer=V;
//# sourceMappingURL=mapbox-utils.cjs.js.map
