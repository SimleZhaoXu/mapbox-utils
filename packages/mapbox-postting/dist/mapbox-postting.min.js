!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mapbox-gl"),require("@turf/turf"),require("nanoid")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl","@turf/turf","nanoid"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MapBoxCpn={},t.mapboxgl,t.turf,t.nanoid)}(this,(function(t,e,i,o){"use strict";function r(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}var n=r(i),s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var h,l=function(){return l=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l.apply(this,arguments)};function u(t,e,i){if(i||2===arguments.length)for(var o,r=0,n=e.length;r<n;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var p="[object Array]",c="[object Function]",_="[object Map]",d="[object Set]",g="[object Date]",f="[object RegExp]",y=((h={})["[object Object]"]=function(t,e){return Object.keys(e).forEach((function(i){return t[i]=m(e[i])})),t},h[p]=function(t,e){return e.forEach((function(e){return t.push(m(e))})),t},h[_]=function(t,e){return e.forEach((function(e,i){return t.set(i,m(e))})),t},h[d]=function(t,e){return e.forEach((function(e){return t.add(m(e))})),t},h[c]=function(t,e){return t=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.call.apply(e,u([this],t,!1))},t},h[g]=function(t,e){return new Date(e)},h[f]=function(t,e){return new RegExp(e.source,e.flags)},h),v=new WeakMap;function m(t){var e;if(!(t instanceof Object))return t;if(v.has(t))return v.get(t);var i=function(t){var e=t.constructor;return new e}(t);return v.set(t,i),i=(null!==(e=y[function(t){return Object.prototype.toString.call(t)}(t)])&&void 0!==e?e:function(){return t})(i,t)}function L(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var b={"circle-color":"#fff","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#44cef6"},k={"line-width":2,"line-color":"#44cef6","line-opacity":.5,"line-dasharray":[5,3]},M={"fill-color":"#44cef6","fill-opacity":.2},x=["default","crosshair","pointer","move","e-resize","ne-resize","nw-resize","n-resize","se-resize","sw-resize","s-resize","w-resize","text","wait","help"],P=function(){function t(t){var e;this._id=null!==(e=t.id)&&void 0!==e?e:o.nanoid(),this._type=t.type,this._layerId="".concat(this._type,"-").concat(this._id),this._data=t.data,this._paint=t.paint,this._layout=t.layout,this._layerCursor=t.layerCursor&&x.includes(t.layerCursor)?t.layerCursor:void 0,this._mapCursor=t.mapCursor&&x.includes(t.mapCursor)?t.mapCursor:void 0,L(["_onMouseEnter","_onMouseLeave","_onData"],this)}return Object.defineProperty(t.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),t.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this.on("mouseenter",this._onMouseEnter),this.on("mouseleave",this._onMouseLeave),this._map.on("data",this._onData)),this},t.prototype.remove=function(){return this._map&&(this._removeLayerAndSource(),this.off("mouseenter",this._onMouseEnter),this.off("mouseleave",this._onMouseLeave),this._map.off("data",this._onData),this._map=void 0),this},t.prototype.setData=function(t){if(this._data=t,this._map){var e=this._map.getSource(this._layerId);null==e||e.setData(t)}return this},t.prototype.on=function(t,e){var i;return null===(i=this._map)||void 0===i||i.on(t,this._layerId,e),this},t.prototype.off=function(t,e){var i;return null===(i=this._map)||void 0===i||i.off(t,this._layerId,e),this},t.prototype.setStyle=function(t){var e=this,i=t.paint,o=t.layout;i&&(this._paint=l(l({},this._paint),i),this._map&&Object.keys(i).forEach((function(t){e._map.setPaintProperty(e._layerId,t,i[t])})));o&&(this._layout=l(l({},this._layout),o),this._map&&Object.keys(o).forEach((function(t){e._map.setLayoutProperty(e._layerId,t,o[t])})));return this},t.prototype.querySourceFeature=function(t){var e;return null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,l(l({},t||{}),{sourceLayer:this._layerId}))},t.prototype.queryFeatureFormData=function(t,e){var i,o=void 0;return this._data?"FeatureCollection"===this._data.type?this._data.features.find((function(i){var o;return(null===(o=i.properties)||void 0===o?void 0:o[t])===e})):("Feature"===this._data.type&&(null===(i=this._data.properties)||void 0===i?void 0:i[t])===e&&(o=n.clone(this._data)),o):o},t.prototype.getSource=function(){var t;return null===(t=this._map)||void 0===t?void 0:t.getSource(this._layerId)},t.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:this._type,source:{type:"geojson",data:null!==(t=this._data)&&void 0!==t?t:n.featureCollection([])},layout:this._layout||{},paint:this._paint||{}}))},t.prototype._onMouseEnter=function(t){this._layerCursor&&(t.target.getCanvas().style.cursor=this._layerCursor)},t.prototype._onMouseLeave=function(t){var e;this._layerCursor&&(t.target.getCanvas().style.cursor=null!==(e=this._mapCursor)&&void 0!==e?e:"")},t.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},t.prototype._removeLayerAndSource=function(){var t,e;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getSource(this._layerId))&&this._map.removeSource(this._layerId)},t}(),O=["line-color","line-width","line-blur","line-opacity","line-pattern","line-gap-width","line-offset","line-dasharray","line-gradient","line-translate","line-translate-anchor"],C=["line-cap","line-join","line-miter-limit","line-round-limit"],S=["circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity"],E=["symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],B=["icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],F=["text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],T=["text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],D=["fill-extrusion-opacity","fill-extrusion-pattern","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient"],H={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},w=function(t){function i(e){var i,r,n=t.call(this)||this;return n._lngLatBounds=null,n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._key=null!==(i=e.key)&&void 0!==i?i:"id",n._id=o.nanoid(),n._layer=new P({id:"circle-point-layer-".concat(n._id),type:"circle",layerCursor:"pointer",data:e.data,paint:n._getPaint(e.style),layout:{visibility:"visible"}}),n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(e.data),n._highlightTrigger=null===(r=e.highlightOptions)||void 0===r?void 0:r.trigger,e.highlightOptions&&n._initHighlight(e.style,e.highlightOptions.style),L(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},i.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:null},i.prototype._initHighlight=function(t,e){var i=this;Object.keys(H).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:H[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){S.includes(i)&&(e[i]=t[i])})),e},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},i.prototype._getPoint=function(t){return{data:l({},t.properties),lngLat:new e.LngLat(t.geometry.coordinates[0],t.geometry.coordinates[1])}},i.prototype._onClick=function(t){var e,i,o=this,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",l(l({},this._getPoint(r)),{originalMapEvent:t,points:null===(i=t.features)||void 0===i?void 0:i.map((function(t){return o._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var n=r.properties[this._key];this._clickHighlightPropVal!==n&&(this._clickHighlightPropVal=n,this._setHighlight())}},i.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",l(l({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},i.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",l(l({},this._getPoint(i)),{originalMapEvent:t}))},i.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=u(["case",t],i,!0)})),i["circle-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i}(e.Evented),j={"icon-image":"","icon-size":1,"text-field":"","text-size":16},V={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},I=function(t){function i(e){var i,r,n=t.call(this)||this;return n._layoutStyleMap=new Map,n._paintStyleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=o.nanoid(),n._layer=new P(l({id:"symbol-point-".concat(n._id),type:"symbol",layerCursor:"pointer",data:e.data},n._getStyle(e.style))),n._key=null!==(i=e.key)&&void 0!==i?i:"id",n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(e.data),n._highlightTrigger=null===(r=e.highlightOptions)||void 0===r?void 0:r.trigger,e.highlightOptions&&n._initHighlight(e.style,e.highlightOptions.style),L(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},i.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:null},i.prototype._initHighlight=function(t,e){var i=this;Object.keys(j).forEach((function(o){var r,n=e[o];void 0!==n&&i._layoutStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:j[o]])})),Object.keys(V).forEach((function(o){var r,n=e[o];void 0!==n&&i._paintStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:V[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){E.includes(o)?i[o]=t[o]:B.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},i.prototype._getPoint=function(t){return{data:l({},t.properties),lngLat:new e.LngLat(t.geometry.coordinates[0],t.geometry.coordinates[1])}},i.prototype._onClick=function(t){var e,i=this,o=t.features[0];if(this.fire("click",l(l({},this._getPoint(o)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return i._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var r=o.properties[this._key];this._clickHighlightPropVal!==r&&(this._clickHighlightPropVal=r,this._setHighlight())}},i.prototype._onMouseMove=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",l(l({},this._getPoint(i)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var o=t.features[0].properties[this._key];this._hoverHighlightPropVal!==o&&(this._hoverHighlightPropVal=o,this._setHighlight())}},i.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",l(l({},this._getPoint(i)),{originalMapEvent:t}))},i.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._paintStyleMap.forEach((function(i,o){e[o]=u(["case",t],i,!0)})),this._layoutStyleMap.forEach((function(e,o){i[o]=u(["case",t],e,!0)})),i["symbol-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i}(e.Evented),A=function(t){function i(e){var i,o=t.call(this)||this;return o._key=null!==(i=e.key)&&void 0!==i?i:"id",o._data=e.data,o._fitBoundsOptions=o._getFitBoundsOptions(e.fitBoundsOptions),o._setLngLatBounds(e.data),o._markerOptions=e.markerOptions?l(l({},e.markerOptions),{draggable:!1}):{},o._markerMap=new Map,o._init(),o}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){var e=this;return t===this._map||(this.remove(),this._map=t,this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._markerMap.forEach((function(t){t.remove()})),this._map=void 0),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.setData=function(t){var e=this;return this._data=t,this._setLngLatBounds(t),this._clear(),this._init(),this._map&&(this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._clear=function(){this._markerMap.forEach((function(t){t.remove()})),this._markerMap.clear()},i.prototype._getFeature=function(t){var e=this;return this._data.features.find((function(i){var o;return(null===(o=i.properties)||void 0===o?void 0:o[e._key])===t}))},i.prototype._getElement=function(t,e){return"function"==typeof t?t(e):t.cloneNode(!0)},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:void 0},i.prototype._init=function(){var t=this;this._data.features.forEach((function(i){var o,r,n=l(l({},t._markerOptions),{element:(null===(o=t._markerOptions)||void 0===o?void 0:o.element)?t._getElement(t._markerOptions.element,i.properties):void 0}),s=new e.Marker(n).setLngLat(i.geometry.coordinates);t._setMarkerEvent(s,i.properties),t._markerMap.set(null===(r=i.properties)||void 0===r?void 0:r[t._key],s)}))},i.prototype._setMarkerEvent=function(t,e){var i=this,o=t.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i.fire("click",{lngLat:t.getLngLat(),data:JSON.parse(JSON.stringify(e))}),o.stopPropagation()}))},i}(e.Evented),R={"line-color":"#000000","line-width":1,"line-blur":0,"line-opacity":1,"line-gap-width":0},N=function(t){function i(e){var i,r,n=t.call(this)||this;return n._lngLatBounds=null,n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._key=null!==(i=e.key)&&void 0!==i?i:"id",n._id=o.nanoid(),n._layer=new P(l({id:"line-layer-".concat(n._id),type:"line",layerCursor:"pointer",data:e.data},n._getStyle(e.style))),n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(e.data),n._highlightTrigger=null===(r=e.highlightOptions)||void 0===r?void 0:r.trigger,e.highlightOptions&&n._initHighlight(e.style,e.highlightOptions.style),L(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],n),n}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},i.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},i.prototype.fitTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);o&&this._map.fitBounds(new e.LngLatBounds(n.bboxPolygon(n.bbox(o)).bbox),i||{})},i.prototype.easeTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=n.getCoord(n.centroid(o)),s=new e.LngLat(r[0],r[1]);this._map.easeTo(l(l({},i),{center:s}))}return this},i.prototype.flyTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=n.getCoord(n.centroid(o)),s=new e.LngLat(r[0],r[1]);this._map.flyTo(l(l({},i||{}),{center:s}))}return this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._getFeature=function(t){return this._layer.queryFeatureFormData(this._key,t)},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:null},i.prototype._initHighlight=function(t,e){var i=this;Object.keys(R).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:R[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){C.includes(o)?i[o]=t[o]:O.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},i.prototype._onClick=function(t){var i,o=null===(i=t.features)||void 0===i?void 0:i[0],r=this._getFeature(o.properties[this._key]),s=n.getCoord(n.centroid(r)),a=new e.LngLat(s[0],s[1]),h=n.bboxPolygon(n.bbox(r)).bbox;if(this.fire("click",{center:a,data:l({},o.properties),lngLatBounds:new e.LngLatBounds(h),originalMapEvent:t}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var u=o.properties[this._key];this._clickHighlightPropVal!==u&&(this._clickHighlightPropVal=u,this._setHighlight())}},i.prototype._onMouseMove=function(t){var i,o,r,s=null===(i=t.features)||void 0===i?void 0:i[0],a=this._getFeature(s.properties[this._key]),h=n.getCoord(n.centroid(a)),u=new e.LngLat(h[0],h[1]);if(this.fire("mousemove",{center:u,data:l({},s.properties),lngLat:t.lngLat,originalMapEvent:t}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var p=null===(r=null===(o=t.features)||void 0===o?void 0:o[0].properties)||void 0===r?void 0:r[this._key];this._hoverHighlightPropVal!==p&&(this._hoverHighlightPropVal=p,this._setHighlight())}},i.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._onMouseEnter=function(t){var i,o=null===(i=t.features)||void 0===i?void 0:i[0],r=this._getFeature(o.properties[this._key]),s=n.getCoord(n.centroid(r)),a=new e.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:l({},o.properties),lngLat:t.lngLat,originalMapEvent:t})},i.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=u(["case",t],i,!0)})),i["line-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i}(e.Evented),z=["fill-opacity","fill-color","fill-pattern"],$=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray","stroke-pattern"],q={"stroke-opacity":1,"stroke-pattern":"","stroke-color":"#000000","stroke-width":1,"stroke-blur":0},G={"fill-opacity":1,"fill-pattern":"","fill-color":"#000000"},W=function(t){function i(e){var i,r,n,s,a=t.call(this)||this;return a._strokePaintStyleMap=new Map,a._strokeLayoutStyleMap=new Map,a._fillPaintStyleMap=new Map,a._fillLayoutStyleMap=new Map,a._expressionMap=new Map,a._id=o.nanoid(),a._fillLayer=new P({id:"polygon-fill-".concat(a._id),type:"fill",layerCursor:"pointer",data:e.data,paint:a._getFillPaint(e.style),layout:{visibility:"visible","fill-sort-key":null!==(i=null==e?void 0:e.style["sort-key"])&&void 0!==i?i:1}}),a._strokeLayer=new P({id:"polygon-stroke-".concat(a._id),type:"line",data:e.data,paint:a._getStrokePaint(e.style),layout:{visibility:"visible","line-sort-key":null!==(r=null==e?void 0:e.style["sort-key"])&&void 0!==r?r:1}}),a._key=null!==(n=e.key)&&void 0!==n?n:"id",a._fitBoundsOptions=a._getFitBoundsOptions(e.fitBoundsOptions),a._setLngLatBounds(e.data),a._highlightTrigger=null===(s=e.highlightOptions)||void 0===s?void 0:s.trigger,e.highlightOptions&&a._initHighlight(e.style,e.highlightOptions.style),L(["_onMouseClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],a),a}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._fillLayer.addTo(t),this._strokeLayer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._fillLayer.remove(),this._strokeLayer.remove(),this.removeHighlight(),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){return this._setLngLatBounds(t),this._fillLayer.setData(t),this._strokeLayer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},i.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},i.prototype.fitTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);o&&this._map.fitBounds(new e.LngLatBounds(n.bboxPolygon(n.bbox(o)).bbox),i||{})},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=n.getCoord(n.centroid(i));this._map.easeTo(l(l({},e),{center:[o[0],o[1]]}))}return this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=n.getCoord(n.centroid(i));this._map.flyTo(l(l({},e||{}),{center:[o[0],o[1]]}))}return this},i.prototype.fitBounds=function(t){var e;this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{}))},i.prototype._getFeature=function(t){return this._fillLayer.queryFeatureFormData(this._key,t)},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:null},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getFillPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){z.includes(i)&&(e[i]=t[i])})),e},i.prototype._getStrokePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){$.includes(i)&&(e[i.replace("stroke","line")]=t[i])})),e},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._fillLayer[t]("click",this._onMouseClick),this._fillLayer[t]("mousemove",this._onMouseMove),this._fillLayer[t]("mouseleave",this._onMouseLeave),this._fillLayer[t]("mouseenter",this._onMouseEnter)},i.prototype._onMouseClick=function(t){var i=t.features[0],o=this._getFeature(i.properties[this._key]),r=n.getCoord(n.centroid(o)),s=new e.LngLat(r[0],r[1]),a=n.bboxPolygon(n.bbox(o)).bbox;if(this.fire("click",{center:s,data:l({},i.properties),lngLatBounds:new e.LngLatBounds(a),originalMapEvent:t}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var h=i.properties[this._key];this._clickHighlightPropVal!==h&&(this._clickHighlightPropVal=h,this._setHighlight())}},i.prototype._onMouseMove=function(t){var i,o=null===(i=t.features)||void 0===i?void 0:i[0],r=this._getFeature(o.properties[this._key]),s=n.getCoord(n.centroid(r)),a=new e.LngLat(s[0],s[1]);if(this.fire("mousemove",{center:a,data:l({},o.properties),lngLat:t.lngLat,originalMapEvent:t}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var h=t.features[0].properties[this._key];this._hoverHighlightPropVal!==h&&(this._hoverHighlightPropVal=h,this._setHighlight())}},i.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._onMouseEnter=function(t){var i,o=null===(i=t.features)||void 0===i?void 0:i[0],r=this._getFeature(o.properties[this._key]),s=n.getCoord(n.centroid(r)),a=new e.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:l({},o.properties),lngLat:t.lngLat,originalMapEvent:t})},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);this._strokePaintStyleMap.forEach((function(e,i){o[i]=u(["case",t],e,!0)})),this._strokeLayoutStyleMap.forEach((function(e,i){r[i]=u(["case",t],e,!0)})),this._fillPaintStyleMap.forEach((function(i,o){e[o]=u(["case",t],i,!0)})),this._fillLayoutStyleMap.forEach((function(e,o){i[o]=u(["case",t],e,!0)})),this._fillLayer.setStyle({paint:e,layout:i}),this._strokeLayer.setStyle({paint:o,layout:r})},i.prototype._initHighlight=function(t,e){var i,o,r=this;Object.keys(q).forEach((function(i){var o,n=e[i];void 0!==n&&r._strokePaintStyleMap.set(i.replace("stroke","line"),[n,null!==(o=t[i])&&void 0!==o?o:q[i]])})),Object.keys(G).forEach((function(i){var o,n=e[i];void 0!==n&&r._fillPaintStyleMap.set(i,[n,null!==(o=t[i])&&void 0!==o?o:G[i]])}));var n=e["sort-key"];void 0!==n&&(this._strokeLayoutStyleMap.set("line-sort-key",[n,null!==(i=t["sort-key"])&&void 0!==i?i:1]),this._fillLayoutStyleMap.set("fill-sort-key",[n,null!==(o=t["sort-key"])&&void 0!==o?o:1]));var s="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",r._key],null!==(t=r._hoverHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s],["==",["get",r._key],null!==(e=r._hoverHighlightPropVal)&&void 0!==e?e:s]]}))},i}(e.Evented),Z=function(t){function e(e){var i,r,n=t.call(this)||this;return n._id=o.nanoid(),n._sourceAndLayerId="heatmap-layer-".concat(n._id),n._data=e.data,n._styleOptions=e.style,n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(),n._minZoom=null!==(i=e.minZoom)&&void 0!==i?i:0,n._maxZoom=null!==(r=e.maxZoom)&&void 0!==r?r:24,L(["_onData"],n),n}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addSourceAndLayer(),this._map.on("data",this._onData),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.remove=function(){return this._map&&(this._map.off("data",this._onData),this._map.removeLayer(this._sourceAndLayerId),this._map.removeSource(this._sourceAndLayerId),this._map=void 0),this},e.prototype.setData=function(t){(this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this._sourceAndLayerId).setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions));return this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAndLayer()}),10)},e.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?n.bboxPolygon(n.bbox(this._data)).bbox:void 0},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._addSourceAndLayer=function(){var t;this._map&&(this._map.getLayer(this._sourceAndLayerId)||this._map.addLayer({id:this._sourceAndLayerId,type:"heatmap",minzoom:this._minZoom,maxzoom:this._maxZoom,source:{type:"geojson",data:this._data},paint:null!==(t=this._styleOptions)&&void 0!==t?t:{}}))},e}(e.Evented),U=function(t){function i(e){var i,o,r=t.call(this)||this;return r._pointMap=new Map,r._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,r._removeOnClick=null!==(o=null==e?void 0:e.removeOnClick)&&void 0!==o&&o,r._markerOptions=null==e?void 0:e.markerOptions,L(["_onMapClick"],r),r}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._map.getCanvas().style.cursor="crosshair",this._map.on("click",this._onMapClick)),this},i.prototype.remove=function(){return this._map&&(this.removePoints(),this._map.getCanvas().style.cursor="",this._map.off("click",this._onMapClick),this._map=void 0),this},i.prototype.setPoint=function(t){var i,r;if(!this._map)return this;this._multiple||this.removePoints();var n=o.nanoid(),s=this._markerOptions?l(l({},this._markerOptions),{draggable:!1,element:null!==(r=null===(i=this._markerOptions.element)||void 0===i?void 0:i.cloneNode())&&void 0!==r?r:void 0}):{},a=new e.Marker(s).setLngLat(t).addTo(this._map);return this._setMarkerEvent(n,a),this._pointMap.set(n,{lngLat:a.getLngLat(),marker:a}),this},i.prototype.getPoints=function(){return Array.from(this._pointMap).map((function(t){return t[1].lngLat.toArray()}))},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._onMapClick=function(t){this.setPoint(t.lngLat),this.fire("get-point",{point:t.lngLat.toArray(),pointList:this.getPoints()})},i.prototype._setMarkerEvent=function(t,e){var i=this,o=e.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i._removeOnClick?(e.remove(),i._pointMap.delete(t),i.fire("remove-point",{point:e.getLngLat().toArray(),pointList:i.getPoints()})):i.fire("click-point",{point:e.getLngLat().toArray()}),o.stopPropagation()}))},i.prototype.removePoints=function(){this._pointMap.forEach((function(t){t.marker.remove()})),this._pointMap.clear()},i}(e.Evented),Y=["line-opacity","line-color","line-width","line-blur","line-dasharray"],K=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],J=function(t){function e(e){var i,r,n=t.call(this)||this;return n._id=o.nanoid(),n._initState(),n._initStyle(null==e?void 0:e.style),n._initFinishedStyle(null==e?void 0:e.finishedStyle),n._enableBackspace=null!==(i=null==e?void 0:e.enableBackspace)&&void 0!==i&&i,n._enableEnter=null!==(r=null==e?void 0:e.enableEnter)&&void 0!==r&&r,L(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],n),n}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished?n.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._lineLayer)||void 0===i||i.remove(),this._vertexLayer=new P({id:"line-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._lineLayer=new P({id:"line-picker-line-".concat(this._id),type:"line",data:this._getLineSourceData(),paint:t.line}),null===(o=this._lineLayer)||void 0===o||o.addTo(this._map),null===(r=this._vertexLayer)||void 0===r||r.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){Y.includes(o)?i[o]=t[o]:K.includes(o)&&(e[o.replace("vertex","circle")]=t[o])})),{line:i,vertex:e}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={line:l(l({},k),e.line),vertex:l(l(l({},b),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={line:l(l(l({},this._style.line),{"line-dasharray":[1,0]}),e.line),vertex:l(l({},this._style.vertex),e.vertex)}},e.prototype._initState=function(){this._data=null,this._vertexList=[],this._lineCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!1,this._preFinishedOnVertex=!1,this._mouseOnVertex=!1},e.prototype._removeLayer=function(){var t,e;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._lineLayer)||void 0===e||e.remove(),this._vertexLayer=void 0,this._lineLayer=void 0},e.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateLine=function(){var t;this._data=this._getLineSourceData(),null===(t=this._lineLayer)||void 0===t||t.setData(n.clone(this._data))},e.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},e.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},e.prototype._getIndex=function(t,e){return t.findIndex((function(t){return n.booleanEqual(n.point(t),n.point(e))}))},e.prototype._handleMouseMove=function(t){this._lineCoordinates=u([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,this._preFinishedOnVertex=!1,-1===e?(this._lineCoordinates.push(t),this._preFinished=!0):this._vertexList.length>1&&(e===this._vertexList.length-2||e===this._vertexList.length-1?this._preFinished=!0:(this._lineCoordinates.push(t),0===e?this._preFinished=!0:this._preFinishedOnVertex=!0)),this._updateLine()},e.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},e.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?this._vertexList=u([],this._lineCoordinates,!0):(this._picking=!0,this._vertexList=[t.lngLat.toArray()],this._lineCoordinates=u([],this._vertexList,!0)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateLine(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},e.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:n.clone(this._data),length:n.length(this._data,{units:"meters"})})},e.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},e.prototype._enterComplete=function(){!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&(this._vertexList=u([],this._lineCoordinates,!0),this._complete())},e.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&this._complete()},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e.prototype._getVertexSourceData=function(){return n.featureCollection(this._vertexList.map((function(t,e){return n.point(t,{id:e})})))},e.prototype._getLineSourceData=function(){return this._lineCoordinates.length>1?n.lineString(this._lineCoordinates):n.featureCollection([])},e}(e.Evented),X=["fill-opacity","fill-color"],Q=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],tt=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],et=function(t){function e(e){var i,r,n=t.call(this)||this;return n._id=o.nanoid(),n._initState(),n._initStyle(null==e?void 0:e.style),n._initFinishedStyle(null==e?void 0:e.finishedStyle),n._enableBackspace=null!==(i=null==e?void 0:e.enableBackspace)&&void 0!==i&&i,n._enableEnter=null!==(r=null==e?void 0:e.enableEnter)&&void 0!==r&&r,L(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],n),n}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished?n.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._fillLayer=new P({id:"polygon-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new P({id:"polygon-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._vertexLayer=new P({id:"polygon-area-picker-vertex-".concat(this._id),type:"circle",data:this._getVertexSourceData(),layerCursor:"pointer",mapCursor:"crosshair",paint:t.vertex}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){X.includes(r)?o[r]=t[r]:Q.includes(r)?i[r.replace("stroke","line")]=t[r]:tt.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:l(l({},this._style.fill),e.fill),stroke:l(l(l({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:l(l({},this._style.vertex),e.vertex)}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:l(l({},M),e.fill),stroke:l(l({},k),e.stroke),vertex:l(l(l({},b),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initState=function(){this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!0,this._mouseOnVertex=!1},e.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},e.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},e.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},e.prototype._getIndex=function(t,e){return t.findIndex((function(t){return n.booleanEqual(n.point(t),n.point(e))}))},e.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?(this._vertexList=u([],this._strokeCoordinates,!0),this._strokeCoordinates=u([],this._fillCoordinates,!0)):(this._picking=!0,this._vertexList.push(t.lngLat.toArray()),this._strokeCoordinates=u([],this._vertexList,!0),this._fillCoordinates=u(u([],this._vertexList,!0),[this._vertexList[0]],!1)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateStroke(),this._updateFill(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},e.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&this._preFinished&&this._complete()},e.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},e.prototype._handleMouseMove=function(t){this._strokeCoordinates=u([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,-1===e?(this._strokeCoordinates.push(t),this._fillCoordinates=u(u([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1),this._vertexList.length>1&&(this._preFinished=!0)):this._vertexList.length>2?e===this._vertexList.length-1?(this._preFinished=!0,this._fillCoordinates=u(u([],this._strokeCoordinates,!0),[this._vertexList[0]],!1)):0===e?(this._preFinished=!0,this._strokeCoordinates.push(t),this._fillCoordinates=u([],this._strokeCoordinates,!0)):(this._preFinished=!0,this._fillCoordinates=u(u([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1)):this._fillCoordinates=u([],this._strokeCoordinates,!0),this._updateStroke(),this._updateFill()},e.prototype._enterComplete=function(){!this._finished&&this._picking&&this._preFinished&&(this._vertexList=u([],this._strokeCoordinates,!0),this._strokeCoordinates=u([],this._fillCoordinates,!0),this._complete())},e.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:n.clone(this._data),acreage:n.area(this._data)})},e.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(n.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e.prototype._getVertexSourceData=function(){return n.featureCollection(this._vertexList.map((function(t,e){return n.point(t,{id:e})})))},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?n.lineString(this._strokeCoordinates):n.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?n.combine(n.unkinkPolygon(n.polygon([this._fillCoordinates]))).features[0]:n.featureCollection([])},e}(e.Evented),it=["fill-opacity","fill-color"],ot=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],rt=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],nt=function(t){function e(e){var i=t.call(this)||this;return i._id=o.nanoid(),i._initState(),i._initStyle(null==e?void 0:e.style),i._initFinishedStyle(null==e?void 0:e.finishedStyle),L(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],i),i}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished&&this._data?n.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._vertexLayer=new P({id:"rect-area-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._strokeLayer=new P({id:"rect-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._fillLayer=new P({id:"rect-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){it.includes(r)?o[r]=t[r]:ot.includes(r)?i[r.replace("stroke","line")]=t[r]:rt.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:l(l({},M),e.fill),stroke:l(l({},k),e.stroke),vertex:l(l(l({},b),e.vertex),{"circle-pitch-alignment":"map"})}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:l(l({},this._style.fill),e.fill),stroke:l(l(l({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:l(l({},this._style.vertex),e.vertex)}},e.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._initState=function(){this._nw=null,this._se=null,this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},e.prototype._getVertexSourceData=function(){return n.featureCollection(this._vertexList.map((function(t,e){return n.point(t,{id:e})})))},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?n.lineString(this._strokeCoordinates):n.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?n.polygon([this._fillCoordinates]):n.featureCollection([])},e.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},e.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._nw=t.lngLat.toArray(),t.preventDefault())},e.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._vertexList.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:n.clone(this._data),acreage:n.area(this._data)})))},e.prototype._onMapDoubleClick=function(t){t.preventDefault()},e.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){this._se=t.lngLat.toArray();var e=n.bboxPolygon(n.bbox(n.lineString([this._nw,this._se])));0===n.area(e)?(this._fillCoordinates=[],this._strokeCoordinates=[],this._vertexList=[]):(this._fillCoordinates=u([],e.geometry.coordinates[0],!0),this._strokeCoordinates=u([],this._fillCoordinates,!0),this._vertexList=this._fillCoordinates.slice(0,-1)),this._updateVertex(),this._updateStroke(),this._updateFill()}},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(n.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e}(e.Evented),st=["fill-opacity","fill-color"],at=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],ht=function(t){function e(e){var i=t.call(this)||this;return i._id=o.nanoid(),i._initState(),i._initStyle(null==e?void 0:e.style),i._initFinishedStyle(null==e?void 0:e.finishedStyle),i._steps=(null==e?void 0:e.steps)||64,L(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],i),i}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},e.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},e.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},e.prototype.getData=function(){return this._finished&&this._data?n.clone(this._data):null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._removeLayer=function(){var t,e;null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),this._strokeLayer=void 0,this._fillLayer=void 0},e.prototype._initState=function(){this._center=null,this._radius=null,this._data=null,this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},e.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){st.includes(o)?i[o]=t[o]:at.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),{fill:i,stroke:e}},e.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:l(l({},this._style.fill),e.fill),stroke:l(l(l({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke)}},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:l(l({},M),e.fill),stroke:l(l({},k),e.stroke)}},e.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._fillLayer=new P({id:"circle-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new P({id:"circle-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),null===(o=this._fillLayer)||void 0===o||o.addTo(this._map),null===(r=this._strokeLayer)||void 0===r||r.addTo(this._map)},e.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?n.featureCollection([n.lineString(this._strokeCoordinates)]):n.featureCollection([])},e.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?n.polygon([this._fillCoordinates]):n.featureCollection([])},e.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},e.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._center=t.lngLat.toArray(),t.preventDefault())},e.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._fillCoordinates.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:n.clone(this._data),center:u([],this._center,!0),radius:this._radius,acreage:n.area(this._data)})))},e.prototype._onMapDoubleClick=function(t){t.preventDefault()},e.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){var e={units:"kilometers"};this._radius=n.distance(this._center,t.lngLat.toArray(),e);var i=n.circle(this._center,this._radius,l(l({},e),{steps:this._steps}));0===n.area(i)?(this._fillCoordinates=[],this._strokeCoordinates=[]):(this._fillCoordinates=u([],i.geometry.coordinates[0],!0),this._strokeCoordinates=u([],this._fillCoordinates,!0)),this._updateStroke(),this._updateFill()}},e.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},e.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(n.clone(this._data))},e.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},e}(e.Evented),lt={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},ut={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},pt=["fill-opacity","fill-color"],ct=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],_t=["meters","kilometers"],dt=function(t){function e(e){var i,r=t.call(this)||this;return r._id=o.nanoid(),r._center=null==e?void 0:e.center,r._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:5,r._units=(null==e?void 0:e.units)&&_t.includes(e.units)?e.units:"kilometers",r._steps=(null==e?void 0:e.steps)&&e.steps>2?e.steps:64,r._manual=null!==(i=e.manual)&&void 0!==i&&i,r._initData(),r._initStyle(e.style),r._initLayer(e.centerLayer?l({show:!0,type:"circle"},e.centerLayer):{show:!0,type:"circle"}),L(["_onMapClick"],r),r}return a(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){var e,i,o;return t===this._map||(this.remove(),this._map=t,null===(e=this._strokeLayer)||void 0===e||e.addTo(t).setData(this._bufferData),null===(i=this._fillLayer)||void 0===i||i.addTo(t).setData(this._bufferData),null===(o=this._centerLayer)||void 0===o||o.addTo(t).setData(this._centerData),this._manual&&(this._map.on("click",this._onMapClick),this._map.getCanvas().style.cursor="crosshair")),this},e.prototype.remove=function(){var t,e,i;return this._map&&(null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),null===(i=this._centerLayer)||void 0===i||i.remove(),this._manual&&(this._map.off("click",this._onMapClick),this._map.getCanvas().style.cursor=""),this._map=void 0),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype.clear=function(){return this._center=void 0,this._update(),this},e.prototype.setOptions=function(t){return t.center&&(this._center=t.center),t.radius&&(this._radius=t.radius),t.units&&_t.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>2&&(this._steps=t.steps),this._update(),this},e.prototype.getData=function(){return this._center?n.clone(this._bufferData):null},e.prototype._initStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);Object.keys(t).forEach((function(o){pt.includes(o)?i[o]=t[o]:ct.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),this._style={fill:i,stroke:e}},e.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){S.includes(i)&&(e[i]=t[i])})),e},e.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){E.includes(o)?i[o]=t[o]:B.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._initLayer=function(t){var e,i;this._fillLayer=new P({id:"buffer-fill-".concat(this._id),type:"fill",paint:this._style.fill}),this._strokeLayer=new P({id:"buffer-stroke-".concat(this._id),type:"line",paint:this._style.stroke}),t.show&&"symbol"!==t.type&&(this._centerLayer=new P({id:"buffer-center-".concat(this._id),type:"circle",paint:this._getCirclePaint(l(l({},lt),null!==(e=null==t?void 0:t.style)&&void 0!==e?e:{}))})),t.show&&"symbol"===t.type&&(this._centerLayer=new P(l({id:"buffer-center-".concat(this._id),type:"symbol"},this._getSymbolStyle(l(l({},ut),null!==(i=t.style)&&void 0!==i?i:{})))))},e.prototype._onMapClick=function(t){this._center=t.lngLat.toArray(),this._update(),this.fire("change",{center:t.lngLat,radius:this._radius,units:this._units,buffer:n.clone(this._bufferData)})},e.prototype._update=function(){var t,e,i;this._initData(),null===(t=this._fillLayer)||void 0===t||t.setData(this._bufferData),null===(e=this._strokeLayer)||void 0===e||e.setData(this._bufferData),null===(i=this._centerLayer)||void 0===i||i.setData(this._centerData)},e.prototype._initData=function(){this._center?(this._centerData=n.point(this._center),this._bufferData=n.circle(this._center,this._radius,{units:this._units,steps:this._steps})):(this._centerData=n.featureCollection([]),this._bufferData=n.featureCollection([]))},e}(e.Evented),gt={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},ft=function(t){function i(e){var i,r,n=t.call(this)||this;return n._styleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=o.nanoid(),n._layerId="circle-cluster-layer-point-".concat(n._id),n._clusterLayerId="circle-cluster-layer-cluster-".concat(n._id),n._clusterLabelLayerId="circle-cluster-label-layer-cluster-".concat(n._id),n._key=null!==(i=e.key)&&void 0!==i?i:"id",n._data=e.data,n._styleOptions=e.style,n._clusterStyleOptions=e.clusterStyle,n._clusterRadius=null!==(r=e.clusterRadius)&&void 0!==r?r:250,n._highlightOptions=e.highlightOptions,n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(),n._highlightOptions&&n._initHighlight(),L(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_OnData"],n),n}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},i.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},i.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},i.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?n.bboxPolygon(n.bbox(this._data)).bbox:null},i.prototype._initHighlight=function(){var t=this;Object.keys(gt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._styleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:gt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._addLayerAndSource=function(){var t;if(this._map){this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50});var e=this._getStyle(this._clusterStyleOptions),i=e.textStyle,o=e.circleStyle;this._map.getLayer(this._clusterLayerId)||this._map.addLayer(l({id:this._clusterLayerId,type:"circle",source:this._layerId,filter:["has","cluster_id"]},o)),this._map.getLayer(this._clusterLabelLayerId)||this._map.addLayer(l({id:this._clusterLabelLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},i)),this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:"circle",source:this._layerId,filter:["!",["has","cluster_id"]],paint:this._getPaint(this._styleOptions),layout:{visibility:"visible"}}),this._highlightOptions&&this._setHighlight()}},i.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){S.includes(i)&&(e[i]=t[i])})),e},i.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);return Object.keys(t).forEach((function(r){F.includes(r)?i[r]=t[r]:T.includes(r)?e[r]=t[r]:S.includes(r)&&(o[r]=t[r])})),i.visibility="visible",r.visibility="visible",{textStyle:{paint:e,layout:i},circleStyle:{paint:o,layout:r}}},i.prototype._OnData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._OnData)},i.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},i.prototype._getPoint=function(t){return{data:l({},t.properties),lngLat:new e.LngLat(t.geometry.coordinates[0],t.geometry.coordinates[1])}},i.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",l(l({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},i.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",l(l({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},i.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",l(l({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},i.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._styleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,u(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"circle-sort-key",["case",e,2,0])},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i.prototype._removeLayerAndSource=function(){var t,e,i,o;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getLayer(this._clusterLabelLayerId))&&this._map.removeLayer(this._clusterLabelLayerId),(null===(o=this._map)||void 0===o?void 0:o.getSource(this._layerId))&&this._map.removeSource(this._layerId)},i}(e.Evented),yt={"icon-image":"","icon-size":1,"icon-offset":[0,0],"text-field":"","text-size":16,"text-offset":[0,0]},vt={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},mt=function(t){function i(e){var i,r,n=t.call(this)||this;return n._layoutStyleMap=new Map,n._paintStyleMap=new Map,n._clickHighlightPropVal=void 0,n._hoverHighlightPropVal=void 0,n._expressionMap=new Map,n._id=o.nanoid(),n._layerId="symbol-cluster-layer-point-".concat(n._id),n._clusterLayerId="symbol-cluster-layer-cluster-".concat(n._id),n._key=null!==(i=e.key)&&void 0!==i?i:"id",n._data=e.data,n._styleOptions=e.style,n._clusterStyleOptions=e.clusterStyle,n._clusterRadius=null!==(r=e.clusterRadius)&&void 0!==r?r:250,n._highlightOptions=e.highlightOptions,n._fitBoundsOptions=n._getFitBoundsOptions(e.fitBoundsOptions),n._setLngLatBounds(),n._highlightOptions&&n._initHighlight(),L(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_onData"],n),n}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},i.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},i.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},i.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?n.bboxPolygon(n.bbox(this._data)).bbox:null},i.prototype._initHighlight=function(){var t=this;Object.keys(yt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._layoutStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:yt[e]])})),Object.keys(vt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._paintStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:vt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50}),this._map.getLayer(this._clusterLayerId)||this._map.addLayer(l({id:this._clusterLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},this._getStyle(this._clusterStyleOptions))),this._map.getLayer(this._layerId)||this._map.addLayer(l({id:this._layerId,type:"symbol",source:this._layerId,filter:["!",["has","cluster_id"]]},this._getStyle(this._styleOptions))),this._highlightOptions&&this._setHighlight())},i.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){E.includes(o)?i[o]=t[o]:B.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._onData)},i.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},i.prototype._getPoint=function(t){return{data:l({},t.properties),lngLat:new e.LngLat(t.geometry.coordinates[0],t.geometry.coordinates[1])}},i.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",l(l({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},i.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",l(l({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},i.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",l(l({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},i.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._paintStyleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,u(["case",e],i,!0))})),this._layoutStyleMap.forEach((function(i,o){t._map.setLayoutProperty(t._layerId,o,u(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"symbol-sort-key",["case",e,2,0])},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i.prototype._removeLayerAndSource=function(){var t,e,i;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getSource(this._layerId))&&this._map.removeSource(this._layerId)},i}(e.Evented),Lt={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},bt={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},kt={"line-width":5,"line-color":"#f00","line-cap":"round","line-join":"round"},Mt={"line-width":5,"line-color":"#0f0","line-cap":"round","line-join":"round"},xt=function(t){function e(e){var i,r,s,a,h=t.call(this)||this;return h._id=o.nanoid(),h._data=e.data,h._isFull=null===(r=null===(i=e.pathLayer)||void 0===i?void 0:i.isFull)||void 0===r||r,h._units="kilometers",h._speed=null!==(s=e.speed)&&void 0!==s?s:5,h._loop=null===(a=e.loop)||void 0===a||a,h._originPathLayerData=n.lineString(h._data),h._initLength(),h._initState(),h._layerOptions={carLayer:e.carLayer?l({show:!1,type:"circle"},e.carLayer):{show:!1,type:"circle"},currentPathLayer:e.currentPathLayer?l({show:!0},e.currentPathLayer):{show:!0},pathLayer:e.pathLayer?l({show:!0},e.pathLayer):{show:!0}},h._fitBoundsOptions=h._getFitBoundsOptions(e.fitBoundsOptions),h._lngLatBounds=n.bboxPolygon(n.bbox(h._originPathLayerData)).bbox,L(["_animate"],h),h}return a(e,t),Object.defineProperty(e.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.remove=function(){var t,e,i;return this._map&&(cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._pathLayer)||void 0===t||t.remove(),null===(e=this._currentPathLayer)||void 0===e||e.remove(),null===(i=this._carLayer)||void 0===i||i.remove(),this._map=void 0),this},e.prototype.setSpeed=function(t){return this._speed=t,this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype.stop=function(){var t,e,i;cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._carLayer)||void 0===t||t.setData(this._carLayerData),null===(e=this._currentPathLayer)||void 0===e||e.setData(n.featureCollection([])),this._isFull||null===(i=this._pathLayer)||void 0===i||i.setData(this._originPathLayerData)},e.prototype.play=function(){this._isPlaying||(this._finished&&this._initState(),this._isPlaying=!0,this._fRecord=requestAnimationFrame(this._animate))},e.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,cancelAnimationFrame(this._fRecord),this._pending=!0)},e.prototype.replay=function(){cancelAnimationFrame(this._fRecord),this._initState(),this.play()},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},e.prototype._initState=function(){this._current=0,this._isPlaying=!1,this._startTime=0,this._finished=!1,this._currentLength=0,this._pending=!1,this._bearing=n.bearing(n.point(this._data[0]),n.point(this._data[1])),this._carLayerData=n.point(this._data[0],{bearing:this._bearing}),this._currentPathLayerData=void 0},e.prototype._initLength=function(){var t=this;this._pointLength=[];var e=0;this._data.forEach((function(i,o){if(0!==o){var r=n.distance(n.point(i),n.point(t._data[o-1]),{units:t._units});e+=r}t._pointLength.push(e)})),this._routeLength=e},e.prototype._animate=function(t){var e,i,o,r;if(this._pending)return this._pending=!1,this._startTime=t,void(this._fRecord=requestAnimationFrame(this._animate));var s=void 0;if(0===this._startTime)this._startTime=t,s=this._originPathLayerData;else{var a=t-this._startTime;if(this._startTime=t,this._currentLength+=a/1e3*this._speed,this._currentLength>=this._routeLength)this._carLayerData=n.point(this._data[this._data.length-1]),this._currentLength=this._routeLength,this._finished=!0,this._currentPathLayerData=this._originPathLayerData;else{this._carLayerData=n.along(this._originPathLayerData,this._currentLength);for(var h=this._current;h<this._pointLength.length&&!(this._pointLength[h]>this._currentLength);)h++;h!==this._current&&(this._current=h,this._bearing=n.bearing(this._carLayerData,n.point(this._data[this._current]))),this._currentPathLayerData=n.lineString(u(u([],this._data.slice(0,this._current),!0),[this._carLayerData.geometry.coordinates],!1)),s=n.lineString(u([this._carLayerData.geometry.coordinates],this._data.slice(this._current),!0))}}this._carLayerData.properties={bearing:this._bearing},null===(e=this._carLayer)||void 0===e||e.setData(this._carLayerData),this._isFull||null===(i=this._pathLayer)||void 0===i||i.setData(null!=s?s:n.featureCollection([])),null===(o=this._currentPathLayer)||void 0===o||o.setData(null!==(r=this._currentPathLayerData)&&void 0!==r?r:n.featureCollection([])),this._finished&&(this._loop?(this._initState(),this._isPlaying=!0):(this._isPlaying=!1,this.fire("finish"))),this._isPlaying&&(this._fRecord=requestAnimationFrame(this._animate))},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){S.includes(i)&&(e[i]=t[i])})),e},e.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){E.includes(o)?i[o]=t[o]:B.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._getPathStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){C.includes(o)?i[o]=t[o]:O.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},e.prototype._initLayer=function(){var t,e,i,o,r,n,s,a=this._layerOptions,h=a.carLayer,u=a.currentPathLayer,p=a.pathLayer;p.show&&(this._pathLayer=new P(l({id:"car-track-full-path-".concat(this._id),type:"line",data:this._originPathLayerData},this._getPathStyle(l(l({},Mt),null!==(t=null==p?void 0:p.style)&&void 0!==t?t:{}))))),u.show&&(this._currentPathLayer=new P(l({id:"car-track-current-path-".concat(this._id),type:"line"},this._getPathStyle(l(l({},kt),null!==(e=null==u?void 0:u.style)&&void 0!==e?e:{}))))),h.show&&"symbol"!==h.type&&(this._carLayer=new P({id:"car-track-car-".concat(this._id),type:"circle",data:this._carLayerData,paint:this._getCirclePaint(l(l({},Lt),null!==(i=null==h?void 0:h.style)&&void 0!==i?i:{}))})),h.show&&"symbol"===h.type&&(this._carLayer=new P(l({id:"car-track-car-".concat(this._id),type:"symbol",data:this._carLayerData},this._getSymbolStyle(l(l({},bt),null!==(o=h.style)&&void 0!==o?o:{}))))),null===(r=this._pathLayer)||void 0===r||r.addTo(this._map),null===(n=this._currentPathLayer)||void 0===n||n.addTo(this._map),null===(s=this._carLayer)||void 0===s||s.addTo(this._map)},e}(e.Evented);function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}var Ot="object"===("undefined"==typeof HTMLElement?"undefined":Pt(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===Pt(t)&&(1===t.nodeType||9===t.nodeType)&&"string"==typeof t.nodeName};function Ct(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(arguments.length<2)){for(var i=[],o=0;o<arguments.length;o++)i.push(t[o]);var r=[];return i.forEach((function(t,e){r[e]=a.bind(null,t,i.filter((function(t,i){return i!==e})))})),n(),function(){s(),r=[],i=[]}}function n(){i.forEach((function(t,e){t.on("move",r[e])}))}function s(){i.forEach((function(t,e){t.off("move",r[e])}))}function a(t,e){s(),function(t,e){var i=t.getCenter(),o=t.getZoom(),r=t.getBearing(),n=t.getPitch();e.forEach((function(t){t.jumpTo({center:i,zoom:o,bearing:r,pitch:n})}))}(t,e),n()}}var St=function(){function t(t){if(this._removed=!1,this._horizontal=Boolean(t.horizontal),"string"==typeof t.container){var i=document.querySelector(t.container);if(!i)throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=i}else{if(!Ot(t.container))throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=t.container}this._container.classList.add("map-comparer-container"),this._container.style.position="relative";var o=document.createElement("div");o.classList.add("before-map-container"),o.style.position="absolute",o.style.width="100%",o.style.height="100%",this._container.appendChild(o);var r=document.createElement("div");r.classList.add("after-map-container"),r.style.position="absolute",r.style.width="100%",r.style.height="100%",this._container.appendChild(r),this._swiper=document.createElement("div"),this._swiper.className="comparer-swiper",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"map-comparer-control comparer-control-horizontal":"map-comparer-control comparer-control-vertical",this._controlContainer.appendChild(this._swiper),this._container.appendChild(this._controlContainer),this._firstMap=new e.Map(l(l({},t.mapOptions),{style:t.firstMapStyle,container:o})),this._secondMap=new e.Map(l(l({},t.mapOptions),{style:t.secondMapStyle,container:r})),Ct(this._firstMap,this._secondMap),L(["_onResize","_onMove","_onDown","_onTouchEnd","_onMouseUp"],this),this._secondMap.on("resize",this._onResize),this._bounds=this._secondMap.getContainer().getBoundingClientRect();var n=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(n),this._mousemove&&(this._firstMap.getContainer().addEventListener("mousemove",this._onMove),this._secondMap.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}return Object.defineProperty(t.prototype,"firstMap",{get:function(){return this._firstMap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"secondMap",{get:function(){return this._secondMap},enumerable:!1,configurable:!0}),t.prototype._onResize=function(){var t=this._horizontal?this._bounds.height:this._bounds.width,e=this.currentPosition/t;this._bounds=this._secondMap.getContainer().getBoundingClientRect(),t=this._horizontal?this._bounds.height:this._bounds.width,this._setPosition(t*e)},t.prototype._setPosition=function(t){t=Math.min(t,this._horizontal?this._bounds.height:this._bounds.width);var e=this._horizontal?"translate(0, "+t+"px)":"translate("+t+"px, 0)";this._controlContainer.style.transform=e,this._controlContainer.style.webkitTransform=e;var i=this._horizontal?"rect(0, 999em, "+t+"px, 0)":"rect(0, "+t+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+t+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+t+"px)";this._firstMap.getContainer().style.clip=i,this._secondMap.getContainer().style.clip=o,this.currentPosition=t},t.prototype._setPointerEvents=function(t){this._controlContainer.style.pointerEvents=t,this._swiper.style.pointerEvents=t},t.prototype._onMove=function(t){this._mousemove&&this._setPointerEvents(t.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(t)):this._setPosition(this._getX(t))},t.prototype._getY=function(t){var e=(t=t.touches?t.touches[0]:t).clientY-this._bounds.top;return e<0&&(e=0),e>this._bounds.height&&(e=this._bounds.height),e},t.prototype._getX=function(t){var e=(t=t.touches?t.touches[0]:t).clientX-this._bounds.left;return e<0&&(e=0),e>this._bounds.width&&(e=this._bounds.width),e},t.prototype._onTouchEnd=function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)},t.prototype._onMouseUp=function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp)},t.prototype._onDown=function(t){t.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},t.prototype.setSlider=function(t){if(!this._removed){var e=this._horizontal?this._bounds.height:this._bounds.width;t>1?t=1:t<0&&(t=0),this._setPosition(t*e)}},t.prototype.remove=function(){var t,e;this._removed||(null===(t=this._firstMap)||void 0===t||t.remove(),null===(e=this._secondMap)||void 0===e||e.remove(),this._container.innerHTML="",this._container.style.position="",this._container.classList.remove("map-comparer-container"),this._removed=!0)},t}(),Et={"fill-extrusion-opacity":1,"fill-extrusion-pattern":"","fill-extrusion-color":"#000000"},Bt=function(t){function i(e){var i,r,n,s,a=t.call(this)||this;return a._lngLatBounds=null,a._styleMap=new Map,a._clickHighlightPropVal=void 0,a._hoverHighlightPropVal=void 0,a._expressionMap=new Map,a._radius=null!==(i=e.radius)&&void 0!==i?i:10,a._steps=null!==(r=e.steps)&&void 0!==r?r:64,a._key=null!==(n=e.key)&&void 0!==n?n:"id",a._id=o.nanoid(),a._layer=new P({id:"prismoid-layer-".concat(a._id),type:"fill-extrusion",layerCursor:"pointer",data:a._transformData(e.data),paint:a._getPaint(e.style),layout:{visibility:"visible"}}),a._fitBoundsOptions=a._getFitBoundsOptions(e.fitBoundsOptions),a._setLngLatBounds(e.data),a._highlightTrigger=null===(s=e.highlightOptions)||void 0===s?void 0:s.trigger,e.highlightOptions&&a._initHighlight(e.style,e.highlightOptions.style),L(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],a),a}return a(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(this._transformData(t)),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},i.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},i.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:JSON.parse(i.properties.originCoordinates)})),this},i.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:JSON.parse(i.properties.originCoordinates)})),this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._transformData=function(t){var e=this,i=t.features.filter((function(t){return"Point"===t.geometry.type})).map((function(t){return n.circle(t.geometry.coordinates,e._radius,{units:"meters",steps:e._steps,properties:l(l({},t.properties),{originCoordinates:t.geometry.coordinates})})}));return n.featureCollection(i)},i.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},i.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?n.bboxPolygon(n.bbox(t)).bbox:null},i.prototype._initHighlight=function(t,e){var i=this;Object.keys(Et).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:Et[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){D.includes(i)&&(e[i]=t[i])})),e},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},i.prototype._getPoint=function(t){var i=t.properties,o=i.originCoordinates,r=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(i[o[r]]=t[o[r]])}return i}(i,["originCoordinates"]),n=JSON.parse(o);return{data:r,lngLat:new e.LngLat(n[0],n[1])}},i.prototype._onClick=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",l(l({},this._getPoint(i)),{originalMapEvent:t})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var o=i.properties[this._key];this._clickHighlightPropVal!==o&&(this._clickHighlightPropVal=o,this._setHighlight())}},i.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",l(l({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},i.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},i.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",l(l({},this._getPoint(i)),{originalMapEvent:t}))},i.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=u(["case",t],i,!0)})),this._layer.setStyle({paint:e,layout:i})},i.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},i}(e.Evented),Ft=["none","click","hover","manual"],Tt=function(t){function r(e){var i=t.call(this)||this;return e=m(e),i._map=null,i._lngLatBounds=null,i._highlightFeatureId=null,i._source="advance-point-layer".concat(o.nanoid()),i._key=e.key||"id",i._data=e.data,i._layerPool=e.layerPool||{},i._layers=e.layers||[],i._highlightTrigger=e.highlightTrigger&&Ft.includes(e.highlightTrigger)?e.highlightTrigger:"none",i._highlightLayers="none"===i._highlightTrigger?[]:e.highlightLayers||[],i._cluster=e.cluster||!1,i._clusterLayers=i._cluster&&e.clusterLayers||[],i._clusterRadius=e.clusterRadius,i._clusterMaxZoom=e.clusterMaxZoom,i._clusterMinPoints=e.clusterMinPoints,i._clusterProperties=e.clusterProperties,i._maxzoom=e.maxzoom,i._fitBoundsOptions=e.fitBoundsOptions||!1,i._isMouseOver=!1,i._setLngLatBounds(),L(["_onClick","_onMouseMove","_onData","_onMouseLeave"],i),i}return a(r,t),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clusterLayers",{get:function(){var t=this;return this._clusterLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-cluster")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i]),t._clusterLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-cluster")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,l({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||i.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(l(l({},e),{center:i.geometry.coordinates})),this},r.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(l(l({},e||{}),{center:i.geometry.coordinates})),this},r.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},r.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},r.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},r.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},r.prototype._getFeature=function(t){var e,o,r,n=this;if(this._data&&"string"!=typeof this._data){var s=null===(o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this.source,{filter:["==",["get",this._key],t]}))||void 0===o?void 0:o[0];return s||("FeatureCollection"===this._data.type?s=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[n._key])===t})):"Feature"===this._data.type&&(null===(r=this._data.properties)||void 0===r?void 0:r[this._key])===t&&(s=i.clone(this._data)),s)}},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,l({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?i.bboxPolygon(i.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=i.bboxPolygon(i.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(t){var i,o,r=this;if(this._map){var n=this._getEventFeature(t.point);if(n)if(this._isDefault(n)&&this._setHighlight(n.id,"click"),this._isBasic(n))this.fire("click",l(l({},this._getData(n)),{originMapEvent:t}));else if(this._isClustered(n)){this._map.getSource(this.source).getClusterLeaves(null===(i=n.properties)||void 0===i?void 0:i.cluster_id,null===(o=n.properties)||void 0===o?void 0:o.point_count,0,(function(i,o){if(!i){var s=n.geometry.coordinates;r.fire("cluster-click",{clusterLeaves:null==o?void 0:o.map((function(t){return r._getData(t)})),originMapEvent:t,lngLat:new e.LngLat(s[0],s[1])})}}))}}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return u(u([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._isClustered=function(t){return this.clusterLayers.includes(t.layer.id)},r.prototype._getData=function(t){var i=t.geometry.coordinates;return{data:l({},t.properties),lngLat:new e.LngLat(i[0],i[1])}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)],["!",i._getClusterFilter()]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t),["!",i._getClusterFilter()]])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(t){var e=this._getEventFeature(t.point);if(e&&this._isBasic(e)){var i=l(l({},this._getData(e)),{originMapEvent:t});this._isMouseOver?this.fire("mousemove",i):(this.fire("mouseenter",i),this._isMouseOver=!0),this._addCursor(),this._setHighlight(e.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:t}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-point-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-point-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-point-layer")},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i.featureCollection([]),type:"geojson",promoteId:this._key};void 0!==this._cluster&&(e.cluster=this._cluster),void 0!==this._clusterMaxZoom&&(e.clusterMaxZoom=this._clusterMaxZoom),void 0!==this._clusterMinPoints&&(e.clusterMinPoints=this._clusterMinPoints),void 0!==this._clusterProperties&&(e.clusterProperties=this._clusterProperties),void 0!==this._clusterRadius&&(e.clusterRadius=this._clusterRadius),void 0!==this._maxzoom&&(e.maxzoom=this._maxzoom),this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)],["!",t._getClusterFilter()]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId),["!",t._getClusterFilter()]]}))}})),this._cluster&&this.clusterLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),t._getClusterFilter(),null===(r=n.filter)||void 0===r||r]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._getClusterFilter=function(){return!!this._cluster&&["all",["has","cluster_id"],["==",["get","cluster"],!0]]},r.prototype._getGeometryFilter=function(){return["==",["geometry-type"],"Point"]},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),this._cluster&&this.clusterLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r}(e.Evented),Dt=["none","click","hover","manual"],Ht=function(t){function r(e){var i,r=t.call(this)||this;return e=m(e),r._map=null,r._lngLatBounds=null,r._highlightFeatureId=null,r._source="advance-line-layer".concat(o.nanoid()),r._key=e.key||"id",r._data=e.data,r._lineMetrics=null!==(i=e.lineMetrics)&&void 0!==i&&i,r._layerPool=e.layerPool||{},r._layers=e.layers||[],r._highlightTrigger=e.highlightTrigger&&Dt.includes(e.highlightTrigger)?e.highlightTrigger:"none",r._highlightLayers="none"===r._highlightTrigger?[]:e.highlightLayers||[],r._fitBoundsOptions=e.fitBoundsOptions||!1,r._isMouseOver=!1,r._setLngLatBounds(),L(["_onClick","_onMouseMove","_onData","_onMouseLeave"],r),r}return a(r,t),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,l({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(this._data||i.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,e){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=i.getCoord(i.centroid(o));this._map.easeTo(l(l({},e),{center:[r[0],r[1]]}))}return this},r.prototype.flyTo=function(t,e){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=i.getCoord(i.centroid(o));this._map.flyTo(l(l({},e||{}),{center:[r[0],r[1]]}))}return this},r.prototype.fitTo=function(t,o){if(void 0===o&&(o={}),!this._map)return this;var r=this._getFeature(t);r&&this._map.fitBounds(new e.LngLatBounds(i.bboxPolygon(i.bbox(r)).bbox),o)},r.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},r.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},r.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},r.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},r.prototype._getFeature=function(t){var e,o,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?o=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(e=this._data.properties)||void 0===e?void 0:e[this._key])===t&&(o=i.clone(this._data)),o},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,l({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?i.bboxPolygon(i.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=i.bboxPolygon(i.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-line-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-line-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-line-layer")},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(t){var o=this._getEventFeature(t.point);if(o&&(this._isDefault(o)&&this._setHighlight(o.id,"click"),this._isBasic(o))){var r=this._getFeature(o.properties[this._key]),n=r?i.getCoord(i.centroid(r)):void 0,s=l(l({},this._getData(o)),{originMapEvent:t});n&&(s.center=new e.LngLat(n[0],n[1])),r&&(s.lngLatBounds=new e.LngLatBounds(i.bboxPolygon(i.bbox(r)).bbox)),this.fire("click",l({},s))}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return u(u([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._getData=function(t){return{data:l({},t.properties)}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(t){var o=this._getEventFeature(t.point);if(o&&this._isBasic(o)){var r=this._getFeature(o.properties[this._key]),n=r?i.getCoord(i.centroid(r)):void 0,s=l(l({},this._getData(o)),{originMapEvent:t});n&&(s.center=new e.LngLat(n[0],n[1])),this._isMouseOver?this.fire("mousemove",s):(this.fire("mouseenter",s),this._isMouseOver=!0),this._addCursor(),this._setHighlight(o.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:t}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i.featureCollection([]),type:"geojson",promoteId:this._key,lineMetrics:this._lineMetrics};this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"],["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},r}(e.Evented),wt=["none","click","hover","manual"],jt=function(t){function r(e){var i=t.call(this)||this;return e=m(e),i._map=null,i._lngLatBounds=null,i._highlightFeatureId=null,i._source="advance-polygon-layer".concat(o.nanoid()),i._key=e.key||"id",i._data=e.data,i._layerPool=e.layerPool||{},i._layers=e.layers||[],i._highlightTrigger=e.highlightTrigger&&wt.includes(e.highlightTrigger)?e.highlightTrigger:"none",i._highlightLayers="none"===i._highlightTrigger?[]:e.highlightLayers||[],i._fitBoundsOptions=e.fitBoundsOptions||!1,i._isMouseOver=!1,i._setLngLatBounds(),L(["_onClick","_onMouseMove","_onData","_onMouseLeave"],i),i}return a(r,t),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),r.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},r.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},r.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,l({},t))),this},r.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||i.featureCollection([])),this.removeHighlight(),this._fitBounds());return this},r.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},r.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},r.prototype.easeTo=function(t,e){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=i.getCoord(i.centroid(o));this._map.easeTo(l(l({},e),{center:[r[0],r[1]]}))}return this},r.prototype.flyTo=function(t,e){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=i.getCoord(i.centroid(o));this._map.flyTo(l(l({},e||{}),{center:[r[0],r[1]]}))}return this},r.prototype.fitTo=function(t,o){if(void 0===o&&(o={}),!this._map)return this;var r=this._getFeature(t);r&&this._map.fitBounds(new e.LngLatBounds(i.bboxPolygon(i.bbox(r)).bbox),o)},r.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},r.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},r.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},r.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},r.prototype._getFeature=function(t){var e,o,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?o=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(e=this._data.properties)||void 0===e?void 0:e[this._key])===t&&(o=i.clone(this._data)),o},r.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,l({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},r.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?i.bboxPolygon(i.bbox(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=i.bboxPolygon(i.bbox(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},r.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},r.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._onClick=function(t){var o=this._getEventFeature(t.point);if(o&&(this._isDefault(o)&&this._setHighlight(o.id,"click"),this._isBasic(o))){var r=this._getFeature(o.properties[this._key]),n=r?i.getCoord(i.centroid(r)):void 0,s=l(l({},this._getData(o)),{originMapEvent:t});n&&(s.center=new e.LngLat(n[0],n[1])),r&&(s.lngLatBounds=new e.LngLatBounds(i.bboxPolygon(i.bbox(r)).bbox)),this.fire("click",l({},s))}},r.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},r.prototype._isBasic=function(t){return u(u([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},r.prototype._getData=function(t){return{data:l({},t.properties)}},r.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},r.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},r.prototype._onMouseMove=function(t){var o=this._getEventFeature(t.point);if(o&&this._isBasic(o)){var r=this._getFeature(o.properties[this._key]),n=r?i.getCoord(i.centroid(r)):void 0,s=l(l({},this._getData(o)),{originMapEvent:t});n&&(s.center=new e.LngLat(n[0],n[1])),this._isMouseOver?this.fire("mousemove",s):(this.fire("mouseenter",s),this._isMouseOver=!0),this._addCursor(),this._setHighlight(o.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:t}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},r.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-polygon-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-polygon-layer")},r.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-polygon-layer")},r.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},r.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i.featureCollection([]),type:"geojson",promoteId:this._key};this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},r.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},r.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},r.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},r}(e.Evented),Vt=[{id:"mapbox-postting-distance-measure-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-distance-measure-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-postting-distance-measure-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-distance-measure-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],It=function(t){function e(e){var i,o=t.call(this)||this;return o._source="mapbox-postting-distance-measurer-source",o._map=null,o._enabled=!1,o._currentPath=[],o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||Vt,L(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return a(e,t),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._render(),this},e.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-distance-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},e.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-postting-distance-measurer-cursor"))},e.prototype.disable=function(){0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-postting-distance-measurer-cursor"),this._render())},e.prototype.clear=function(){return this._cacheMap.forEach((function(t){t.data.forEach((function(t){t.marker.remove()}))})),this._cacheMap.clear(),0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._map&&this._render(),this},e.prototype.getAllPath=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({pathId:i,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))})})),t},e.prototype.getPathById=function(t){var e=this._cacheMap.get(t);return e?{pathId:t,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))}:null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},e.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},e.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._currentPath[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},e.prototype._finish=function(){var t=this;if(!(this._next<2)){this._next=0;var e=Date.now().toString(),i=At(this._currentPath,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(i.data[i.data.length-1].marker,(function(){return t._remove(e)})),this._cacheMap.set(e,i),this._currentPath=[],setTimeout((function(){t.fire("complete",{pathId:e,length:i.length,pathData:i.features.find((function(t){return"LineString"===t.geometry.type}))})}),10)}},e.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.data.forEach((function(t){var e;null===(e=t.marker)||void 0===e||e.remove()})),this._cacheMap.delete(t),this.fire("delete",{pathId:t}),this._render()},e.prototype._add=function(t){this._update(t),this._next++},e.prototype._update=function(t){var e=this._currentPath.length>1?function(t){var e=n.length(n.lineString(t),{units:"kilometers"});if(e<1)return(1e3*e).toFixed(0)+"米";return e.toFixed(1)+"公里"}(u(u([],this._currentPath.map((function(t){return t.coordinates})),!0),[t],!1)):"起点";this._currentPath[this._next]?(this._currentPath[this._next].coordinates=t,this._currentPath[this._next].marker.getElement().innerText=e,this._currentPath[this._next].marker.setLngLat(t)):this._currentPath[this._next]={coordinates:t,marker:Rt(t,e)}},e.prototype._render=function(){var t=this;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.features)}));var o=At(this._currentPath,"true");i.push.apply(i,o.features),o.data.forEach((function(e){var i;null===(i=e.marker)||void 0===i||i.addTo(t._map)})),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(l(l({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e}(e.Evented);function At(t,e){var i=[],o=t.map((function(t){return t.coordinates})),r=function(t,e){try{return n.lineString(t,{active:e})}catch(t){return null}}(o,e),s=0;return r&&(i.push(r),s=n.length(r,{units:"kilometers"})),o.forEach((function(t){var o=n.point(t,{active:e});i.push(o)})),{data:u([],t,!0),features:i,length:s}}function Rt(t,i){var o=document.createElement("div");o.classList.add("mapbox-postting-distance-measurer-marker");var r=new e.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(t),r.getElement().innerText=i,r}var Nt=[{id:"mapbox-postting-area-measurer-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.3}},{id:"mapbox-postting-area-measurer-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-area-measurer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-postting-area-measurer-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.4}},{id:"mapbox-postting-area-measurer-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-area-measurer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],zt=function(t){function e(e){var i,o=t.call(this)||this;return o._source="mapbox-postting-area-measurer-source",o._map=null,o._enabled=!1,o._current={path:[],marker:null},o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||Nt,L(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return a(e,t),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-area-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},e.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-postting-area-measurer-cursor"))},e.prototype.disable=function(){var t;0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-postting-area-measurer-cursor"),this._render())},e.prototype.clear=function(){var t;return this._cacheMap.forEach((function(t){t.marker.remove()})),this._cacheMap.clear(),0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._map&&this._render(),this},e.prototype.getAllArea=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({areaId:i,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})})),t},e.prototype.getAreaById=function(t){var e=this._cacheMap.get(t);return e?{areaId:t,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))}:null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},e.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},e.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._current.path[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},e.prototype._finish=function(){var t,e=this;if(!(this._next<3)){this._next=0;var i=Date.now().toString(),o=$t(this._current.path,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(o.marker,(function(){return e._remove(i)})),o.marker.addTo(this._map),this._cacheMap.set(i,o),null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},setTimeout((function(){e.fire("complete",{areaId:i,acreage:o.acreage,areaData:o.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})}),10)}},e.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.marker.remove(),this._cacheMap.delete(t),this.fire("delete",{areaId:t}),this._render()},e.prototype._add=function(t){this._update(t),this._next>=2&&!qt(u(u([],this._current.path,!0),[this._current.path[0]],!1),"true")||this._next++},e.prototype._update=function(t){this._current.path[this._next]=t},e.prototype._render=function(){var t,e;if(this._map){var i=this._map.getSource(this._source),o=[];this._cacheMap.forEach((function(t){o.push.apply(o,t.features)}));var r=$t(this._current.path,"true");o.push.apply(o,r.features),null===(t=this._current.marker)||void 0===t||t.remove(),this._current.marker=r.marker,null===(e=this._current.marker)||void 0===e||e.addTo(this._map),i.setData({type:"FeatureCollection",features:o})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(l(l({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e}(e.Evented);function $t(t,i){var o=[],r=null,s=function(t,e){try{return n.lineString(t,{active:e})}catch(t){return null}}(u(u([],t,!0),[t[0]],!1),i);s&&o.push(s);var a=qt(u(u([],t,!0),[t[0]],!1),i),h=0;a&&(o.push(a),r=function(t,i){var o=document.createElement("div");o.classList.add("mapbox-postting-area-measurer-marker");var r=new e.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(t),r.getElement().innerText=i,r}(n.center(a).geometry.coordinates,(h=n.area(a))>1e6?(h/1e6).toFixed(2)+"平方公里":h.toFixed(2)+"平方米"));return t.forEach((function(t){var e=n.point(t,{active:i});o.push(e)})),{data:u([],t,!0),features:o,marker:r,acreage:h}}function qt(t,e){try{var i=void 0,o=n.unkinkPolygon(n.polygon([t]));return(i=o.features.length>1?n.combine(o).features[0]:o.features[0]).properties={active:e},i}catch(t){return null}}var Gt=[{id:"mapbox-postting-draw-util-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-draw-util-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-point-active",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-draw-util-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-postting-draw-util-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-draw-util-circle-center-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["==","type","circle-center"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],Wt=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return a(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(e.Evented);function Zt(t,e){void 0===e&&(e={});try{return i.lineString(t,l({},e))}catch(t){return null}}var Ut=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],e=i.point(this._path[0],{origin:"point"});return t.push(e),{feature:e,renderFeatures:t}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},e.prototype.onMouseMove=function(){return!1},e.prototype.onDblClick=function(){},e.prototype.clear=function(){this._path=[]},e}(Wt),Yt=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=this._next-1;"false"===t&&(o=this._next);var r=Zt(u([],this._path,!0),{active:t,origin:"line"});r&&e.push(r);for(var n=0;n<=o;n++)if(this._path[n]){var s=i.point(this._path[n],{active:t,type:"vertex",origin:"line"});e.push(s)}return{feature:r,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Wt),Kt=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=u([],this._path,!0),r=this._next-1;"false"===t&&(o=u(u([],this._path,!0),[this._path[0]],!1),r=this._next);var n=Zt(o,{active:t,type:"border",origin:"polygon"});n&&e.push(n);var s=Jt(u(u([],this._path,!0),[this._path[0]],!1),t);s&&e.push(s);for(var a=0;a<=r;a++)if(this._path[a]){var h=i.point(this._path[a],{active:t,type:"vertex",origin:"polygon"});e.push(h)}return{feature:s,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!Jt(u(u([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||Jt(u(u([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Wt);function Jt(t,e){try{var o=void 0,r=i.unkinkPolygon(i.polygon([t]));return(o=r.features.length>1?i.combine(r).features[0]:r.features[0]).properties={active:e,origin:"polygon"},o}catch(t){return null}}var Xt,Qt=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=null;if(2===this._path.length){var r=i.point(this._path[0]),n=i.rhumbDistance(r,i.point(this._path[1]));o=i.circle(r,n,{steps:512,properties:{active:t,origin:"circle"}}),e.push(o);var s=i.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"circle"});e.push(s)}if(this._path[0]){var a=i.point(this._path[0],{active:t,type:"circle-center",origin:"circle"});e.push(a)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Wt),te=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=null;if(2===this._path.length){delete(o=i.bboxPolygon(i.bbox(i.featureCollection([i.point(this._path[0]),i.point(this._path[1])])),{properties:{active:t,origin:"rect"}})).bbox,e.push(o);var r=i.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"rect"});e.push(r),o.geometry.coordinates[0].forEach((function(o){var r=i.point(o,{active:t,type:"vertex",origin:"rect"});e.push(r)}))}else if(this._path[0]){var n=i.point(this._path[0],{active:t,type:"vertex",origin:"rect"});e.push(n)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Wt),ee={NONE:"NONE",DRAW_POINT:"DRAW_POINT",DRAW_LINE:"DRAW_LINE",DRAW_POLYGON:"DRAW_POLYGON",DRAW_CIRCLE:"DRAW_CIRCLE",DRAW_RECT:"DRAW_RECT"},ie=((Xt={})[ee.DRAW_POINT]=Ut,Xt[ee.DRAW_LINE]=Yt,Xt[ee.DRAW_POLYGON]=Kt,Xt[ee.DRAW_CIRCLE]=Qt,Xt[ee.DRAW_RECT]=te,Xt),oe=function(t){function e(e){var i,r,n,s,a,h=t.call(this)||this;return h._map=null,h._source="mapbox-postting-draw-util-source-".concat(o.nanoid(8)),h._currentModeType=ee.NONE,h._currentMode=null,h._cacheMap=new Map,h._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,h._layers=(null==e?void 0:e.layers)||Gt,h._onClick=(r=h,n=h._onClick,s=250,a=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a||(n.call.apply(n,u([r],t,!1)),a=setTimeout((function(){a=void 0}),s))}),L(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],h),h}return a(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-draw-util-cursor")),this._currentModeType=ee.NONE,this._currentMode=null,this._map=null,this.clear()},e.prototype.changeMode=function(t){var e,r,n,s=this;if(this._currentModeType!==t)return null===(e=this._currentMode)||void 0===e||e.clear(),this._currentModeType=t,t===ee.NONE?(this._currentMode=null,null===(r=this._map)||void 0===r||r.getContainer().classList.remove("mapbox-postting-draw-util-cursor")):(this._currentMode=new ie[t],null===(n=this._map)||void 0===n||n.getContainer().classList.add("mapbox-postting-draw-util-cursor"),this._currentMode.on("finished",(function(t){var e=o.nanoid(8),r=i.clone(t.data.feature);r.properties={},s._cacheMap.set(e,{renderFeatures:t.data.renderFeatures,feature:r}),setTimeout((function(){s._render()})),setTimeout((function(){s.fire("add",{data:{id:e,feature:i.clone(r)}})}))}))),this._render(),this},e.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},e.prototype.add=function(t,e){void 0===e&&(e=!1);var o=Date.now().toString();if("Polygon"===t.geometry.type){var r=function(t,e,o){void 0===o&&(o=!1);var r=t.geometry,n=[],s=Zt(r.coordinates[0],{active:e,type:"border",origin:o?"circle":"polygon"});s&&n.push(s);var a=i.clone(t);if(a.properties={active:e,origin:o?"circle":"polygon"},n.push(a),!o){var h=i.multiPoint(r.coordinates[0]);i.cleanCoords(h).geometry.coordinates.forEach((function(t){var o=i.point(t,{active:e,type:"vertex",origin:"polygon"});n.push(o)}))}return{renderFeatures:n,feature:i.clone(t)}}(t,"false",e);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("MultiPolygon"===t.geometry.type){r=function(t,e){var o=t.geometry,r=[];o.coordinates.forEach((function(t){var i=Zt(t[0],{active:e,type:"border",origin:"polygon"});i&&r.push(i)}));var n=i.clone(t);n.properties={active:e,origin:"polygon"},r.push(n);var s=[];o.coordinates.forEach((function(t){s.push.apply(s,t[0])}));var a=i.multiPoint(s);return i.cleanCoords(a).geometry.coordinates.forEach((function(t){var o=i.point(t,{active:e,type:"vertex",origin:"polygon"});r.push(o)})),{feature:i.clone(t),renderFeatures:r}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("LineString"===t.geometry.type){r=function(t,e){var o=[],r=i.clone(t);return r.properties={active:e,origin:"line"},o.push(r),t.geometry.coordinates.forEach((function(t){var r=i.point(t,{active:e,type:"vertex",origin:"line"});o.push(r)})),{renderFeatures:o,feature:i.clone(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else if("MultiLineString"===t.geometry.type){r=function(t,e){var o=[],r=i.clone(t);return r.properties={active:e,origin:"line"},o.push(r),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var r=i.point(t,{active:e,type:"vertex",origin:"line"});o.push(r)}))})),{renderFeatures:o,feature:i.clone(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}else{if("Point"!==t.geometry.type&&"MultiPoint"!==t.geometry.type)return null;r=function(t){var e=[],o=i.clone(t);return o.properties={origin:"point"},e.push(o),{renderFeatures:e,feature:i.clone(t)}}(t);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(o,r)}return this._map&&this._render(),o},e.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},e.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){return{id:t[0],feature:t[1].feature}}))},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},e.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},e.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},e.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.renderFeatures)}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(l(l({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e.MODE_TYPE=ee,e}(e.Evented);var re=function(t){function e(e){var i=t.call(this)||this;return e=m(e),i._renderData=[],i._data=e.data||[],i._fullPathData=null,i._splittedPathData=[],i._useTimeStamp=!1,i._layerPool=e.layerPool||{},i._currentPathLayers=e.currentPathLayers||[],i._fullPathLayers=e.fullPathLayers||[],i._carLayers=e.carLayers||[],i._nodeLayers=e.nodeLayers||[],i._trackTimeStamp=0,i._realTimeStamp=0,i._animationFrame=0,i._state=0,i._speed=e.speed||1,i._map=null,i._finished=!1,i._loop=e.loop||!1,i._source="mapbox-postting-car-track-".concat(o.nanoid(8)),i._fitBoundsOptions=i._getFitBoundsOptions(e.fitBoundsOptions),i._lngLatBounds=null,i._calcFullPath(),i._calcSplittedPath(),L(["_animate","_onData"],i),i}return a(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPathLayers",{get:function(){var t=this;return this._currentPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-current-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPathLayers",{get:function(){var t=this;return this._fullPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-full-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carLayers",{get:function(){var t=this;return this._carLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-car")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeLayers",{get:function(){var t=this;return this._nodeLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-node")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._currentPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-current-path")]=t._layerPool[i]),t._fullPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-full-path")]=t._layerPool[i]),t._carLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-car")]=t._layerPool[i]),t._nodeLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-node")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return this._map===t||(this.remove(),this._map=t,this._addSourceAnyLayer(),this._map.on("data",this._onData),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype.remove=function(){var t;return null===(t=this._map)||void 0===t||t.off("data",this._onData),this.stop(),this._removeSourceAndLayer(),this._map=null,this._renderData=[],this},e.prototype.play=function(){return this._map&&this._fullPathData?(1===this._state||(this._state=1,this._realTimeStamp=Date.now(),this._finished&&(this._finished=!1,this._init()),this._animationFrame=requestAnimationFrame(this._animate)),this):this},e.prototype.pause=function(){return this._map?(1!==this._state||(cancelAnimationFrame(this._animationFrame),this._state=2),this):this},e.prototype.stop=function(){return this._map?(cancelAnimationFrame(this._animationFrame),this._state=0,this._animationFrame=0,this._trackTimeStamp=0,this._realTimeStamp=0,this._finished=!1,this._init(),this):this},e.prototype.setSpeed=function(t){return this._speed=t,this},e.prototype.setTimestamp=function(t){return this._map&&this._useTimeStamp?(this.pause(),this._init(t),this._firePlayingEvent(),this):this},e.prototype.setData=function(t){return this.stop(),this._data=t||[],this._calcFullPath(),this._calcSplittedPath(),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:this._renderData},lineMetrics:!0}),this.fullPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","full-path"]]}))}})),this.currentPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","current-path"]]}))}})),this.nodeLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","node"]]}))}})),this.carLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(l(l({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","car"]]}))}})))},e.prototype._removeSourceAndLayer=function(){var t=this;this._map&&(this.fullPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.currentPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.carLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.nodeLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this._map.getSource(this._source)&&this._map.removeSource(this._source))},e.prototype._calcSplittedPath=function(){var t=this;this._splittedPathData=[],this._fullPathData&&this._data.reduce((function(e,o,r){var n,s,a,h=i.point(e.coordinates),p=i.point(o.coordinates),c=i.distance(h,p,{units:"meters"}),_=l({},o);(1===r&&(t._useTimeStamp=!!e.timestamp),t._useTimeStamp)?(n=c/(o.timestamp-e.timestamp),s=e.timestamp,a=o.timestamp):(n=.001,a=(s=1===r?0:e.timestamp)+Math.floor(c/n),_.timestamp=a);return t._splittedPathData.push({speed:n,length:c,startTime:s,endTime:a,start:u([],e.coordinates,!0),end:u([],o.coordinates,!0),bearing:i.bearing(h,p)}),_}))},e.prototype._calcFullPath=function(){this._data.length>1?(this._fullPathData=i.lineString(this._data.map((function(t){return t.coordinates})),{type:"full-path"}),this._lngLatBounds=i.bboxPolygon(i.bbox(this._fullPathData)).bbox):(this._fullPathData=null,this._lngLatBounds=null)},e.prototype._search=function(t){if(t>=this._splittedPathData[this._splittedPathData.length-1].endTime)return this._splittedPathData.length-1;if(t<=this._splittedPathData[0].startTime)return 0;for(var e=0,i=this._splittedPathData.length-1;e<=i;){var o=Math.floor((i-e)/2)+e,r=this._splittedPathData[o];if(r.startTime<=t&&r.endTime>t)return o;r.startTime>t?i=o-1:e=o+1}return-1},e.prototype._getNodeData=function(t){var e=this;return this._data.map((function(o,r){return i.point(o.coordinates,{type:"node",nodeType:0===r?"start":r===e._data.length-1?"end":"common",nodeState:r>t?0:1})}))},e.prototype._init=function(t){var e;if(this._map){if(this._fullPathData)if(t)this._trackTimeStamp=t,this._renderData=this._getRenderData();else{this._renderData=u([this._fullPathData],this._getNodeData(0),!0);var o=this._splittedPathData[0],r=o.start,n=o.bearing,s=o.startTime;this._trackTimeStamp=s,this._renderData.push(i.point(r,{bearing:n,type:"car"}))}else this._renderData=[];var a=null===(e=this._map)||void 0===e?void 0:e.getSource(this._source);null==a||a.setData({type:"FeatureCollection",features:this._renderData})}},e.prototype._animate=function(){if(this._map&&0!==this._state&&2!==this._state){if(this._finished)return this._state=0,this.fire("complete"),void(this._loop&&this.play());var t=Date.now(),e=t-this._realTimeStamp;this._realTimeStamp=t,this._trackTimeStamp+=e*this._speed;var i=this._map.getSource(this._source);this._renderData=this._getRenderData(),null==i||i.setData({type:"FeatureCollection",features:this._renderData}),this._useTimeStamp&&this._firePlayingEvent(),1===this._state&&(this._animationFrame=requestAnimationFrame(this._animate))}},e.prototype._firePlayingEvent=function(){this.fire("moving",{timestamp:this._trackTimeStamp})},e.prototype._getRenderData=function(){var t,e=[this._fullPathData],o=this._search(this._trackTimeStamp),r=this._splittedPathData[o],n=r.start,s=r.end,a=r.startTime,h=r.endTime,l=r.speed,p=r.length,c=r.bearing,_=this._splittedPathData.slice(0,o+1),d=(this._trackTimeStamp-a)*l;this._finished=!1,d>=p?(t=i.point(s),this._trackTimeStamp=h,this._finished=o===this._splittedPathData.length-1,e.push.apply(e,this._getNodeData(o+1))):(t=i.along(i.lineString([n,s]),d,{units:"meters"}),e.push.apply(e,this._getNodeData(o))),t.properties={bearing:c,type:"car"},e.push(t);var g=i.lineString(u(u([],_.map((function(t){return t.start})),!0),[t.geometry.coordinates],!1),{type:"current-path"});return e.push(g),e},e}(e.Evented),ne=[{id:"mapbox-postting-advance-buffer-fill",type:"fill",filter:["all",["==","$type","Polygon"],["==","origin","buffer"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-advance-buffer-border",type:"line",filter:["all",["==","$type","LineString"],["==","origin","buffer"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","origin","polygon"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-advance-buffer-polygon-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-advance-buffer-point",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-advance-buffer-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-postting-advance-buffer-polygon-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],se=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return a(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(e.Evented);function ae(t,e){void 0===e&&(e={});try{return i.lineString(t,l({},e))}catch(t){return null}}var he=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],e=i.point(this._path[0],{origin:"point"});return t.push(e),{feature:e,renderFeatures:t}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},e.prototype.onMouseMove=function(){return!1},e.prototype.onDblClick=function(){},e.prototype.clear=function(){this._path=[]},e}(se),le=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=this._next-1;"false"===t&&(o=this._next);var r=ae(u([],this._path,!0),{active:t,origin:"line"});r&&e.push(r);for(var n=0;n<=o;n++)if(this._path[n]){var s=i.point(this._path[n],{active:t,type:"vertex",origin:"line"});e.push(s)}return{feature:r,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(se),ue=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=u([],this._path,!0),r=this._next-1;"false"===t&&(o=u(u([],this._path,!0),[this._path[0]],!1),r=this._next);var n=ae(o,{active:t,type:"border",origin:"polygon"});n&&e.push(n);var s=pe(u(u([],this._path,!0),[this._path[0]],!1),t);s&&e.push(s);for(var a=0;a<=r;a++)if(this._path[a]){var h=i.point(this._path[a],{active:t,type:"vertex",origin:"polygon"});e.push(h)}return{feature:s,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!pe(u(u([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||pe(u(u([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(se);function pe(t,e){try{var o=void 0,r=i.unkinkPolygon(i.polygon([t]));return(o=r.features.length>1?i.combine(r).features[0]:r.features[0]).properties={active:e,origin:"polygon"},o}catch(t){return null}}var ce,_e=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=null;if(2===this._path.length){delete(o=i.bboxPolygon(i.bbox(i.featureCollection([i.point(this._path[0]),i.point(this._path[1])])),{properties:{active:t,origin:"polygon"}})).bbox,e.push(o);var r=i.lineString(o.geometry.coordinates[0],{active:t,type:"border",origin:"polygon"});e.push(r),o.geometry.coordinates[0].forEach((function(o){var r=i.point(o,{active:t,type:"vertex",origin:"polygon"});e.push(r)}))}else if(this._path[0]){var n=i.point(this._path[0],{active:t,type:"vertex",origin:"polygon"});e.push(n)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(se),de={NONE:"NONE",POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON",RECT:"RECT"},ge=((ce={})[de.POINT]=he,ce[de.LINE]=le,ce[de.POLYGON]=ue,ce[de.RECT]=_e,ce),fe=["meters","kilometers"],ye=function(t){function e(e){var i,r,n,s,a,h=t.call(this)||this;return h._map=null,h._source="mapbox-postting-advance-buffer-source-".concat(o.nanoid(8)),h._currentModeType=de.NONE,h._currentMode=null,h._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:1,h._units=(null==e?void 0:e.units)&&fe.includes(e.units)?e.units:"kilometers",h._steps=(null==e?void 0:e.steps)&&e.steps>0?e.steps:16,h._cacheMap=new Map,h._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,h._layers=(null==e?void 0:e.layers)||ne,h._onClick=(r=h,n=h._onClick,s=250,a=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];a||(n.call.apply(n,u([r],t,!1)),a=setTimeout((function(){a=void 0}),s))}),L(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],h),h}return a(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-advance-buffer-cursor")),this._currentModeType=de.NONE,this._currentMode=null,this._map=null,this.clear()},e.prototype.changeMode=function(t){var e,r,n,s=this;if(this._currentModeType!==t)return null===(e=this._currentMode)||void 0===e||e.clear(),this._currentModeType=t,t===de.NONE?(this._currentMode=null,null===(r=this._map)||void 0===r||r.getContainer().classList.remove("mapbox-postting-advance-buffer-cursor")):(this._currentMode=new ge[t],null===(n=this._map)||void 0===n||n.getContainer().classList.add("mapbox-postting-advance-buffer-cursor"),this._currentMode.on("finished",(function(t){var e=o.nanoid(8),r=i.clone(t.data.feature);r.properties={};var n=ve(r,s._radius,s._steps,s._units),a=n.renderFeatures,h=n.bufferFeature;s._cacheMap.set(e,{bufferRenderFeatures:a,baseRenderFeatures:t.data.renderFeatures,bufferFeature:h,feature:r}),setTimeout((function(){s._render()})),setTimeout((function(){s.fire("add",{data:{id:e,feature:i.clone(r),bufferFeature:i.clone(h)}})}))}))),this._render(),this},e.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},e.prototype.add=function(t){var e=this,r=o.nanoid(8),n=ve(t,this._radius,this._steps,this._units),s=n.renderFeatures,a=n.bufferFeature;return this._multiple||this._cacheMap.clear(),this._cacheMap.set(r,{bufferRenderFeatures:s,baseRenderFeatures:me(t),bufferFeature:a,feature:t}),this._map&&setTimeout((function(){e._render()})),{id:r,feature:i.clone(t),bufferFeature:i.clone(a)}},e.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},e.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){var e=t[0],i=t[1];return{id:e,feature:i.feature,bufferFeature:i.bufferFeature}}))},e.prototype.setBufferOptions=function(t){var e=this;return t.radius&&(this._radius=t.radius),t.units&&fe.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>0&&(this._steps=t.steps),this._cacheMap.forEach((function(t){var i=ve(t.feature,e._radius,e._steps,e._units),o=i.renderFeatures,r=i.bufferFeature;t.bufferRenderFeatures=o,t.bufferFeature=r})),this._render(),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},e.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},e.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},e.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,u(u([],t.baseRenderFeatures,!1),t.bufferRenderFeatures,!1))}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(l(l({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e.MODE_TYPE=de,e}(e.Evented);function ve(t,e,o,r){var n=[],s=i.cleanCoords(i.buffer(t,e,{units:r,steps:o})),a=i.clone(s);a.properties={origin:"buffer"};var h=i.polygonToLine(a);return"FeatureCollection"===h.type?h.features.forEach((function(t){t.properties={origin:"buffer"},n.push(t)})):(h.properties={origin:"buffer"},n.push(h)),n.push(a),{renderFeatures:n,bufferFeature:s}}function me(t){return"Point"===t.geometry.type||"MultiPoint"===t.geometry.type?function(t){var e=i.clone(t);return e.properties={origin:"point"},[e]}(t):"LineString"===t.geometry.type?function(t){var e=[],o=i.clone(t);return o.properties={active:"false",origin:"line"},e.push(o),t.geometry.coordinates.forEach((function(t){var o=i.point(t,{active:"false",type:"vertex",origin:"line"});e.push(o)})),e}(t):"MultiLineString"===t.geometry.type?function(t){var e=[],o=i.clone(t);return o.properties={active:"false",origin:"line"},e.push(o),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var o=i.point(t,{active:"false",type:"vertex",origin:"line"});e.push(o)}))})),e}(t):"Polygon"===t.geometry.type?function(t){var e=[],o=i.clone(t);o.properties={active:"false",origin:"polygon"},e.push(o);var r=ae(t.geometry.coordinates[0],{active:"false",type:"border",origin:"polygon"});r&&e.push(r);var n=i.multiPoint(t.geometry.coordinates[0]);return i.cleanCoords(n).geometry.coordinates.forEach((function(t){var o=i.point(t,{active:"false",type:"vertex",origin:"polygon"});e.push(o)})),e}(t):"MultiPolygon"===t.geometry.type?function(t){var e=[],o=i.clone(t);o.properties={active:"false",origin:"polygon"},e.push(o),t.geometry.coordinates.forEach((function(t){var i=ae(t[0],{active:"false",type:"border",origin:"polygon"});i&&e.push(i)}));var r=[];t.geometry.coordinates.forEach((function(t){r.push.apply(r,t[0])}));var n=i.multiPoint(r);return i.cleanCoords(n).geometry.coordinates.forEach((function(t){var o=i.point(t,{active:"false",type:"vertex",origin:"polygon"});e.push(o)})),e}(t):[]}t.AdvanceBuffer=ye,t.AdvanceCarTrack=re,t.AdvanceLineLayer=Ht,t.AdvancePointLayer=Tt,t.AdvancePolygonLayer=jt,t.AnyLayer=P,t.AreaMeasurer=zt,t.BufferLayer=dt,t.CarTrack=xt,t.CircleAreaPicker=ht,t.CircleClusterLayer=ft,t.CirclePointLayer=w,t.DistanceMeasurer=It,t.DrawUtil=oe,t.HeatmapLayer=Z,t.LineLayer=N,t.LinePicker=J,t.MapComparer=St,t.MarkerPointLayer=A,t.PointPicker=U,t.PolygonAreaPicker=et,t.PolygonLayer=W,t.PrismoidLayer=Bt,t.RectAreaPicker=nt,t.SymbolClusterLayer=mt,t.SymbolPointLayer=I}));
//# sourceMappingURL=mapbox-postting.min.js.map
