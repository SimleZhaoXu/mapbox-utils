import t from"mapbox-gl";import*as e from"@turf/turf";import{featureCollection as i,clone as o,bboxPolygon as r,bbox as n,getCoord as s,centroid as a,lineString as h,point as l,unkinkPolygon as u,polygon as p,combine as c,rhumbDistance as _,circle as d,multiPoint as g,cleanCoords as f,distance as y,bearing as v,along as m,buffer as L,polygonToLine as b}from"@turf/turf";import{nanoid as k}from"nanoid";var M=function(t,e){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},M(t,e)};function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var P,O=function(){return O=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},O.apply(this,arguments)};function E(t,e,i){if(i||2===arguments.length)for(var o,r=0,n=e.length;r<n;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var S="[object Array]",C="[object Function]",B="[object Map]",F="[object Set]",D="[object Date]",T="[object RegExp]",H=((P={})["[object Object]"]=function(t,e){return Object.keys(e).forEach((function(i){return t[i]=j(e[i])})),t},P[S]=function(t,e){return e.forEach((function(e){return t.push(j(e))})),t},P[B]=function(t,e){return e.forEach((function(e,i){return t.set(i,j(e))})),t},P[F]=function(t,e){return e.forEach((function(e){return t.add(j(e))})),t},P[C]=function(t,e){return t=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.call.apply(e,E([this],t,!1))},t},P[D]=function(t,e){return t=new Date(e),t},P[T]=function(t,e){return t=new RegExp(e.source,e.flags),t},P),w=new WeakMap;function j(t){var e;if(!(t instanceof Object))return t;if(w.has(t))return w.get(t);var i=function(t){var e=t.constructor;return new e}(t);return w.set(t,i),i=(null!==(e=H[function(t){return Object.prototype.toString.call(t)}(t)])&&void 0!==e?e:function(){return t})(i,t)}function V(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var I={"circle-color":"#fff","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#44cef6"},A={"line-width":2,"line-color":"#44cef6","line-opacity":.5,"line-dasharray":[5,3]},R={"fill-color":"#44cef6","fill-opacity":.2},N=["default","crosshair","pointer","move","e-resize","ne-resize","nw-resize","n-resize","se-resize","sw-resize","s-resize","w-resize","text","wait","help"],z=function(){function t(t){var e;this._id=null!==(e=t.id)&&void 0!==e?e:k(),this._type=t.type,this._layerId="".concat(this._type,"-").concat(this._id),this._data=t.data,this._paint=t.paint,this._layout=t.layout,this._layerCursor=t.layerCursor&&N.includes(t.layerCursor)?t.layerCursor:void 0,this._mapCursor=t.mapCursor&&N.includes(t.mapCursor)?t.mapCursor:void 0,V(["_onMouseEnter","_onMouseLeave","_onData"],this)}return Object.defineProperty(t.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),t.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this.on("mouseenter",this._onMouseEnter),this.on("mouseleave",this._onMouseLeave),this._map.on("data",this._onData)),this},t.prototype.remove=function(){return this._map&&(this._removeLayerAndSource(),this.off("mouseenter",this._onMouseEnter),this.off("mouseleave",this._onMouseLeave),this._map.off("data",this._onData),this._map=void 0),this},t.prototype.setData=function(t){if(this._data=t,this._map){var e=this._map.getSource(this._layerId);null==e||e.setData(t)}return this},t.prototype.on=function(t,e){var i;return null===(i=this._map)||void 0===i||i.on(t,this._layerId,e),this},t.prototype.off=function(t,e){var i;return null===(i=this._map)||void 0===i||i.off(t,this._layerId,e),this},t.prototype.setStyle=function(t){var e=this,i=t.paint,o=t.layout;i&&(this._paint=O(O({},this._paint),i),this._map&&Object.keys(i).forEach((function(t){e._map.setPaintProperty(e._layerId,t,i[t])})));o&&(this._layout=O(O({},this._layout),o),this._map&&Object.keys(o).forEach((function(t){e._map.setLayoutProperty(e._layerId,t,o[t])})));return this},t.prototype.querySourceFeature=function(t){var e;return null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,O(O({},t||{}),{sourceLayer:this._layerId}))},t.prototype.queryFeatureFormData=function(t,i){var o,r=void 0;return this._data?"FeatureCollection"===this._data.type?this._data.features.find((function(e){var o;return(null===(o=e.properties)||void 0===o?void 0:o[t])===i})):("Feature"===this._data.type&&(null===(o=this._data.properties)||void 0===o?void 0:o[t])===i&&(r=e.clone(this._data)),r):r},t.prototype.getSource=function(){var t;return null===(t=this._map)||void 0===t?void 0:t.getSource(this._layerId)},t.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:this._type,source:{type:"geojson",data:null!==(t=this._data)&&void 0!==t?t:e.featureCollection([])},layout:this._layout||{},paint:this._paint||{}}))},t.prototype._onMouseEnter=function(t){this._layerCursor&&(t.target.getCanvas().style.cursor=this._layerCursor)},t.prototype._onMouseLeave=function(t){var e;this._layerCursor&&(t.target.getCanvas().style.cursor=null!==(e=this._mapCursor)&&void 0!==e?e:"")},t.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},t.prototype._removeLayerAndSource=function(){var t,e;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getSource(this._layerId))&&this._map.removeSource(this._layerId)},t}(),$=["line-color","line-width","line-blur","line-opacity","line-pattern","line-gap-width","line-offset","line-dasharray","line-gradient","line-translate","line-translate-anchor"],q=["line-cap","line-join","line-miter-limit","line-round-limit"],G=["circle-radius","circle-color","circle-blur","circle-opacity","circle-translate","circle-translate-anchor","circle-pitch-scale","circle-pitch-alignment","circle-stroke-width","circle-stroke-color","circle-stroke-opacity"],W=["symbol-placement","symbol-spacing","symbol-avoid-edges","symbol-z-order","icon-allow-overlap","icon-ignore-placement","icon-optional","icon-rotation-alignment","icon-size","icon-text-fit","icon-text-fit-padding","icon-image","icon-rotate","icon-padding","icon-keep-upright","icon-offset","icon-anchor","icon-pitch-alignment","text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],Z=["icon-opacity","icon-color","icon-halo-color","icon-halo-width","icon-halo-blur","icon-translate","icon-translate-anchor","text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],Y=["text-pitch-alignment","text-rotation-alignment","text-field","text-font","text-size","text-max-width","text-line-height","text-letter-spacing","text-justify","text-anchor","text-max-angle","text-rotate","text-padding","text-keep-upright","text-transform","text-offset","text-allow-overlap","text-ignore-placement","text-optional","text-radial-offset","text-variable-anchor","text-writing-mode"],U=["text-opacity","text-color","text-halo-color","text-halo-width","text-halo-blur","text-translate","text-translate-anchor"],K=["fill-extrusion-opacity","fill-extrusion-pattern","fill-extrusion-color","fill-extrusion-translate","fill-extrusion-translate-anchor","fill-extrusion-height","fill-extrusion-base","fill-extrusion-vertical-gradient"],J={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},X=function(i){function o(t){var e,o,r=i.call(this)||this;return r._lngLatBounds=null,r._styleMap=new Map,r._clickHighlightPropVal=void 0,r._hoverHighlightPropVal=void 0,r._expressionMap=new Map,r._key=null!==(e=t.key)&&void 0!==e?e:"id",r._id=k(),r._layer=new z({id:"circle-point-layer-".concat(r._id),type:"circle",layerCursor:"pointer",data:t.data,paint:r._getPaint(t.style),layout:{visibility:"visible"}}),r._fitBoundsOptions=r._getFitBoundsOptions(t.fitBoundsOptions),r._setLngLatBounds(t.data),r._highlightTrigger=null===(o=t.highlightOptions)||void 0===o?void 0:o.trigger,t.highlightOptions&&r._initHighlight(t.style,t.highlightOptions.style),V(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],r),r}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(J).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:J[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){G.includes(i)&&(e[i]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){return{data:O({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o=this,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",O(O({},this._getPoint(r)),{originalMapEvent:t,points:null===(i=t.features)||void 0===i?void 0:i.map((function(t){return o._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var n=r.properties[this._key];this._clickHighlightPropVal!==n&&(this._clickHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",O(O({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",O(O({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=E(["case",t],i,!0)})),i["circle-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),Q={"icon-image":"","icon-size":1,"text-field":"","text-size":16},tt={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},et=function(i){function o(t){var e,o,r=i.call(this)||this;return r._layoutStyleMap=new Map,r._paintStyleMap=new Map,r._clickHighlightPropVal=void 0,r._hoverHighlightPropVal=void 0,r._expressionMap=new Map,r._id=k(),r._layer=new z(O({id:"symbol-point-".concat(r._id),type:"symbol",layerCursor:"pointer",data:t.data},r._getStyle(t.style))),r._key=null!==(e=t.key)&&void 0!==e?e:"id",r._fitBoundsOptions=r._getFitBoundsOptions(t.fitBoundsOptions),r._setLngLatBounds(t.data),r._highlightTrigger=null===(o=t.highlightOptions)||void 0===o?void 0:o.trigger,t.highlightOptions&&r._initHighlight(t.style,t.highlightOptions.style),V(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],r),r}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(Q).forEach((function(o){var r,n=e[o];void 0!==n&&i._layoutStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:Q[o]])})),Object.keys(tt).forEach((function(o){var r,n=e[o];void 0!==n&&i._paintStyleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:tt[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){W.includes(o)?i[o]=t[o]:Z.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){return{data:O({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i=this,o=t.features[0];if(this.fire("click",O(O({},this._getPoint(o)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return i._getPoint(t)}))})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var r=o.properties[this._key];this._clickHighlightPropVal!==r&&(this._clickHighlightPropVal=r,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",O(O({},this._getPoint(i)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var o=t.features[0].properties[this._key];this._hoverHighlightPropVal!==o&&(this._hoverHighlightPropVal=o,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",O(O({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._paintStyleMap.forEach((function(i,o){e[o]=E(["case",t],i,!0)})),this._layoutStyleMap.forEach((function(e,o){i[o]=E(["case",t],e,!0)})),i["symbol-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),it=function(i){function o(t){var e,o=i.call(this)||this;return o._key=null!==(e=t.key)&&void 0!==e?e:"id",o._data=t.data,o._fitBoundsOptions=o._getFitBoundsOptions(t.fitBoundsOptions),o._setLngLatBounds(t.data),o._markerOptions=t.markerOptions?O(O({},t.markerOptions),{draggable:!1}):{},o._markerMap=new Map,o._init(),o}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){var e=this;return t===this._map||(this.remove(),this._map=t,this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._markerMap.forEach((function(t){t.remove()})),this._map=void 0),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.setData=function(t){var e=this;return this._data=t,this._setLngLatBounds(t),this._clear(),this._init(),this._map&&(this._markerMap.forEach((function(t){t.addTo(e._map)})),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype._clear=function(){this._markerMap.forEach((function(t){t.remove()})),this._markerMap.clear()},o.prototype._getFeature=function(t){var e=this;return this._data.features.find((function(i){var o;return(null===(o=i.properties)||void 0===o?void 0:o[e._key])===t}))},o.prototype._getElement=function(t,e){return"function"==typeof t?t(e):t.cloneNode(!0)},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:void 0},o.prototype._init=function(){var e=this;this._data.features.forEach((function(i){var o,r,n=O(O({},e._markerOptions),{element:(null===(o=e._markerOptions)||void 0===o?void 0:o.element)?e._getElement(e._markerOptions.element,i.properties):void 0}),s=new t.Marker(n).setLngLat(i.geometry.coordinates);e._setMarkerEvent(s,i.properties),e._markerMap.set(null===(r=i.properties)||void 0===r?void 0:r[e._key],s)}))},o.prototype._setMarkerEvent=function(t,e){var i=this,o=t.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i.fire("click",{lngLat:t.getLngLat(),data:JSON.parse(JSON.stringify(e))}),o.stopPropagation()}))},o}(t.Evented),ot={"line-color":"#000000","line-width":1,"line-blur":0,"line-opacity":1,"line-gap-width":0},rt=function(i){function o(t){var e,o,r=i.call(this)||this;return r._lngLatBounds=null,r._styleMap=new Map,r._clickHighlightPropVal=void 0,r._hoverHighlightPropVal=void 0,r._expressionMap=new Map,r._key=null!==(e=t.key)&&void 0!==e?e:"id",r._id=k(),r._layer=new z(O({id:"line-layer-".concat(r._id),type:"line",layerCursor:"pointer",data:t.data},r._getStyle(t.style))),r._fitBoundsOptions=r._getFitBoundsOptions(t.fitBoundsOptions),r._setLngLatBounds(t.data),r._highlightTrigger=null===(o=t.highlightOptions)||void 0===o?void 0:o.trigger,t.highlightOptions&&r._initHighlight(t.style,t.highlightOptions.style),V(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],r),r}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.fitTo=function(i,o){if(!this._map)return this;var r=this._getFeature(i);r&&this._map.fitBounds(new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox),o||{})},o.prototype.easeTo=function(i,o){if(!this._map)return this;var r=this._getFeature(i);if(r){var n=e.getCoord(e.centroid(r)),s=new t.LngLat(n[0],n[1]);this._map.easeTo(O(O({},o),{center:s}))}return this},o.prototype.flyTo=function(i,o){if(!this._map)return this;var r=this._getFeature(i);if(r){var n=e.getCoord(e.centroid(r)),s=new t.LngLat(n[0],n[1]);this._map.flyTo(O(O({},o||{}),{center:s}))}return this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){return this._layer.queryFeatureFormData(this._key,t)},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(ot).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:ot[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){q.includes(o)?i[o]=t[o]:$.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._onClick=function(i){var o,r=null===(o=i.features)||void 0===o?void 0:o[0],n=this._getFeature(r.properties[this._key]),s=e.getCoord(e.centroid(n)),a=new t.LngLat(s[0],s[1]),h=e.bboxPolygon(e.bbox(n)).bbox;if(this.fire("click",{center:a,data:O({},r.properties),lngLatBounds:new t.LngLatBounds(h),originalMapEvent:i}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var l=r.properties[this._key];this._clickHighlightPropVal!==l&&(this._clickHighlightPropVal=l,this._setHighlight())}},o.prototype._onMouseMove=function(i){var o,r,n,s=null===(o=i.features)||void 0===o?void 0:o[0],a=this._getFeature(s.properties[this._key]),h=e.getCoord(e.centroid(a)),l=new t.LngLat(h[0],h[1]);if(this.fire("mousemove",{center:l,data:O({},s.properties),lngLat:i.lngLat,originalMapEvent:i}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var u=null===(n=null===(r=i.features)||void 0===r?void 0:r[0].properties)||void 0===n?void 0:n[this._key];this._hoverHighlightPropVal!==u&&(this._hoverHighlightPropVal=u,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(i){var o,r=null===(o=i.features)||void 0===o?void 0:o[0],n=this._getFeature(r.properties[this._key]),s=e.getCoord(e.centroid(n)),a=new t.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:O({},r.properties),lngLat:i.lngLat,originalMapEvent:i})},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=E(["case",t],i,!0)})),i["line-sort-key"]=["case",t,2,0],this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),nt=["fill-opacity","fill-color","fill-pattern"],st=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray","stroke-pattern"],at={"stroke-opacity":1,"stroke-pattern":"","stroke-color":"#000000","stroke-width":1,"stroke-blur":0},ht={"fill-opacity":1,"fill-pattern":"","fill-color":"#000000"},lt=function(i){function o(t){var e,o,r,n,s=i.call(this)||this;return s._strokePaintStyleMap=new Map,s._strokeLayoutStyleMap=new Map,s._fillPaintStyleMap=new Map,s._fillLayoutStyleMap=new Map,s._expressionMap=new Map,s._id=k(),s._fillLayer=new z({id:"polygon-fill-".concat(s._id),type:"fill",layerCursor:"pointer",data:t.data,paint:s._getFillPaint(t.style),layout:{visibility:"visible","fill-sort-key":null!==(e=null==t?void 0:t.style["sort-key"])&&void 0!==e?e:1}}),s._strokeLayer=new z({id:"polygon-stroke-".concat(s._id),type:"line",data:t.data,paint:s._getStrokePaint(t.style),layout:{visibility:"visible","line-sort-key":null!==(o=null==t?void 0:t.style["sort-key"])&&void 0!==o?o:1}}),s._key=null!==(r=t.key)&&void 0!==r?r:"id",s._fitBoundsOptions=s._getFitBoundsOptions(t.fitBoundsOptions),s._setLngLatBounds(t.data),s._highlightTrigger=null===(n=t.highlightOptions)||void 0===n?void 0:n.trigger,t.highlightOptions&&s._initHighlight(t.style,t.highlightOptions.style),V(["_onMouseClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],s),s}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._fillLayer.addTo(t),this._strokeLayer.addTo(t),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._fillLayer.remove(),this._strokeLayer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._fillLayer.setData(t),this._strokeLayer.setData(t),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.fitTo=function(i,o){if(!this._map)return this;var r=this._getFeature(i);r&&this._map.fitBounds(new t.LngLatBounds(e.bboxPolygon(e.bbox(r)).bbox),o||{})},o.prototype.easeTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.easeTo(O(O({},i),{center:[r[0],r[1]]}))}return this},o.prototype.flyTo=function(t,i){if(!this._map)return this;var o=this._getFeature(t);if(o){var r=e.getCoord(e.centroid(o));this._map.flyTo(O(O({},i||{}),{center:[r[0],r[1]]}))}return this},o.prototype.fitBounds=function(t){var e;this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{}))},o.prototype._getFeature=function(t){return this._fillLayer.queryFeatureFormData(this._key,t)},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:null},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getFillPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){nt.includes(i)&&(e[i]=t[i])})),e},o.prototype._getStrokePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){st.includes(i)&&(e[i.replace("stroke","line")]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._fillLayer[t]("click",this._onMouseClick),this._fillLayer[t]("mousemove",this._onMouseMove),this._fillLayer[t]("mouseleave",this._onMouseLeave),this._fillLayer[t]("mouseenter",this._onMouseEnter)},o.prototype._onMouseClick=function(i){var o=i.features[0],r=this._getFeature(o.properties[this._key]),n=e.getCoord(e.centroid(r)),s=new t.LngLat(n[0],n[1]),a=e.bboxPolygon(e.bbox(r)).bbox;if(this.fire("click",{center:s,data:O({},o.properties),lngLatBounds:new t.LngLatBounds(a),originalMapEvent:i}),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var h=o.properties[this._key];this._clickHighlightPropVal!==h&&(this._clickHighlightPropVal=h,this._setHighlight())}},o.prototype._onMouseMove=function(i){var o,r=null===(o=i.features)||void 0===o?void 0:o[0],n=this._getFeature(r.properties[this._key]),s=e.getCoord(e.centroid(n)),a=new t.LngLat(s[0],s[1]);if(this.fire("mousemove",{center:a,data:O({},r.properties),lngLat:i.lngLat,originalMapEvent:i}),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var h=i.features[0].properties[this._key];this._hoverHighlightPropVal!==h&&(this._hoverHighlightPropVal=h,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(i){var o,r=null===(o=i.features)||void 0===o?void 0:o[0],n=this._getFeature(r.properties[this._key]),s=e.getCoord(e.centroid(n)),a=new t.LngLat(s[0],s[1]);this.fire("mouseenter",{center:a,data:O({},r.properties),lngLat:i.lngLat,originalMapEvent:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);this._strokePaintStyleMap.forEach((function(e,i){o[i]=E(["case",t],e,!0)})),this._strokeLayoutStyleMap.forEach((function(e,i){r[i]=E(["case",t],e,!0)})),this._fillPaintStyleMap.forEach((function(i,o){e[o]=E(["case",t],i,!0)})),this._fillLayoutStyleMap.forEach((function(e,o){i[o]=E(["case",t],e,!0)})),this._fillLayer.setStyle({paint:e,layout:i}),this._strokeLayer.setStyle({paint:o,layout:r})},o.prototype._initHighlight=function(t,e){var i,o,r=this;Object.keys(at).forEach((function(i){var o,n=e[i];void 0!==n&&r._strokePaintStyleMap.set(i.replace("stroke","line"),[n,null!==(o=t[i])&&void 0!==o?o:at[i]])})),Object.keys(ht).forEach((function(i){var o,n=e[i];void 0!==n&&r._fillPaintStyleMap.set(i,[n,null!==(o=t[i])&&void 0!==o?o:ht[i]])}));var n=e["sort-key"];void 0!==n&&(this._strokeLayoutStyleMap.set("line-sort-key",[n,null!==(i=t["sort-key"])&&void 0!==i?i:1]),this._fillLayoutStyleMap.set("fill-sort-key",[n,null!==(o=t["sort-key"])&&void 0!==o?o:1]));var s="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",r._key],null!==(t=r._hoverHighlightPropVal)&&void 0!==t?t:s]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",r._key],null!==(t=r._clickHighlightPropVal)&&void 0!==t?t:s],["==",["get",r._key],null!==(e=r._hoverHighlightPropVal)&&void 0!==e?e:s]]}))},o}(t.Evented),ut=function(t){function i(e){var i,o,r=t.call(this)||this;return r._id=k(),r._sourceAndLayerId="heatmap-layer-".concat(r._id),r._data=e.data,r._styleOptions=e.style,r._fitBoundsOptions=r._getFitBoundsOptions(e.fitBoundsOptions),r._setLngLatBounds(),r._minZoom=null!==(i=e.minZoom)&&void 0!==i?i:0,r._maxZoom=null!==(o=e.maxZoom)&&void 0!==o?o:24,V(["_onData"],r),r}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addSourceAndLayer(),this._map.on("data",this._onData),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){return this._map&&(this._map.off("data",this._onData),this._map.removeLayer(this._sourceAndLayerId),this._map.removeSource(this._sourceAndLayerId),this._map=void 0),this},i.prototype.setData=function(t){(this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this._sourceAndLayerId).setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions));return this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAndLayer()}),10)},i.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:void 0},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._addSourceAndLayer=function(){var t;this._map&&(this._map.getLayer(this._sourceAndLayerId)||this._map.addLayer({id:this._sourceAndLayerId,type:"heatmap",minzoom:this._minZoom,maxzoom:this._maxZoom,source:{type:"geojson",data:this._data},paint:null!==(t=this._styleOptions)&&void 0!==t?t:{}}))},i}(t.Evented),pt=function(e){function i(t){var i,o,r=e.call(this)||this;return r._pointMap=new Map,r._multiple=null!==(i=null==t?void 0:t.multiple)&&void 0!==i&&i,r._removeOnClick=null!==(o=null==t?void 0:t.removeOnClick)&&void 0!==o&&o,r._markerOptions=null==t?void 0:t.markerOptions,V(["_onMapClick"],r),r}return x(i,e),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._map.getCanvas().style.cursor="crosshair",this._map.on("click",this._onMapClick)),this},i.prototype.remove=function(){return this._map&&(this.removePoints(),this._map.getCanvas().style.cursor="",this._map.off("click",this._onMapClick),this._map=void 0),this},i.prototype.setPoint=function(e){var i,o;if(!this._map)return this;this._multiple||this.removePoints();var r=k(),n=this._markerOptions?O(O({},this._markerOptions),{draggable:!1,element:null!==(o=null===(i=this._markerOptions.element)||void 0===i?void 0:i.cloneNode())&&void 0!==o?o:void 0}):{},s=new t.Marker(n).setLngLat(e).addTo(this._map);return this._setMarkerEvent(r,s),this._pointMap.set(r,{lngLat:s.getLngLat(),marker:s}),this},i.prototype.getPoints=function(){return Array.from(this._pointMap).map((function(t){return t[1].lngLat.toArray()}))},i.prototype.on=function(t,i){return e.prototype.on.call(this,t,i),this},i.prototype._onMapClick=function(t){this.setPoint(t.lngLat),this.fire("get-point",{point:t.lngLat.toArray(),pointList:this.getPoints()})},i.prototype._setMarkerEvent=function(t,e){var i=this,o=e.getElement();o.style.cursor="pointer",o.addEventListener("click",(function(o){i._removeOnClick?(e.remove(),i._pointMap.delete(t),i.fire("remove-point",{point:e.getLngLat().toArray(),pointList:i.getPoints()})):i.fire("click-point",{point:e.getLngLat().toArray()}),o.stopPropagation()}))},i.prototype.removePoints=function(){this._pointMap.forEach((function(t){t.marker.remove()})),this._pointMap.clear()},i}(t.Evented),ct=["line-opacity","line-color","line-width","line-blur","line-dasharray"],_t=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],dt=function(t){function i(e){var i,o,r=t.call(this)||this;return r._id=k(),r._initState(),r._initStyle(null==e?void 0:e.style),r._initFinishedStyle(null==e?void 0:e.finishedStyle),r._enableBackspace=null!==(i=null==e?void 0:e.enableBackspace)&&void 0!==i&&i,r._enableEnter=null!==(o=null==e?void 0:e.enableEnter)&&void 0!==o&&o,V(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],r),r}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},i.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},i.prototype.getData=function(){return this._finished?e.clone(this._data):null},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._lineLayer)||void 0===i||i.remove(),this._vertexLayer=new z({id:"line-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._lineLayer=new z({id:"line-picker-line-".concat(this._id),type:"line",data:this._getLineSourceData(),paint:t.line}),null===(o=this._lineLayer)||void 0===o||o.addTo(this._map),null===(r=this._vertexLayer)||void 0===r||r.addTo(this._map)},i.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){ct.includes(o)?i[o]=t[o]:_t.includes(o)&&(e[o.replace("vertex","circle")]=t[o])})),{line:i,vertex:e}},i.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={line:O(O({},A),e.line),vertex:O(O(O({},I),e.vertex),{"circle-pitch-alignment":"map"})}},i.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={line:O(O(O({},this._style.line),{"line-dasharray":[1,0]}),e.line),vertex:O(O({},this._style.vertex),e.vertex)}},i.prototype._initState=function(){this._data=null,this._vertexList=[],this._lineCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!1,this._preFinishedOnVertex=!1,this._mouseOnVertex=!1},i.prototype._removeLayer=function(){var t,e;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._lineLayer)||void 0===e||e.remove(),this._vertexLayer=void 0,this._lineLayer=void 0},i.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},i.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},i.prototype._updateLine=function(){var t;this._data=this._getLineSourceData(),null===(t=this._lineLayer)||void 0===t||t.setData(e.clone(this._data))},i.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},i.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},i.prototype._getIndex=function(t,i){return t.findIndex((function(t){return e.booleanEqual(e.point(t),e.point(i))}))},i.prototype._handleMouseMove=function(t){this._lineCoordinates=E([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,this._preFinishedOnVertex=!1,-1===e?(this._lineCoordinates.push(t),this._preFinished=!0):this._vertexList.length>1&&(e===this._vertexList.length-2||e===this._vertexList.length-1?this._preFinished=!0:(this._lineCoordinates.push(t),0===e?this._preFinished=!0:this._preFinishedOnVertex=!0)),this._updateLine()},i.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},i.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?this._vertexList=E([],this._lineCoordinates,!0):(this._picking=!0,this._vertexList=[t.lngLat.toArray()],this._lineCoordinates=E([],this._vertexList,!0)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateLine(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},i.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:e.clone(this._data),length:e.length(this._data,{units:"meters"})})},i.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},i.prototype._enterComplete=function(){!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&(this._vertexList=E([],this._lineCoordinates,!0),this._complete())},i.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&(this._preFinished||this._preFinishedOnVertex)&&this._complete()},i.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},i.prototype._getVertexSourceData=function(){return e.featureCollection(this._vertexList.map((function(t,i){return e.point(t,{id:i})})))},i.prototype._getLineSourceData=function(){return this._lineCoordinates.length>1?e.lineString(this._lineCoordinates):e.featureCollection([])},i}(t.Evented),gt=["fill-opacity","fill-color"],ft=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],yt=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],vt=function(t){function i(e){var i,o,r=t.call(this)||this;return r._id=k(),r._initState(),r._initStyle(null==e?void 0:e.style),r._initFinishedStyle(null==e?void 0:e.finishedStyle),r._enableBackspace=null!==(i=null==e?void 0:e.enableBackspace)&&void 0!==i&&i,r._enableEnter=null!==(o=null==e?void 0:e.enableEnter)&&void 0!==o&&o,V(["_onMapClick","_onMapDoubleClick","_onMapMouseMove","_onKeyup","_onVertexMouseMove","_onVertexMouseLeave"],r),r}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},i.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},i.prototype.getData=function(){return this._finished?e.clone(this._data):null},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._fillLayer=new z({id:"polygon-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new z({id:"polygon-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._vertexLayer=new z({id:"polygon-area-picker-vertex-".concat(this._id),type:"circle",data:this._getVertexSourceData(),layerCursor:"pointer",mapCursor:"crosshair",paint:t.vertex}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},i.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){gt.includes(r)?o[r]=t[r]:ft.includes(r)?i[r.replace("stroke","line")]=t[r]:yt.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},i.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:O(O({},this._style.fill),e.fill),stroke:O(O(O({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:O(O({},this._style.vertex),e.vertex)}},i.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:O(O({},R),e.fill),stroke:O(O({},A),e.stroke),vertex:O(O(O({},I),e.vertex),{"circle-pitch-alignment":"map"})}},i.prototype._initState=function(){this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._pending=!1,this._finished=!1,this._preFinished=!0,this._mouseOnVertex=!1},i.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},i.prototype._setEventListeners=function(t){var e,i;void 0===t&&(t="on"),null===(e=this._vertexLayer)||void 0===e||e[t]("mousemove",this._onVertexMouseMove),null===(i=this._vertexLayer)||void 0===i||i[t]("mouseleave",this._onVertexMouseLeave),this._map[t]("click",this._onMapClick),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousemove",this._onMapMouseMove),(this._enableBackspace||this._enableEnter)&&("on"===t?window.addEventListener("keyup",this._onKeyup):window.removeEventListener("keyup",this._onKeyup))},i.prototype._onVertexMouseMove=function(t){var e;if(!this._finished&&this._picking){var i=null===(e=t.features)||void 0===e?void 0:e[0];this._mouseOnVertex=!0,this._handleMouseMove(this._vertexList[i.properties.id])}},i.prototype._onVertexMouseLeave=function(){!this._finished&&this._picking&&(this._mouseOnVertex=!1)},i.prototype._getIndex=function(t,i){return t.findIndex((function(t){return e.booleanEqual(e.point(t),e.point(i))}))},i.prototype._onMapClick=function(t){var e=this;this._finished||this._pending||(this._picking?(this._vertexList=E([],this._strokeCoordinates,!0),this._strokeCoordinates=E([],this._fillCoordinates,!0)):(this._picking=!0,this._vertexList.push(t.lngLat.toArray()),this._strokeCoordinates=E([],this._vertexList,!0),this._fillCoordinates=E(E([],this._vertexList,!0),[this._vertexList[0]],!1)),this._mouseOnVertex&&this._preFinished?this._complete():(this._updateVertex(),this._updateStroke(),this._updateFill(),this._pending=!0,window.setTimeout((function(){e._pending=!1}),250)))},i.prototype._onMapDoubleClick=function(t){t.preventDefault(),!this._finished&&this._picking&&this._preFinished&&this._complete()},i.prototype._onMapMouseMove=function(t){this._finished||!this._picking||this._mouseOnVertex||this._handleMouseMove(t.lngLat.toArray())},i.prototype._handleMouseMove=function(t){this._strokeCoordinates=E([],this._vertexList,!0);var e=this._getIndex(this._vertexList,t);this._preFinished=!1,-1===e?(this._strokeCoordinates.push(t),this._fillCoordinates=E(E([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1),this._vertexList.length>1&&(this._preFinished=!0)):this._vertexList.length>2?e===this._vertexList.length-1?(this._preFinished=!0,this._fillCoordinates=E(E([],this._strokeCoordinates,!0),[this._vertexList[0]],!1)):0===e?(this._preFinished=!0,this._strokeCoordinates.push(t),this._fillCoordinates=E([],this._strokeCoordinates,!0)):(this._preFinished=!0,this._fillCoordinates=E(E([],this._strokeCoordinates,!0),[this._strokeCoordinates[0]],!1)):this._fillCoordinates=E([],this._strokeCoordinates,!0),this._updateStroke(),this._updateFill()},i.prototype._enterComplete=function(){!this._finished&&this._picking&&this._preFinished&&(this._vertexList=E([],this._strokeCoordinates,!0),this._strokeCoordinates=E([],this._fillCoordinates,!0),this._complete())},i.prototype._complete=function(){this._picking=!1,this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:e.clone(this._data),acreage:e.area(this._data)})},i.prototype._onKeyup=function(t){"Backspace"===t.code||"Enter"===t.code&&this._enableEnter&&this._enterComplete()},i.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},i.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},i.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(e.clone(this._data))},i.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},i.prototype._getVertexSourceData=function(){return e.featureCollection(this._vertexList.map((function(t,i){return e.point(t,{id:i})})))},i.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?e.lineString(this._strokeCoordinates):e.featureCollection([])},i.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?e.combine(e.unkinkPolygon(e.polygon([this._fillCoordinates]))).features[0]:e.featureCollection([])},i}(t.Evented),mt=["fill-opacity","fill-color"],Lt=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],bt=["vertex-radius","vertex-color","vertex-opacity","vertex-stroke-width","vertex-stroke-color","vertex-stroke-opacity"],kt=function(t){function i(e){var i=t.call(this)||this;return i._id=k(),i._initState(),i._initStyle(null==e?void 0:e.style),i._initFinishedStyle(null==e?void 0:e.finishedStyle),V(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],i),i}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},i.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},i.prototype.getData=function(){return this._finished&&this._data?e.clone(this._data):null},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._initLayer=function(t){var e,i,o,r,n,s;null===(e=this._vertexLayer)||void 0===e||e.remove(),null===(i=this._strokeLayer)||void 0===i||i.remove(),null===(o=this._fillLayer)||void 0===o||o.remove(),this._vertexLayer=new z({id:"rect-area-picker-vertex-".concat(this._id),type:"circle",layerCursor:"pointer",mapCursor:"crosshair",data:this._getVertexSourceData(),paint:t.vertex}),this._strokeLayer=new z({id:"rect-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),this._fillLayer=new z({id:"rect-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),null===(r=this._fillLayer)||void 0===r||r.addTo(this._map),null===(n=this._strokeLayer)||void 0===n||n.addTo(this._map),null===(s=this._vertexLayer)||void 0===s||s.addTo(this._map)},i.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null),o=Object.create(null);return Object.keys(t).forEach((function(r){mt.includes(r)?o[r]=t[r]:Lt.includes(r)?i[r.replace("stroke","line")]=t[r]:bt.includes(r)&&(e[r.replace("vertex","circle")]=t[r])})),{fill:o,stroke:i,vertex:e}},i.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:O(O({},R),e.fill),stroke:O(O({},A),e.stroke),vertex:O(O(O({},I),e.vertex),{"circle-pitch-alignment":"map"})}},i.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:O(O({},this._style.fill),e.fill),stroke:O(O(O({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke),vertex:O(O({},this._style.vertex),e.vertex)}},i.prototype._removeLayer=function(){var t,e,i;null===(t=this._vertexLayer)||void 0===t||t.remove(),null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._vertexLayer=void 0,this._strokeLayer=void 0,this._fillLayer=void 0},i.prototype._initState=function(){this._nw=null,this._se=null,this._data=null,this._vertexList=[],this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},i.prototype._getVertexSourceData=function(){return e.featureCollection(this._vertexList.map((function(t,i){return e.point(t,{id:i})})))},i.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?e.lineString(this._strokeCoordinates):e.featureCollection([])},i.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?e.polygon([this._fillCoordinates]):e.featureCollection([])},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},i.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._nw=t.lngLat.toArray(),t.preventDefault())},i.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._vertexList.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:e.clone(this._data),acreage:e.area(this._data)})))},i.prototype._onMapDoubleClick=function(t){t.preventDefault()},i.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){this._se=t.lngLat.toArray();var i=e.bboxPolygon(e.bbox(e.lineString([this._nw,this._se])));0===e.area(i)?(this._fillCoordinates=[],this._strokeCoordinates=[],this._vertexList=[]):(this._fillCoordinates=E([],i.geometry.coordinates[0],!0),this._strokeCoordinates=E([],this._fillCoordinates,!0),this._vertexList=this._fillCoordinates.slice(0,-1)),this._updateVertex(),this._updateStroke(),this._updateFill()}},i.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},i.prototype._updateVertex=function(){var t;null===(t=this._vertexLayer)||void 0===t||t.setData(this._getVertexSourceData())},i.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(e.clone(this._data))},i.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},i}(t.Evented),Mt=["fill-opacity","fill-color"],xt=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],Pt=function(t){function i(e){var i=t.call(this)||this;return i._id=k(),i._initState(),i._initStyle(null==e?void 0:e.style),i._initFinishedStyle(null==e?void 0:e.finishedStyle),i._steps=(null==e?void 0:e.steps)||64,V(["_onMapDoubleClick","_onMouseMove","_onMouseDown","_onMouseUp"],i),i}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(this._style),this._setEventListeners("on"),this._map.getCanvas().style.cursor="crosshair"),this},i.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._initState(),this._removeLayer(),this._map.getCanvas().style.cursor="",this._map=void 0),this},i.prototype.clear=function(){this._map&&(this._initState(),this._initLayer(this._style))},i.prototype.getData=function(){return this._finished&&this._data?e.clone(this._data):null},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._removeLayer=function(){var t,e;null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),this._strokeLayer=void 0,this._fillLayer=void 0},i.prototype._initState=function(){this._center=null,this._radius=null,this._data=null,this._strokeCoordinates=[],this._fillCoordinates=[],this._picking=!1,this._finished=!1},i.prototype._getStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){Mt.includes(o)?i[o]=t[o]:xt.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),{fill:i,stroke:e}},i.prototype._initFinishedStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._finishedStyle={fill:O(O({},this._style.fill),e.fill),stroke:O(O(O({},this._style.stroke),{"line-dasharray":[1,0]}),e.stroke)}},i.prototype._initStyle=function(t){void 0===t&&(t={});var e=this._getStyle(t);this._style={fill:O(O({},R),e.fill),stroke:O(O({},A),e.stroke)}},i.prototype._initLayer=function(t){var e,i,o,r;null===(e=this._strokeLayer)||void 0===e||e.remove(),null===(i=this._fillLayer)||void 0===i||i.remove(),this._fillLayer=new z({id:"circle-area-picker-fill-".concat(this._id),type:"fill",data:this._getFillSourceData(),paint:t.fill}),this._strokeLayer=new z({id:"circle-area-picker-stroke-".concat(this._id),type:"line",data:this._getStrokeSourceData(),paint:t.stroke}),null===(o=this._fillLayer)||void 0===o||o.addTo(this._map),null===(r=this._strokeLayer)||void 0===r||r.addTo(this._map)},i.prototype._getStrokeSourceData=function(){return this._strokeCoordinates.length>1?e.featureCollection([e.lineString(this._strokeCoordinates)]):e.featureCollection([])},i.prototype._getFillSourceData=function(){return this._fillCoordinates.length>3?e.polygon([this._fillCoordinates]):e.featureCollection([])},i.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("dblclick",this._onMapDoubleClick),this._map[t]("mousedown",this._onMouseDown),this._map[t]("mouseup",this._onMouseUp),this._map[t]("mousemove",this._onMouseMove)},i.prototype._onMouseDown=function(t){this._finished||(this._picking=!0,this._center=t.lngLat.toArray(),t.preventDefault())},i.prototype._onMouseUp=function(){this._finished||(this._picking=!1,this._fillCoordinates.length&&(this._finished=!0,this._setFinishedStyle(),this.fire("finish",{data:e.clone(this._data),center:E([],this._center,!0),radius:this._radius,acreage:e.area(this._data)})))},i.prototype._onMapDoubleClick=function(t){t.preventDefault()},i.prototype._onMouseMove=function(t){if(!this._finished&&this._picking){var i={units:"kilometers"};this._radius=e.distance(this._center,t.lngLat.toArray(),i);var o=e.circle(this._center,this._radius,O(O({},i),{steps:this._steps}));0===e.area(o)?(this._fillCoordinates=[],this._strokeCoordinates=[]):(this._fillCoordinates=E([],o.geometry.coordinates[0],!0),this._strokeCoordinates=E([],this._fillCoordinates,!0)),this._updateStroke(),this._updateFill()}},i.prototype._updateStroke=function(){var t;null===(t=this._strokeLayer)||void 0===t||t.setData(this._getStrokeSourceData())},i.prototype._updateFill=function(){var t;this._data=this._getFillSourceData(),null===(t=this._fillLayer)||void 0===t||t.setData(e.clone(this._data))},i.prototype._setFinishedStyle=function(){this._initLayer(this._finishedStyle)},i}(t.Evented),Ot={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},Et={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},St=["fill-opacity","fill-color"],Ct=["stroke-opacity","stroke-color","stroke-width","stroke-blur","stroke-dasharray"],Bt=["meters","kilometers"],Ft=function(t){function i(e){var i,o=t.call(this)||this;return o._id=k(),o._center=null==e?void 0:e.center,o._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:5,o._units=(null==e?void 0:e.units)&&Bt.includes(e.units)?e.units:"kilometers",o._steps=(null==e?void 0:e.steps)&&e.steps>2?e.steps:64,o._manual=null!==(i=e.manual)&&void 0!==i&&i,o._initData(),o._initStyle(e.style),o._initLayer(e.centerLayer?O({show:!0,type:"circle"},e.centerLayer):{show:!0,type:"circle"}),V(["_onMapClick"],o),o}return x(i,t),Object.defineProperty(i.prototype,"center",{get:function(){return this._center},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){var e,i,o;return t===this._map||(this.remove(),this._map=t,null===(e=this._strokeLayer)||void 0===e||e.addTo(t).setData(this._bufferData),null===(i=this._fillLayer)||void 0===i||i.addTo(t).setData(this._bufferData),null===(o=this._centerLayer)||void 0===o||o.addTo(t).setData(this._centerData),this._manual&&(this._map.on("click",this._onMapClick),this._map.getCanvas().style.cursor="crosshair")),this},i.prototype.remove=function(){var t,e,i;return this._map&&(null===(t=this._strokeLayer)||void 0===t||t.remove(),null===(e=this._fillLayer)||void 0===e||e.remove(),null===(i=this._centerLayer)||void 0===i||i.remove(),this._manual&&(this._map.off("click",this._onMapClick),this._map.getCanvas().style.cursor=""),this._map=void 0),this},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype.clear=function(){return this._center=void 0,this._update(),this},i.prototype.setOptions=function(t){return t.center&&(this._center=t.center),t.radius&&(this._radius=t.radius),t.units&&Bt.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>2&&(this._steps=t.steps),this._update(),this},i.prototype.getData=function(){return this._center?e.clone(this._bufferData):null},i.prototype._initStyle=function(t){void 0===t&&(t={});var e=Object.create(null),i=Object.create(null);Object.keys(t).forEach((function(o){St.includes(o)?i[o]=t[o]:Ct.includes(o)&&(e[o.replace("stroke","line")]=t[o])})),this._style={fill:i,stroke:e}},i.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){G.includes(i)&&(e[i]=t[i])})),e},i.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){W.includes(o)?i[o]=t[o]:Z.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._initLayer=function(t){var e,i;this._fillLayer=new z({id:"buffer-fill-".concat(this._id),type:"fill",paint:this._style.fill}),this._strokeLayer=new z({id:"buffer-stroke-".concat(this._id),type:"line",paint:this._style.stroke}),t.show&&"symbol"!==t.type&&(this._centerLayer=new z({id:"buffer-center-".concat(this._id),type:"circle",paint:this._getCirclePaint(O(O({},Ot),null!==(e=null==t?void 0:t.style)&&void 0!==e?e:{}))})),t.show&&"symbol"===t.type&&(this._centerLayer=new z(O({id:"buffer-center-".concat(this._id),type:"symbol"},this._getSymbolStyle(O(O({},Et),null!==(i=t.style)&&void 0!==i?i:{})))))},i.prototype._onMapClick=function(t){this._center=t.lngLat.toArray(),this._update(),this.fire("change",{center:t.lngLat,radius:this._radius,units:this._units,buffer:e.clone(this._bufferData)})},i.prototype._update=function(){var t,e,i;this._initData(),null===(t=this._fillLayer)||void 0===t||t.setData(this._bufferData),null===(e=this._strokeLayer)||void 0===e||e.setData(this._bufferData),null===(i=this._centerLayer)||void 0===i||i.setData(this._centerData)},i.prototype._initData=function(){this._center?(this._centerData=e.point(this._center),this._bufferData=e.circle(this._center,this._radius,{units:this._units,steps:this._steps})):(this._centerData=e.featureCollection([]),this._bufferData=e.featureCollection([]))},i}(t.Evented),Dt={"circle-color":"#000000","circle-radius":5,"circle-blur":0,"circle-opacity":1,"circle-stroke-width":0,"circle-stroke-color":"#000000","circle-stroke-opacity":1},Tt=function(i){function o(t){var e,o,r=i.call(this)||this;return r._styleMap=new Map,r._clickHighlightPropVal=void 0,r._hoverHighlightPropVal=void 0,r._expressionMap=new Map,r._id=k(),r._layerId="circle-cluster-layer-point-".concat(r._id),r._clusterLayerId="circle-cluster-layer-cluster-".concat(r._id),r._clusterLabelLayerId="circle-cluster-label-layer-cluster-".concat(r._id),r._key=null!==(e=t.key)&&void 0!==e?e:"id",r._data=t.data,r._styleOptions=t.style,r._clusterStyleOptions=t.clusterStyle,r._clusterRadius=null!==(o=t.clusterRadius)&&void 0!==o?o:250,r._highlightOptions=t.highlightOptions,r._fitBoundsOptions=r._getFitBoundsOptions(t.fitBoundsOptions),r._setLngLatBounds(),r._highlightOptions&&r._initHighlight(),V(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_OnData"],r),r}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},o.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},o.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},o.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:null},o.prototype._initHighlight=function(){var t=this;Object.keys(Dt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._styleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:Dt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._addLayerAndSource=function(){var t;if(this._map){this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50});var e=this._getStyle(this._clusterStyleOptions),i=e.textStyle,o=e.circleStyle;this._map.getLayer(this._clusterLayerId)||this._map.addLayer(O({id:this._clusterLayerId,type:"circle",source:this._layerId,filter:["has","cluster_id"]},o)),this._map.getLayer(this._clusterLabelLayerId)||this._map.addLayer(O({id:this._clusterLabelLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},i)),this._map.getLayer(this._layerId)||this._map.addLayer({id:this._layerId,type:"circle",source:this._layerId,filter:["!",["has","cluster_id"]],paint:this._getPaint(this._styleOptions),layout:{visibility:"visible"}}),this._highlightOptions&&this._setHighlight()}},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){G.includes(i)&&(e[i]=t[i])})),e},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null),o=Object.create(null),r=Object.create(null);return Object.keys(t).forEach((function(r){Y.includes(r)?i[r]=t[r]:U.includes(r)?e[r]=t[r]:G.includes(r)&&(o[r]=t[r])})),i.visibility="visible",r.visibility="visible",{textStyle:{paint:e,layout:i},circleStyle:{paint:o,layout:r}}},o.prototype._OnData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._OnData)},o.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},o.prototype._getPoint=function(e){return{data:O({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",O(O({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",O(O({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",O(O({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._styleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,E(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"circle-sort-key",["case",e,2,0])},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._removeLayerAndSource=function(){var t,e,i,o;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getLayer(this._clusterLabelLayerId))&&this._map.removeLayer(this._clusterLabelLayerId),(null===(o=this._map)||void 0===o?void 0:o.getSource(this._layerId))&&this._map.removeSource(this._layerId)},o}(t.Evented),Ht={"icon-image":"","icon-size":1,"icon-offset":[0,0],"text-field":"","text-size":16,"text-offset":[0,0]},wt={"icon-opacity":1,"icon-color":"#000000","icon-halo-color":"rgba(0,0,0,0)","icon-halo-width":0,"icon-halo-blur":0,"text-opacity":1,"text-color":"#000000","text-halo-color":"rgba(0,0,0,0)","text-halo-width":1,"text-halo-blur":1},jt=function(i){function o(t){var e,o,r=i.call(this)||this;return r._layoutStyleMap=new Map,r._paintStyleMap=new Map,r._clickHighlightPropVal=void 0,r._hoverHighlightPropVal=void 0,r._expressionMap=new Map,r._id=k(),r._layerId="symbol-cluster-layer-point-".concat(r._id),r._clusterLayerId="symbol-cluster-layer-cluster-".concat(r._id),r._key=null!==(e=t.key)&&void 0!==e?e:"id",r._data=t.data,r._styleOptions=t.style,r._clusterStyleOptions=t.clusterStyle,r._clusterRadius=null!==(o=t.clusterRadius)&&void 0!==o?o:250,r._highlightOptions=t.highlightOptions,r._fitBoundsOptions=r._getFitBoundsOptions(t.fitBoundsOptions),r._setLngLatBounds(),r._highlightOptions&&r._initHighlight(),V(["_onClick","_onClusterClick","_onMouseEnter","_onMouseMove","_onMouseLeave","_onData"],r),r}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._addLayerAndSource(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._removeLayerAndSource(),this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){if(this._data=t,this._setLngLatBounds(),this._map){this.removeHighlight();var e=this._map.getSource(this._layerId);null==e||e.setData(this._data),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)}return this},o.prototype.setHighlight=function(t){return this._map&&this._highlightOptions&&("hover"===this._highlightOptions.trigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight()),this},o.prototype.removeHighlight=function(){return this._map&&this._highlightOptions&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._getFeature=function(t){var e,i;if(this._data){var o=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this._layerId,{sourceLayer:this._layerId,filter:["==",["get",this._key],t]})[0];if(o)return o;for(var r=0;r<this._data.features.length;r++)if((null===(i=this._data.features[r].properties)||void 0===i?void 0:i[this._key])===t){o=this._data.features[r];break}return o}},o.prototype._setLngLatBounds=function(){this._lngLatBounds=this._data.features.length>0?e.bboxPolygon(e.bbox(this._data)).bbox:null},o.prototype._initHighlight=function(){var t=this;Object.keys(Ht).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._layoutStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:Ht[e]])})),Object.keys(wt).forEach((function(e){var i,o=t._highlightOptions.style[e];void 0!==o&&t._paintStyleMap.set(e,[o,null!==(i=t._styleOptions[e])&&void 0!==i?i:wt[e]])}));var e="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var i;return["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("hover",(function(){var i;return["==",["get",t._key],null!==(i=t._hoverHighlightPropVal)&&void 0!==i?i:e]})),this._expressionMap.set("both",(function(){var i,o;return["any",["==",["get",t._key],null!==(i=t._clickHighlightPropVal)&&void 0!==i?i:e],["==",["get",t._key],null!==(o=t._hoverHighlightPropVal)&&void 0!==o?o:e]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._addLayerAndSource=function(){var t;this._map&&(this._map.getSource(this._layerId)||this._map.addSource(this._layerId,{type:"geojson",generateId:!0,data:this._data,cluster:!0,clusterRadius:null!==(t=this._clusterRadius)&&void 0!==t?t:50}),this._map.getLayer(this._clusterLayerId)||this._map.addLayer(O({id:this._clusterLayerId,type:"symbol",source:this._layerId,filter:["has","cluster_id"]},this._getStyle(this._clusterStyleOptions))),this._map.getLayer(this._layerId)||this._map.addLayer(O({id:this._layerId,type:"symbol",source:this._layerId,filter:["!",["has","cluster_id"]]},this._getStyle(this._styleOptions))),this._highlightOptions&&this._setHighlight())},o.prototype._getStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){W.includes(o)?i[o]=t[o]:Z.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},o.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addLayerAndSource()}),10)},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._map[t]("click",this._layerId,this._onClick),this._map[t]("click",this._clusterLayerId,this._onClusterClick),this._map[t]("mouseenter",this._layerId,this._onMouseEnter),this._map[t]("mousemove",this._layerId,this._onMouseMove),this._map[t]("mouseleave",this._layerId,this._onMouseLeave),this._map[t]("data",this._onData)},o.prototype._onClusterClick=function(t){var e,i,o=this,r=t.features[0];this._map.getSource(this._layerId).getClusterLeaves(null===(e=r.properties)||void 0===e?void 0:e.cluster_id,null===(i=r.properties)||void 0===i?void 0:i.point_count,0,(function(t,e){t||o.fire("cluster-click",{points:null==e?void 0:e.map((function(t){return o._getPoint(t)}))})}))},o.prototype._getPoint=function(e){return{data:O({},e.properties),lngLat:new t.LngLat(e.geometry.coordinates[0],e.geometry.coordinates[1])}},o.prototype._onClick=function(t){var e,i,o,r=this,n=t.features[0];if(this.fire("click",O(O({},this._getPoint(n)),{originalMapEvent:t,points:null===(e=t.features)||void 0===e?void 0:e.map((function(t){return r._getPoint(t)}))})),"click"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var s=n.properties[this._key];this._clickHighlightPropVal!==s&&(this._clickHighlightPropVal=s,this._setHighlight())}},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",O(O({},this._getPoint(i)),{originalMapEvent:t})),this._map.getCanvas().style.cursor="pointer"},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",O(O({},this._getPoint(r)),{originalMapEvent:t})),"hover"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)||"both"===(null===(o=this._highlightOptions)||void 0===o?void 0:o.trigger)){var n=t.features[0].properties[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){var e,i;this.fire("mouseleave",{originalMapEvent:t}),this._map.getCanvas().style.cursor="","hover"===(null===(e=this._highlightOptions)||void 0===e?void 0:e.trigger)&&(this._hoverHighlightPropVal=void 0,this._removeHighlight()),"both"===(null===(i=this._highlightOptions)||void 0===i?void 0:i.trigger)&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._setHighlight=function(){var t=this,e=this._expressionMap.get(this._highlightOptions.trigger)();this._paintStyleMap.forEach((function(i,o){t._map.setPaintProperty(t._layerId,o,E(["case",e],i,!0))})),this._layoutStyleMap.forEach((function(i,o){t._map.setLayoutProperty(t._layerId,o,E(["case",e],i,!0))})),this._map.setLayoutProperty(this._layerId,"symbol-sort-key",["case",e,2,0])},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o.prototype._removeLayerAndSource=function(){var t,e,i;(null===(t=this._map)||void 0===t?void 0:t.getLayer(this._layerId))&&this._map.removeLayer(this._layerId),(null===(e=this._map)||void 0===e?void 0:e.getLayer(this._clusterLayerId))&&this._map.removeLayer(this._clusterLayerId),(null===(i=this._map)||void 0===i?void 0:i.getSource(this._layerId))&&this._map.removeSource(this._layerId)},o}(t.Evented),Vt={"circle-color":"#f00","circle-radius":5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"},It={"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map"},At={"line-width":5,"line-color":"#f00","line-cap":"round","line-join":"round"},Rt={"line-width":5,"line-color":"#0f0","line-cap":"round","line-join":"round"},Nt=function(t){function i(i){var o,r,n,s,a=t.call(this)||this;return a._id=k(),a._data=i.data,a._isFull=null===(r=null===(o=i.pathLayer)||void 0===o?void 0:o.isFull)||void 0===r||r,a._units="kilometers",a._speed=null!==(n=i.speed)&&void 0!==n?n:5,a._loop=null===(s=i.loop)||void 0===s||s,a._originPathLayerData=e.lineString(a._data),a._initLength(),a._initState(),a._layerOptions={carLayer:i.carLayer?O({show:!1,type:"circle"},i.carLayer):{show:!1,type:"circle"},currentPathLayer:i.currentPathLayer?O({show:!0},i.currentPathLayer):{show:!0},pathLayer:i.pathLayer?O({show:!0},i.pathLayer):{show:!0}},a._fitBoundsOptions=a._getFitBoundsOptions(i.fitBoundsOptions),a._lngLatBounds=e.bboxPolygon(e.bbox(a._originPathLayerData)).bbox,V(["_animate"],a),a}return x(i,t),Object.defineProperty(i.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),i.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._initLayer(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},i.prototype.remove=function(){var t,e,i;return this._map&&(cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._pathLayer)||void 0===t||t.remove(),null===(e=this._currentPathLayer)||void 0===e||e.remove(),null===(i=this._carLayer)||void 0===i||i.remove(),this._map=void 0),this},i.prototype.setSpeed=function(t){return this._speed=t,this},i.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},i.prototype.stop=function(){var t,i,o;cancelAnimationFrame(this._fRecord),this._initState(),null===(t=this._carLayer)||void 0===t||t.setData(this._carLayerData),null===(i=this._currentPathLayer)||void 0===i||i.setData(e.featureCollection([])),this._isFull||null===(o=this._pathLayer)||void 0===o||o.setData(this._originPathLayerData)},i.prototype.play=function(){this._isPlaying||(this._finished&&this._initState(),this._isPlaying=!0,this._fRecord=requestAnimationFrame(this._animate))},i.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,cancelAnimationFrame(this._fRecord),this._pending=!0)},i.prototype.replay=function(){cancelAnimationFrame(this._fRecord),this._initState(),this.play()},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i),this},i.prototype._initState=function(){this._current=0,this._isPlaying=!1,this._startTime=0,this._finished=!1,this._currentLength=0,this._pending=!1,this._bearing=e.bearing(e.point(this._data[0]),e.point(this._data[1])),this._carLayerData=e.point(this._data[0],{bearing:this._bearing}),this._currentPathLayerData=void 0},i.prototype._initLength=function(){var t=this;this._pointLength=[];var i=0;this._data.forEach((function(o,r){if(0!==r){var n=e.distance(e.point(o),e.point(t._data[r-1]),{units:t._units});i+=n}t._pointLength.push(i)})),this._routeLength=i},i.prototype._animate=function(t){var i,o,r,n;if(this._pending)return this._pending=!1,this._startTime=t,void(this._fRecord=requestAnimationFrame(this._animate));var s=void 0;if(0===this._startTime)this._startTime=t,s=this._originPathLayerData;else{var a=t-this._startTime;if(this._startTime=t,this._currentLength+=a/1e3*this._speed,this._currentLength>=this._routeLength)this._carLayerData=e.point(this._data[this._data.length-1]),this._currentLength=this._routeLength,this._finished=!0,this._currentPathLayerData=this._originPathLayerData;else{this._carLayerData=e.along(this._originPathLayerData,this._currentLength);for(var h=this._current;h<this._pointLength.length&&!(this._pointLength[h]>this._currentLength);)h++;h!==this._current&&(this._current=h,this._bearing=e.bearing(this._carLayerData,e.point(this._data[this._current]))),this._currentPathLayerData=e.lineString(E(E([],this._data.slice(0,this._current),!0),[this._carLayerData.geometry.coordinates],!1)),s=e.lineString(E([this._carLayerData.geometry.coordinates],this._data.slice(this._current),!0))}}this._carLayerData.properties={bearing:this._bearing},null===(i=this._carLayer)||void 0===i||i.setData(this._carLayerData),this._isFull||null===(o=this._pathLayer)||void 0===o||o.setData(null!=s?s:e.featureCollection([])),null===(r=this._currentPathLayer)||void 0===r||r.setData(null!==(n=this._currentPathLayerData)&&void 0!==n?n:e.featureCollection([])),this._finished&&(this._loop?(this._initState(),this._isPlaying=!0):(this._isPlaying=!1,this.fire("finish"))),this._isPlaying&&(this._fRecord=requestAnimationFrame(this._animate))},i.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},i.prototype._getCirclePaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){G.includes(i)&&(e[i]=t[i])})),e},i.prototype._getSymbolStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){W.includes(o)?i[o]=t[o]:Z.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._getPathStyle=function(t){var e=Object.create(null),i=Object.create(null);return Object.keys(t).forEach((function(o){q.includes(o)?i[o]=t[o]:$.includes(o)&&(e[o]=t[o])})),i.visibility="visible",{paint:e,layout:i}},i.prototype._initLayer=function(){var t,e,i,o,r,n,s,a=this._layerOptions,h=a.carLayer,l=a.currentPathLayer,u=a.pathLayer;u.show&&(this._pathLayer=new z(O({id:"car-track-full-path-".concat(this._id),type:"line",data:this._originPathLayerData},this._getPathStyle(O(O({},Rt),null!==(t=null==u?void 0:u.style)&&void 0!==t?t:{}))))),l.show&&(this._currentPathLayer=new z(O({id:"car-track-current-path-".concat(this._id),type:"line"},this._getPathStyle(O(O({},At),null!==(e=null==l?void 0:l.style)&&void 0!==e?e:{}))))),h.show&&"symbol"!==h.type&&(this._carLayer=new z({id:"car-track-car-".concat(this._id),type:"circle",data:this._carLayerData,paint:this._getCirclePaint(O(O({},Vt),null!==(i=null==h?void 0:h.style)&&void 0!==i?i:{}))})),h.show&&"symbol"===h.type&&(this._carLayer=new z(O({id:"car-track-car-".concat(this._id),type:"symbol",data:this._carLayerData},this._getSymbolStyle(O(O({},It),null!==(o=h.style)&&void 0!==o?o:{}))))),null===(r=this._pathLayer)||void 0===r||r.addTo(this._map),null===(n=this._currentPathLayer)||void 0===n||n.addTo(this._map),null===(s=this._carLayer)||void 0===s||s.addTo(this._map)},i}(t.Evented);function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}var $t="object"===("undefined"==typeof HTMLElement?"undefined":zt(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===zt(t)&&(1===t.nodeType||9===t.nodeType)&&"string"==typeof t.nodeName};function qt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(arguments.length<2)){for(var i=[],o=0;o<arguments.length;o++)i.push(t[o]);var r=[];return i.forEach((function(t,e){r[e]=a.bind(null,t,i.filter((function(t,i){return i!==e})))})),n(),function(){s(),r=[],i=[]}}function n(){i.forEach((function(t,e){t.on("move",r[e])}))}function s(){i.forEach((function(t,e){t.off("move",r[e])}))}function a(t,e){s(),function(t,e){var i=t.getCenter(),o=t.getZoom(),r=t.getBearing(),n=t.getPitch();e.forEach((function(t){t.jumpTo({center:i,zoom:o,bearing:r,pitch:n})}))}(t,e),n()}}var Gt=function(){function e(e){if(this._removed=!1,this._horizontal=Boolean(e.horizontal),"string"==typeof e.container){var i=document.querySelector(e.container);if(!i)throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=i}else{if(!$t(e.container))throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._container=e.container}this._container.classList.add("map-comparer-container"),this._container.style.position="relative";var o=document.createElement("div");o.classList.add("before-map-container"),o.style.position="absolute",o.style.width="100%",o.style.height="100%",this._container.appendChild(o);var r=document.createElement("div");r.classList.add("after-map-container"),r.style.position="absolute",r.style.width="100%",r.style.height="100%",this._container.appendChild(r),this._swiper=document.createElement("div"),this._swiper.className="comparer-swiper",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"map-comparer-control comparer-control-horizontal":"map-comparer-control comparer-control-vertical",this._controlContainer.appendChild(this._swiper),this._container.appendChild(this._controlContainer),this._firstMap=new t.Map(O(O({},e.mapOptions),{style:e.firstMapStyle,container:o})),this._secondMap=new t.Map(O(O({},e.mapOptions),{style:e.secondMapStyle,container:r})),qt(this._firstMap,this._secondMap),V(["_onResize","_onMove","_onDown","_onTouchEnd","_onMouseUp"],this),this._secondMap.on("resize",this._onResize),this._bounds=this._secondMap.getContainer().getBoundingClientRect();var n=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(n),this._mousemove&&(this._firstMap.getContainer().addEventListener("mousemove",this._onMove),this._secondMap.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}return Object.defineProperty(e.prototype,"firstMap",{get:function(){return this._firstMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"secondMap",{get:function(){return this._secondMap},enumerable:!1,configurable:!0}),e.prototype._onResize=function(){var t=this._horizontal?this._bounds.height:this._bounds.width,e=this.currentPosition/t;this._bounds=this._secondMap.getContainer().getBoundingClientRect(),t=this._horizontal?this._bounds.height:this._bounds.width,this._setPosition(t*e)},e.prototype._setPosition=function(t){t=Math.min(t,this._horizontal?this._bounds.height:this._bounds.width);var e=this._horizontal?"translate(0, "+t+"px)":"translate("+t+"px, 0)";this._controlContainer.style.transform=e,this._controlContainer.style.webkitTransform=e;var i=this._horizontal?"rect(0, 999em, "+t+"px, 0)":"rect(0, "+t+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+t+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+t+"px)";this._firstMap.getContainer().style.clip=i,this._secondMap.getContainer().style.clip=o,this.currentPosition=t},e.prototype._setPointerEvents=function(t){this._controlContainer.style.pointerEvents=t,this._swiper.style.pointerEvents=t},e.prototype._onMove=function(t){this._mousemove&&this._setPointerEvents(t.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(t)):this._setPosition(this._getX(t))},e.prototype._getY=function(t){var e=(t=t.touches?t.touches[0]:t).clientY-this._bounds.top;return e<0&&(e=0),e>this._bounds.height&&(e=this._bounds.height),e},e.prototype._getX=function(t){var e=(t=t.touches?t.touches[0]:t).clientX-this._bounds.left;return e<0&&(e=0),e>this._bounds.width&&(e=this._bounds.width),e},e.prototype._onTouchEnd=function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)},e.prototype._onMouseUp=function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp)},e.prototype._onDown=function(t){t.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},e.prototype.setSlider=function(t){if(!this._removed){var e=this._horizontal?this._bounds.height:this._bounds.width;t>1?t=1:t<0&&(t=0),this._setPosition(t*e)}},e.prototype.remove=function(){var t,e;this._removed||(null===(t=this._firstMap)||void 0===t||t.remove(),null===(e=this._secondMap)||void 0===e||e.remove(),this._container.innerHTML="",this._container.style.position="",this._container.classList.remove("map-comparer-container"),this._removed=!0)},e}(),Wt={"fill-extrusion-opacity":1,"fill-extrusion-pattern":"","fill-extrusion-color":"#000000"},Zt=function(i){function o(t){var e,o,r,n,s=i.call(this)||this;return s._lngLatBounds=null,s._styleMap=new Map,s._clickHighlightPropVal=void 0,s._hoverHighlightPropVal=void 0,s._expressionMap=new Map,s._radius=null!==(e=t.radius)&&void 0!==e?e:10,s._steps=null!==(o=t.steps)&&void 0!==o?o:64,s._key=null!==(r=t.key)&&void 0!==r?r:"id",s._id=k(),s._layer=new z({id:"prismoid-layer-".concat(s._id),type:"fill-extrusion",layerCursor:"pointer",data:s._transformData(t.data),paint:s._getPaint(t.style),layout:{visibility:"visible"}}),s._fitBoundsOptions=s._getFitBoundsOptions(t.fitBoundsOptions),s._setLngLatBounds(t.data),s._highlightTrigger=null===(n=t.highlightOptions)||void 0===n?void 0:n.trigger,t.highlightOptions&&s._initHighlight(t.style,t.highlightOptions.style),V(["_onClick","_onMouseMove","_onMouseLeave","_onMouseEnter"],s),s}return x(o,i),Object.defineProperty(o.prototype,"isOnMap",{get:function(){return Boolean(this._map)},enumerable:!1,configurable:!0}),o.prototype.addTo=function(t){return t===this._map||(this.remove(),this._map=t,this._layer.addTo(t),this._highlightTrigger&&this._setHighlight(),this._setEventListeners("on"),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.remove=function(){return this._map&&(this._setEventListeners("off"),this._layer.remove(),this.removeHighlight(),this._map=void 0),this},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),this},o.prototype.setData=function(t){return this._setLngLatBounds(t),this._layer.setData(this._transformData(t)),this._map&&(this.removeHighlight(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},o.prototype.setHighlight=function(t){return this._map&&this._highlightTrigger?("hover"===this._highlightTrigger?this._hoverHighlightPropVal=t:this._clickHighlightPropVal=t,this._setHighlight(),this):this},o.prototype.removeHighlight=function(){return this._map&&this._highlightTrigger&&this._removeHighlight(),this},o.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:JSON.parse(i.properties.originCoordinates)})),this},o.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:JSON.parse(i.properties.originCoordinates)})),this},o.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},o.prototype._transformData=function(t){var i=this,o=t.features.filter((function(t){return"Point"===t.geometry.type})).map((function(t){return e.circle(t.geometry.coordinates,i._radius,{units:"meters",steps:i._steps,properties:O(O({},t.properties),{originCoordinates:t.geometry.coordinates})})}));return e.featureCollection(o)},o.prototype._getFeature=function(t){var e,i=null===(e=this._layer.querySourceFeature({filter:["==",["get",this._key],t]}))||void 0===e?void 0:e[0];return i||(i=this._layer.queryFeatureFormData(this._key,t))},o.prototype._setLngLatBounds=function(t){this._lngLatBounds=t.features.length>0?e.bboxPolygon(e.bbox(t)).bbox:null},o.prototype._initHighlight=function(t,e){var i=this;Object.keys(Wt).forEach((function(o){var r,n=e[o];void 0!==n&&i._styleMap.set(o,[n,null!==(r=t[o])&&void 0!==r?r:Wt[o]])}));var o="".concat(this._id,"-invalidHighlightPropVal");this._expressionMap.set("click",(function(){var t;return["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("hover",(function(){var t;return["==",["get",i._key],null!==(t=i._hoverHighlightPropVal)&&void 0!==t?t:o]})),this._expressionMap.set("both",(function(){var t,e;return["any",["==",["get",i._key],null!==(t=i._clickHighlightPropVal)&&void 0!==t?t:o],["==",["get",i._key],null!==(e=i._hoverHighlightPropVal)&&void 0!==e?e:o]]}))},o.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},o.prototype._getPaint=function(t){var e=Object.create(null);return Object.keys(t).forEach((function(i){K.includes(i)&&(e[i]=t[i])})),e},o.prototype._setEventListeners=function(t){void 0===t&&(t="on"),this._layer[t]("click",this._onClick),this._layer[t]("mousemove",this._onMouseMove),this._layer[t]("mouseleave",this._onMouseLeave),this._layer[t]("mouseenter",this._onMouseEnter)},o.prototype._getPoint=function(e){var i=e.properties,o=i.originCoordinates,r=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(i[o[r]]=t[o[r]])}return i}(i,["originCoordinates"]),n=JSON.parse(o);return{data:r,lngLat:new t.LngLat(n[0],n[1])}},o.prototype._onClick=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("click",O(O({},this._getPoint(i)),{originalMapEvent:t})),"click"===this._highlightTrigger||"both"===this._highlightTrigger){var o=i.properties[this._key];this._clickHighlightPropVal!==o&&(this._clickHighlightPropVal=o,this._setHighlight())}},o.prototype._onMouseMove=function(t){var e,i,o,r=null===(e=t.features)||void 0===e?void 0:e[0];if(this.fire("mousemove",O(O({},this._getPoint(r)),{originalMapEvent:t})),"hover"===this._highlightTrigger||"both"===this._highlightTrigger){var n=null===(o=null===(i=t.features)||void 0===i?void 0:i[0].properties)||void 0===o?void 0:o[this._key];this._hoverHighlightPropVal!==n&&(this._hoverHighlightPropVal=n,this._setHighlight())}},o.prototype._onMouseLeave=function(t){this.fire("mouseleave",{originalMapEvent:t}),"hover"===this._highlightTrigger?(this._hoverHighlightPropVal=void 0,this._removeHighlight()):"both"===this._highlightTrigger&&(this._hoverHighlightPropVal=void 0,this._setHighlight())},o.prototype._onMouseEnter=function(t){var e,i=null===(e=t.features)||void 0===e?void 0:e[0];this.fire("mouseenter",O(O({},this._getPoint(i)),{originalMapEvent:t}))},o.prototype._setHighlight=function(){var t=this._expressionMap.get(this._highlightTrigger)(),e=Object.create(null),i=Object.create(null);this._styleMap.forEach((function(i,o){e[o]=E(["case",t],i,!0)})),this._layer.setStyle({paint:e,layout:i})},o.prototype._removeHighlight=function(){this._clickHighlightPropVal=void 0,this._hoverHighlightPropVal=void 0,this._setHighlight()},o}(t.Evented),Yt=["none","click","hover","manual"],Ut=function(e){function s(t){var i=e.call(this)||this;return t=j(t),i._map=null,i._lngLatBounds=null,i._highlightFeatureId=null,i._source="advance-point-layer".concat(k()),i._key=t.key||"id",i._data=t.data,i._layerPool=t.layerPool||{},i._layers=t.layers||[],i._highlightTrigger=t.highlightTrigger&&Yt.includes(t.highlightTrigger)?t.highlightTrigger:"none",i._highlightLayers="none"===i._highlightTrigger?[]:t.highlightLayers||[],i._cluster=t.cluster||!1,i._clusterLayers=i._cluster&&t.clusterLayers||[],i._clusterRadius=t.clusterRadius,i._clusterMaxZoom=t.clusterMaxZoom,i._clusterMinPoints=t.clusterMinPoints,i._clusterProperties=t.clusterProperties,i._maxzoom=t.maxzoom,i._fitBoundsOptions=t.fitBoundsOptions||!1,i._isMouseOver=!1,i._setLngLatBounds(),V(["_onClick","_onMouseMove","_onData","_onMouseLeave"],i),i}return x(s,e),Object.defineProperty(s.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"clusterLayers",{get:function(){var t=this;return this._clusterLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-cluster")}))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i]),t._clusterLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-cluster")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),s.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},s.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},s.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,O({},t))),this},s.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||i([])),this.removeHighlight(),this._fitBounds());return this},s.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},s.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},s.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.easeTo(O(O({},e),{center:i.geometry.coordinates})),this},s.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);return i&&this._map.flyTo(O(O({},e||{}),{center:i.geometry.coordinates})),this},s.prototype.on=function(t,i){return e.prototype.on.call(this,t,i)},s.prototype.fire=function(t,i){return e.prototype.fire.call(this,t,i)},s.prototype.once=function(t,i){return e.prototype.once.call(this,t,i)},s.prototype.off=function(t,i){return e.prototype.off.call(this,t,i)},s.prototype._getFeature=function(t){var e,i,r,n=this;if(this._data&&"string"!=typeof this._data){var s=null===(i=null===(e=this._map)||void 0===e?void 0:e.querySourceFeatures(this.source,{filter:["==",["get",this._key],t]}))||void 0===i?void 0:i[0];return s||("FeatureCollection"===this._data.type?s=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[n._key])===t})):"Feature"===this._data.type&&(null===(r=this._data.properties)||void 0===r?void 0:r[this._key])===t&&(s=o(this._data)),s)}},s.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,O({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},s.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?r(n(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=r(n(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},s.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},s.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},s.prototype._onClick=function(e){var i,o,r=this;if(this._map){var n=this._getEventFeature(e.point);if(n)if(this._isDefault(n)&&this._setHighlight(n.id,"click"),this._isBasic(n))this.fire("click",O(O({},this._getData(n)),{originMapEvent:e}));else if(this._isClustered(n)){this._map.getSource(this.source).getClusterLeaves(null===(i=n.properties)||void 0===i?void 0:i.cluster_id,null===(o=n.properties)||void 0===o?void 0:o.point_count,0,(function(i,o){if(!i){var s=n.geometry.coordinates;r.fire("cluster-click",{clusterLeaves:null==o?void 0:o.map((function(t){return r._getData(t)})),originMapEvent:e,lngLat:new t.LngLat(s[0],s[1])})}}))}}},s.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},s.prototype._isBasic=function(t){return E(E([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},s.prototype._isClustered=function(t){return this.clusterLayers.includes(t.layer.id)},s.prototype._getData=function(e){var i=e.geometry.coordinates;return{data:O({},e.properties),lngLat:new t.LngLat(i[0],i[1])}},s.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)],["!",i._getClusterFilter()]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t),["!",i._getClusterFilter()]])})))},s.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},s.prototype._onMouseMove=function(t){var e=this._getEventFeature(t.point);if(e&&this._isBasic(e)){var i=O(O({},this._getData(e)),{originMapEvent:t});this._isMouseOver?this.fire("mousemove",i):(this.fire("mouseenter",i),this._isMouseOver=!0),this._addCursor(),this._setHighlight(e.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:t}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},s.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-point-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-point-layer")},s.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-point-layer")},s.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},s.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i([]),type:"geojson",promoteId:this._key};void 0!==this._cluster&&(e.cluster=this._cluster),void 0!==this._clusterMaxZoom&&(e.clusterMaxZoom=this._clusterMaxZoom),void 0!==this._clusterMinPoints&&(e.clusterMinPoints=this._clusterMinPoints),void 0!==this._clusterProperties&&(e.clusterProperties=this._clusterProperties),void 0!==this._clusterRadius&&(e.clusterRadius=this._clusterRadius),void 0!==this._maxzoom&&(e.maxzoom=this._maxzoom),this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)],["!",t._getClusterFilter()]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId),["!",t._getClusterFilter()]]}))}})),this._cluster&&this.clusterLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),t._getClusterFilter(),null===(r=n.filter)||void 0===r||r]}))}}))}},s.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},s.prototype._getClusterFilter=function(){return!!this._cluster&&["all",["has","cluster_id"],["==",["get","cluster"],!0]]},s.prototype._getGeometryFilter=function(){return["==",["geometry-type"],"Point"]},s.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),this._cluster&&this.clusterLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},s}(t.Evented),Kt=["none","click","hover","manual"],Jt=function(e){function h(t){var i,o=e.call(this)||this;return t=j(t),o._map=null,o._lngLatBounds=null,o._highlightFeatureId=null,o._source="advance-line-layer".concat(k()),o._key=t.key||"id",o._data=t.data,o._lineMetrics=null!==(i=t.lineMetrics)&&void 0!==i&&i,o._layerPool=t.layerPool||{},o._layers=t.layers||[],o._highlightTrigger=t.highlightTrigger&&Kt.includes(t.highlightTrigger)?t.highlightTrigger:"none",o._highlightLayers="none"===o._highlightTrigger?[]:t.highlightLayers||[],o._fitBoundsOptions=t.fitBoundsOptions||!1,o._isMouseOver=!1,o._setLngLatBounds(),V(["_onClick","_onMouseMove","_onData","_onMouseLeave"],o),o}return x(h,e),Object.defineProperty(h.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),h.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},h.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},h.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,O({},t))),this},h.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(this._data||i([])),this.removeHighlight(),this._fitBounds());return this},h.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},h.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},h.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=s(a(i));this._map.easeTo(O(O({},e),{center:[o[0],o[1]]}))}return this},h.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=s(a(i));this._map.flyTo(O(O({},e||{}),{center:[o[0],o[1]]}))}return this},h.prototype.fitTo=function(e,i){if(void 0===i&&(i={}),!this._map)return this;var o=this._getFeature(e);o&&this._map.fitBounds(new t.LngLatBounds(r(n(o)).bbox),i)},h.prototype.on=function(t,i){return e.prototype.on.call(this,t,i)},h.prototype.fire=function(t,i){return e.prototype.fire.call(this,t,i)},h.prototype.once=function(t,i){return e.prototype.once.call(this,t,i)},h.prototype.off=function(t,i){return e.prototype.off.call(this,t,i)},h.prototype._getFeature=function(t){var e,i,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?i=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(e=this._data.properties)||void 0===e?void 0:e[this._key])===t&&(i=o(this._data)),i},h.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,O({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},h.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?r(n(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=r(n(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},h.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},h.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-line-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-line-layer")},h.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-line-layer")},h.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},h.prototype._onClick=function(e){var i=this._getEventFeature(e.point);if(i&&(this._isDefault(i)&&this._setHighlight(i.id,"click"),this._isBasic(i))){var o=this._getFeature(i.properties[this._key]),h=o?s(a(o)):void 0,l=O(O({},this._getData(i)),{originMapEvent:e});h&&(l.center=new t.LngLat(h[0],h[1])),o&&(l.lngLatBounds=new t.LngLatBounds(r(n(o)).bbox)),this.fire("click",O({},l))}},h.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},h.prototype._isBasic=function(t){return E(E([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},h.prototype._getData=function(t){return{data:O({},t.properties)}},h.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},h.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},h.prototype._onMouseMove=function(e){var i=this._getEventFeature(e.point);if(i&&this._isBasic(i)){var o=this._getFeature(i.properties[this._key]),r=o?s(a(o)):void 0,n=O(O({},this._getData(i)),{originMapEvent:e});r&&(n.center=new t.LngLat(r[0],r[1])),this._isMouseOver?this.fire("mousemove",n):(this.fire("mouseenter",n),this._isMouseOver=!0),this._addCursor(),this._setHighlight(i.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:e}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},h.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},h.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i([]),type:"geojson",promoteId:this._key,lineMetrics:this._lineMetrics};this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},h.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},h.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},h.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"],["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},h}(t.Evented),Xt=["none","click","hover","manual"],Qt=function(e){function h(t){var i=e.call(this)||this;return t=j(t),i._map=null,i._lngLatBounds=null,i._highlightFeatureId=null,i._source="advance-polygon-layer".concat(k()),i._key=t.key||"id",i._data=t.data,i._layerPool=t.layerPool||{},i._layers=t.layers||[],i._highlightTrigger=t.highlightTrigger&&Xt.includes(t.highlightTrigger)?t.highlightTrigger:"none",i._highlightLayers="none"===i._highlightTrigger?[]:t.highlightLayers||[],i._fitBoundsOptions=t.fitBoundsOptions||!1,i._isMouseOver=!1,i._setLngLatBounds(),V(["_onClick","_onMouseMove","_onData","_onMouseLeave"],i),i}return x(h,e),Object.defineProperty(h.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"layers",{get:function(){var t=this;return this._layers.map((function(e){return"".concat(t.source,"-").concat(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"highlightLayers",{get:function(){var t=this;return this._highlightLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-highlight")}))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lngLatBounds",{get:function(){return this._lngLatBounds},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._layers.includes(i)&&(e["".concat(t.source,"-").concat(i)]=t._layerPool[i]),t._highlightLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-highlight")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),h.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._fitBounds(),this},h.prototype.remove=function(){return this._map&&(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._handleEventListener("off"),this._removeSourceAnyLayer(),this._removeCursor(),this._map=null),this},h.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(t=t||"boolean"==typeof this._fitBoundsOptions?{}:this._fitBoundsOptions,null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,O({},t))),this},h.prototype.setData=function(t){(this._highlightFeatureId=null,this._lngLatBounds=null,this._isMouseOver=!1,this._data=t,this._setLngLatBounds(),this._map)&&(this._map.getSource(this.source).setData(t||i([])),this.removeHighlight(),this._fitBounds());return this},h.prototype.setHighlight=function(t){var e="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(t,e)},h.prototype.removeHighlight=function(){var t="hover"===this._highlightTrigger?"none":this._highlightTrigger;this._setHighlight(void 0,t)},h.prototype.easeTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=s(a(i));this._map.easeTo(O(O({},e),{center:[o[0],o[1]]}))}return this},h.prototype.flyTo=function(t,e){if(!this._map)return this;var i=this._getFeature(t);if(i){var o=s(a(i));this._map.flyTo(O(O({},e||{}),{center:[o[0],o[1]]}))}return this},h.prototype.fitTo=function(e,i){if(void 0===i&&(i={}),!this._map)return this;var o=this._getFeature(e);o&&this._map.fitBounds(new t.LngLatBounds(r(n(o)).bbox),i)},h.prototype.on=function(t,i){return e.prototype.on.call(this,t,i)},h.prototype.fire=function(t,i){return e.prototype.fire.call(this,t,i)},h.prototype.once=function(t,i){return e.prototype.once.call(this,t,i)},h.prototype.off=function(t,i){return e.prototype.off.call(this,t,i)},h.prototype._getFeature=function(t){var e,i,r=this;if(this._data&&"string"!=typeof this._data)return"FeatureCollection"===this._data.type?i=this._data.features.find((function(e){var i;return(null===(i=e.properties)||void 0===i?void 0:i[r._key])===t})):"Feature"===this._data.type&&(null===(e=this._data.properties)||void 0===e?void 0:e[this._key])===t&&(i=o(this._data)),i},h.prototype._fitBounds=function(){this._map&&this._fitBoundsOptions&&this._lngLatBounds&&this._map.fitBounds(this._lngLatBounds,O({},!0===this._fitBoundsOptions?{}:this._fitBoundsOptions))},h.prototype._setLngLatBounds=function(){this._data&&"string"!=typeof this._data?"FeatureCollection"===this._data.type?this._lngLatBounds=this._data.features.length>0?r(n(this._data)).bbox:null:"Feature"===this._data.type?this._lngLatBounds=r(n(this._data)).bbox:this._lngLatBounds=null:this._lngLatBounds=null},h.prototype._handleEventListener=function(t){this._map&&(this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMouseMove),this._map[t]("data",this._onData),"on"===t?this._map.getContainer().addEventListener("mouseleave",this._onMouseLeave):this._map.getContainer().removeEventListener("mouseleave",this._onMouseLeave))},h.prototype._onMouseLeave=function(){this._isMouseOver&&(this._isMouseOver=!1,this.fire("mouseleave"),this._setHighlight(void 0,"hover"),this._removeCursor())},h.prototype._onClick=function(e){var i=this._getEventFeature(e.point);if(i&&(this._isDefault(i)&&this._setHighlight(i.id,"click"),this._isBasic(i))){var o=this._getFeature(i.properties[this._key]),h=o?s(a(o)):void 0,l=O(O({},this._getData(i)),{originMapEvent:e});h&&(l.center=new t.LngLat(h[0],h[1])),o&&(l.lngLatBounds=new t.LngLatBounds(r(n(o)).bbox)),this.fire("click",O({},l))}},h.prototype._isDefault=function(t){return this.layers.includes(t.layer.id)},h.prototype._isBasic=function(t){return E(E([],this.layers,!0),this.highlightLayers,!0).includes(t.layer.id)},h.prototype._getData=function(t){return{data:O({},t.properties)}},h.prototype._setHighlight=function(t,e){var i=this;this._highlightTrigger===e&&"none"!==e&&this._map&&this._highlightFeatureId!==t&&(this._highlightFeatureId=t,this.layers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",i._getHighlightFilter(t)]])})),this.highlightLayers.forEach((function(e){var o,r,n=i.layerPool[e];null===(o=i._map)||void 0===o||o.setFilter(e,["all",i._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,i._getHighlightFilter(t)])})))},h.prototype._getEventFeature=function(t){var e;if(this._map){var i=this._map.queryRenderedFeatures(t,{layers:void 0});return(null===(e=i[0])||void 0===e?void 0:e.source)===this.source?i[0]:void 0}},h.prototype._onMouseMove=function(e){var i=this._getEventFeature(e.point);if(i&&this._isBasic(i)){var o=this._getFeature(i.properties[this._key]),r=o?s(a(o)):void 0,n=O(O({},this._getData(i)),{originMapEvent:e});r&&(n.center=new t.LngLat(r[0],r[1])),this._isMouseOver?this.fire("mousemove",n):(this.fire("mouseenter",n),this._isMouseOver=!0),this._addCursor(),this._setHighlight(i.id,"hover")}else this._isMouseOver&&(this.fire("mouseleave",{originMapEvent:e}),this._isMouseOver=!1,this._setHighlight(void 0,"hover"),this._removeCursor())},h.prototype._addCursor=function(){this._map&&!this._map.getContainer().classList.contains("mapbox-postting-advance-polygon-layer")&&this._map.getContainer().classList.add("mapbox-postting-advance-polygon-layer")},h.prototype._removeCursor=function(){this._map&&this._map.getContainer().classList.remove("mapbox-postting-advance-polygon-layer")},h.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},h.prototype._addSourceAnyLayer=function(){var t=this;if(this._map){if(!this._map.getSource(this.source)){var e={data:this._data||i([]),type:"geojson",promoteId:this._key};this._map.addSource(this.source,e)}this.layers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,["!",t._getHighlightFilter(t._highlightFeatureId)]]}))}})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(e){var i,o,r;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var n=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},n),{id:e,source:t.source,filter:["all",t._getGeometryFilter(),null===(r=n.filter)||void 0===r||r,t._getHighlightFilter(t._highlightFeatureId)]}))}}))}},h.prototype._getHighlightFilter=function(t){return"none"!==this._highlightTrigger&&(null!=t&&["==",["get",this._key],t])},h.prototype._removeSourceAnyLayer=function(){var t,e=this;this.layers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),"none"!==this._highlightTrigger&&this.highlightLayers.forEach((function(t){var i;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t))&&e._map.removeLayer(t)})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this.source))&&this._map.removeSource(this.source)},h.prototype._getGeometryFilter=function(){return["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},h}(t.Evented),te=[{id:"mapbox-postting-distance-measure-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-distance-measure-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-postting-distance-measure-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-distance-measure-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],ee=function(t){function i(e){var i,o=t.call(this)||this;return o._source="mapbox-postting-distance-measurer-source",o._map=null,o._enabled=!1,o._currentPath=[],o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||te,V(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return x(i,t),i.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this._render(),this},i.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-distance-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},i.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-postting-distance-measurer-cursor"))},i.prototype.disable=function(){0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-postting-distance-measurer-cursor"),this._render())},i.prototype.clear=function(){return this._cacheMap.forEach((function(t){t.data.forEach((function(t){t.marker.remove()}))})),this._cacheMap.clear(),0!==this._next&&(this._currentPath.forEach((function(t){return t.marker.remove()})),this._currentPath=[],this._next=0),this._map&&this._render(),this},i.prototype.getAllPath=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({pathId:i,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))})})),t},i.prototype.getPathById=function(t){var e=this._cacheMap.get(t);return e?{pathId:t,length:e.length,pathData:e.features.find((function(t){return"LineString"===t.geometry.type}))}:null},i.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},i.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},i.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},i.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},i.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},i.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},i.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},i.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._currentPath[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},i.prototype._finish=function(){var t=this;if(!(this._next<2)){this._next=0;var e=Date.now().toString(),i=ie(this._currentPath,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(i.data[i.data.length-1].marker,(function(){return t._remove(e)})),this._cacheMap.set(e,i),this._currentPath=[],setTimeout((function(){t.fire("complete",{pathId:e,length:i.length,pathData:i.features.find((function(t){return"LineString"===t.geometry.type}))})}),10)}},i.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.data.forEach((function(t){var e;null===(e=t.marker)||void 0===e||e.remove()})),this._cacheMap.delete(t),this.fire("delete",{pathId:t}),this._render()},i.prototype._add=function(t){this._update(t),this._next++},i.prototype._update=function(t){var i=this._currentPath.length>1?function(t){var i=e.length(e.lineString(t),{units:"kilometers"});if(i<1)return(1e3*i).toFixed(0)+"";return i.toFixed(1)+""}(E(E([],this._currentPath.map((function(t){return t.coordinates})),!0),[t],!1)):"";this._currentPath[this._next]?(this._currentPath[this._next].coordinates=t,this._currentPath[this._next].marker.getElement().innerText=i,this._currentPath[this._next].marker.setLngLat(t)):this._currentPath[this._next]={coordinates:t,marker:oe(t,i)}},i.prototype._render=function(){var t=this;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.features)}));var o=ie(this._currentPath,"true");i.push.apply(i,o.features),o.data.forEach((function(e){var i;null===(i=e.marker)||void 0===i||i.addTo(t._map)})),e.setData({type:"FeatureCollection",features:i})}},i.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(O(O({},e),{source:t._source}))})))},i.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},i}(t.Evented);function ie(t,i){var o=[],r=t.map((function(t){return t.coordinates})),n=function(t,i){try{return e.lineString(t,{active:i})}catch(t){return null}}(r,i),s=0;return n&&(o.push(n),s=e.length(n,{units:"kilometers"})),r.forEach((function(t){var r=e.point(t,{active:i});o.push(r)})),{data:E([],t,!0),features:o,length:s}}function oe(e,i){var o=document.createElement("div");o.classList.add("mapbox-postting-distance-measurer-marker");var r=new t.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(e),r.getElement().innerText=i,r}var re=[{id:"mapbox-postting-area-measurer-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.3}},{id:"mapbox-postting-area-measurer-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-area-measurer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}},{id:"mapbox-postting-area-measurer-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"rgb(255, 77, 79)","fill-opacity":.4}},{id:"mapbox-postting-area-measurer-line-active",type:"line",filter:["all",["==","active","true"],["==","$type","LineString"]],paint:{"line-color":"rgb(255, 77, 79)","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-area-measurer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"rgb(255, 77, 79)","circle-stroke-width":2}}],ne=function(t){function e(e){var i,o=t.call(this)||this;return o._source="mapbox-postting-area-measurer-source",o._map=null,o._enabled=!1,o._current={path:[],marker:null},o._cacheMap=new Map,o._next=0,o._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,o._layers=(null==e?void 0:e.layers)||re,V(["_OnDblClick","_onClick","_onMousemove","_onData"],o),o}return x(e,t),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-area-measurer-cursor")),this._map=null,this._enabled=!1,this.clear()},e.prototype.enable=function(){this._map&&(this._enabled=!0,this._map.getContainer().classList.add("mapbox-postting-area-measurer-cursor"))},e.prototype.disable=function(){var t;0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._enabled=!1,this._map&&(this._map.getContainer().classList.remove("mapbox-postting-area-measurer-cursor"),this._render())},e.prototype.clear=function(){var t;return this._cacheMap.forEach((function(t){t.marker.remove()})),this._cacheMap.clear(),0!==this._next&&(null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},this._next=0),this._map&&this._render(),this},e.prototype.getAllArea=function(){var t=[];return this._cacheMap.forEach((function(e,i){t.push({areaId:i,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})})),t},e.prototype.getAreaById=function(t){var e=this._cacheMap.get(t);return e?{areaId:t,acreage:e.acreage,areaData:e.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))}:null},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){this._enabled&&t.preventDefault()},e.prototype._onMousemove=function(t){this._enabled&&0!==this._next&&(this._update([t.lngLat.lng,t.lngLat.lat]),this._render())},e.prototype._onClick=function(t){this._enabled&&(0===this._next?(this._multiple||this.clear(),this._add([t.lngLat.lng,t.lngLat.lat])):this._current.path[this._next]?this._add([t.lngLat.lng,t.lngLat.lat]):this._finish(),this._render())},e.prototype._finish=function(){var t,e=this;if(!(this._next<3)){this._next=0;var i=Date.now().toString(),o=se(this._current.path,"false");!function(t,e){var i=t.getElement(),o=i.innerText;i.innerHTML="";var r=document.createElement("div"),n=document.createElement("span");n.innerText=o;var s=document.createElement("span");s.classList.add("remove-btn"),r.appendChild(n),r.appendChild(s),i.appendChild(r),s.addEventListener("click",(function(t){e&&e(),t.stopPropagation()}),!0)}(o.marker,(function(){return e._remove(i)})),o.marker.addTo(this._map),this._cacheMap.set(i,o),null===(t=this._current.marker)||void 0===t||t.remove(),this._current={path:[],marker:null},setTimeout((function(){e.fire("complete",{areaId:i,acreage:o.acreage,areaData:o.features.find((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}))})}),10)}},e.prototype._remove=function(t){var e;null===(e=this._cacheMap.get(t))||void 0===e||e.marker.remove(),this._cacheMap.delete(t),this.fire("delete",{areaId:t}),this._render()},e.prototype._add=function(t){this._update(t),this._next>=2&&!ae(E(E([],this._current.path,!0),[this._current.path[0]],!1),"true")||this._next++},e.prototype._update=function(t){this._current.path[this._next]=t},e.prototype._render=function(){var t,e;if(this._map){var i=this._map.getSource(this._source),o=[];this._cacheMap.forEach((function(t){o.push.apply(o,t.features)}));var r=se(this._current.path,"true");o.push.apply(o,r.features),null===(t=this._current.marker)||void 0===t||t.remove(),this._current.marker=r.marker,null===(e=this._current.marker)||void 0===e||e.addTo(this._map),i.setData({type:"FeatureCollection",features:o})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(O(O({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e}(t.Evented);function se(i,o){var r=[],n=null,s=function(t,i){try{return e.lineString(t,{active:i})}catch(t){return null}}(E(E([],i,!0),[i[0]],!1),o);s&&r.push(s);var a=ae(E(E([],i,!0),[i[0]],!1),o),h=0;a&&(r.push(a),n=function(e,i){var o=document.createElement("div");o.classList.add("mapbox-postting-area-measurer-marker");var r=new t.Marker({element:o,anchor:"bottom",offset:[0,-10]});return r.setLngLat(e),r.getElement().innerText=i,r}(e.center(a).geometry.coordinates,(h=e.area(a))>1e6?(h/1e6).toFixed(2)+"":h.toFixed(2)+""));return i.forEach((function(t){var i=e.point(t,{active:o});r.push(i)})),{data:E([],i,!0),features:r,marker:n,acreage:h}}function ae(t,i){try{var o=void 0,r=e.unkinkPolygon(e.polygon([t]));return(o=r.features.length>1?e.combine(r).features[0]:r.features[0]).properties={active:i},o}catch(t){return null}}var he=[{id:"mapbox-postting-draw-util-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-draw-util-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-point-active",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-draw-util-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-postting-draw-util-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-draw-util-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-draw-util-circle-center-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["==","type","circle-center"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],le=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return x(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(t.Evented);function ue(t,e){void 0===e&&(e={});try{return h(t,O({},e))}catch(t){return null}}var pe=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],e=l(this._path[0],{origin:"point"});return t.push(e),{feature:e,renderFeatures:t}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},e.prototype.onMouseMove=function(){return!1},e.prototype.onDblClick=function(){},e.prototype.clear=function(){this._path=[]},e}(le),ce=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],i=this._next-1;"false"===t&&(i=this._next);var o=ue(E([],this._path,!0),{active:t,origin:"line"});o&&e.push(o);for(var r=0;r<=i;r++)if(this._path[r]){var n=l(this._path[r],{active:t,type:"vertex",origin:"line"});e.push(n)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(le),_e=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],i=E([],this._path,!0),o=this._next-1;"false"===t&&(i=E(E([],this._path,!0),[this._path[0]],!1),o=this._next);var r=ue(i,{active:t,type:"border",origin:"polygon"});r&&e.push(r);var n=de(E(E([],this._path,!0),[this._path[0]],!1),t);n&&e.push(n);for(var s=0;s<=o;s++)if(this._path[s]){var a=l(this._path[s],{active:t,type:"vertex",origin:"polygon"});e.push(a)}return{feature:n,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!de(E(E([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||de(E(E([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(le);function de(t,e){try{var i=void 0,o=u(p([t]));return(i=o.features.length>1?c(o).features[0]:o.features[0]).properties={active:e,origin:"polygon"},i}catch(t){return null}}var ge,fe=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],i=null;if(2===this._path.length){var o=l(this._path[0]),r=_(o,l(this._path[1]));i=d(o,r,{steps:512,properties:{active:t,origin:"circle"}}),e.push(i);var n=h(i.geometry.coordinates[0],{active:t,type:"border",origin:"circle"});e.push(n)}if(this._path[0]){var s=l(this._path[0],{active:t,type:"circle-center",origin:"circle"});e.push(s)}return{feature:i,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(le),ye=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=null;if(2===this._path.length){delete(o=r(n(i([l(this._path[0]),l(this._path[1])])),{properties:{active:t,origin:"rect"}})).bbox,e.push(o);var s=h(o.geometry.coordinates[0],{active:t,type:"border",origin:"rect"});e.push(s),o.geometry.coordinates[0].forEach((function(i){var o=l(i,{active:t,type:"vertex",origin:"rect"});e.push(o)}))}else if(this._path[0]){var a=l(this._path[0],{active:t,type:"vertex",origin:"rect"});e.push(a)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(le),ve={NONE:"NONE",DRAW_POINT:"DRAW_POINT",DRAW_LINE:"DRAW_LINE",DRAW_POLYGON:"DRAW_POLYGON",DRAW_CIRCLE:"DRAW_CIRCLE",DRAW_RECT:"DRAW_RECT"},me=((ge={})[ve.DRAW_POINT]=pe,ge[ve.DRAW_LINE]=ce,ge[ve.DRAW_POLYGON]=_e,ge[ve.DRAW_CIRCLE]=fe,ge[ve.DRAW_RECT]=ye,ge),Le=function(t){function e(e){var i,o,r,n,s,a=t.call(this)||this;return a._map=null,a._source="mapbox-postting-draw-util-source-".concat(k(8)),a._currentModeType=ve.NONE,a._currentMode=null,a._cacheMap=new Map,a._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,a._layers=(null==e?void 0:e.layers)||he,a._onClick=(o=a,r=a._onClick,n=250,s=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s||(r.call.apply(r,E([o],t,!1)),s=setTimeout((function(){s=void 0}),n))}),V(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],a),a}return x(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-draw-util-cursor")),this._currentModeType=ve.NONE,this._currentMode=null,this._map=null,this.clear()},e.prototype.changeMode=function(t){var e,i,r,n=this;if(this._currentModeType!==t)return null===(e=this._currentMode)||void 0===e||e.clear(),this._currentModeType=t,t===ve.NONE?(this._currentMode=null,null===(i=this._map)||void 0===i||i.getContainer().classList.remove("mapbox-postting-draw-util-cursor")):(this._currentMode=new me[t],null===(r=this._map)||void 0===r||r.getContainer().classList.add("mapbox-postting-draw-util-cursor"),this._currentMode.on("finished",(function(t){var e=k(8),i=o(t.data.feature);i.properties={},n._cacheMap.set(e,{renderFeatures:t.data.renderFeatures,feature:i}),setTimeout((function(){n._render()})),setTimeout((function(){n.fire("add",{data:{id:e,feature:o(i)}})}))}))),this._render(),this},e.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},e.prototype.add=function(t,e){void 0===e&&(e=!1);var i=Date.now().toString();if("Polygon"===t.geometry.type){var r=function(t,e,i){void 0===i&&(i=!1);var r=t.geometry,n=[],s=ue(r.coordinates[0],{active:e,type:"border",origin:i?"circle":"polygon"});s&&n.push(s);var a=o(t);if(a.properties={active:e,origin:i?"circle":"polygon"},n.push(a),!i){var h=g(r.coordinates[0]);f(h).geometry.coordinates.forEach((function(t){var i=l(t,{active:e,type:"vertex",origin:"polygon"});n.push(i)}))}return{renderFeatures:n,feature:o(t)}}(t,"false",e);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(i,r)}else if("MultiPolygon"===t.geometry.type){r=function(t,e){var i=t.geometry,r=[];i.coordinates.forEach((function(t){var i=ue(t[0],{active:e,type:"border",origin:"polygon"});i&&r.push(i)}));var n=o(t);n.properties={active:e,origin:"polygon"},r.push(n);var s=[];i.coordinates.forEach((function(t){s.push.apply(s,t[0])}));var a=g(s);return f(a).geometry.coordinates.forEach((function(t){var i=l(t,{active:e,type:"vertex",origin:"polygon"});r.push(i)})),{feature:o(t),renderFeatures:r}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(i,r)}else if("LineString"===t.geometry.type){r=function(t,e){var i=[],r=o(t);return r.properties={active:e,origin:"line"},i.push(r),t.geometry.coordinates.forEach((function(t){var o=l(t,{active:e,type:"vertex",origin:"line"});i.push(o)})),{renderFeatures:i,feature:o(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(i,r)}else if("MultiLineString"===t.geometry.type){r=function(t,e){var i=[],r=o(t);return r.properties={active:e,origin:"line"},i.push(r),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var o=l(t,{active:e,type:"vertex",origin:"line"});i.push(o)}))})),{renderFeatures:i,feature:o(t)}}(t,"false");!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(i,r)}else{if("Point"!==t.geometry.type&&"MultiPoint"!==t.geometry.type)return null;r=function(t){var e=[],i=o(t);return i.properties={origin:"point"},e.push(i),{renderFeatures:e,feature:o(t)}}(t);!this._multiple&&this._cacheMap.clear(),this._cacheMap.set(i,r)}return this._map&&this._render(),i},e.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},e.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){return{id:t[0],feature:t[1].feature}}))},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},e.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},e.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},e.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,t.renderFeatures)}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(O(O({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e.MODE_TYPE=ve,e}(t.Evented);var be=function(t){function e(e){var i=t.call(this)||this;return e=j(e),i._renderData=[],i._data=e.data||[],i._fullPathData=null,i._splittedPathData=[],i._useTimeStamp=!1,i._layerPool=e.layerPool||{},i._currentPathLayers=e.currentPathLayers||[],i._fullPathLayers=e.fullPathLayers||[],i._carLayers=e.carLayers||[],i._nodeLayers=e.nodeLayers||[],i._trackTimeStamp=0,i._realTimeStamp=0,i._animationFrame=0,i._state=0,i._speed=e.speed||1,i._map=null,i._finished=!1,i._loop=e.loop||!1,i._source="mapbox-postting-car-track-".concat(k(8)),i._fitBoundsOptions=i._getFitBoundsOptions(e.fitBoundsOptions),i._lngLatBounds=null,i._calcFullPath(),i._calcSplittedPath(),V(["_animate","_onData"],i),i}return x(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPathLayers",{get:function(){var t=this;return this._currentPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-current-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPathLayers",{get:function(){var t=this;return this._fullPathLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-full-path")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"carLayers",{get:function(){var t=this;return this._carLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-car")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeLayers",{get:function(){var t=this;return this._nodeLayers.map((function(e){return"".concat(t.source,"-").concat(e,"-node")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerPool",{get:function(){var t=this,e={};return Object.keys(this._layerPool).forEach((function(i){t._currentPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-current-path")]=t._layerPool[i]),t._fullPathLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-full-path")]=t._layerPool[i]),t._carLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-car")]=t._layerPool[i]),t._nodeLayers.includes(i)&&(e["".concat(t.source,"-").concat(i,"-node")]=t._layerPool[i])})),e},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){return this._map===t||(this.remove(),this._map=t,this._addSourceAnyLayer(),this._map.on("data",this._onData),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions)),this},e.prototype.fitBounds=function(t){var e;return this._lngLatBounds&&(null===(e=this._map)||void 0===e||e.fitBounds(this._lngLatBounds,t||this._fitBoundsOptions||{})),this},e.prototype.remove=function(){var t;return null===(t=this._map)||void 0===t||t.off("data",this._onData),this.stop(),this._removeSourceAndLayer(),this._map=null,this._renderData=[],this},e.prototype.play=function(){return this._map&&this._fullPathData?(1===this._state||(this._state=1,this._realTimeStamp=Date.now(),this._finished&&(this._finished=!1,this._init()),this._animationFrame=requestAnimationFrame(this._animate)),this):this},e.prototype.pause=function(){return this._map?(1!==this._state||(cancelAnimationFrame(this._animationFrame),this._state=2),this):this},e.prototype.stop=function(){return this._map?(cancelAnimationFrame(this._animationFrame),this._state=0,this._animationFrame=0,this._trackTimeStamp=0,this._realTimeStamp=0,this._finished=!1,this._init(),this):this},e.prototype.setSpeed=function(t){return this._speed=t,this},e.prototype.setTimestamp=function(t){return this._map&&this._useTimeStamp?(this.pause(),this._init(t),this._firePlayingEvent(),this):this},e.prototype.setData=function(t){return this.stop(),this._data=t||[],this._calcFullPath(),this._calcSplittedPath(),this._init(),this._fitBoundsOptions&&this.fitBounds(this._fitBoundsOptions),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.once=function(e,i){return t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._getFitBoundsOptions=function(t){return t?!0===t?{}:t:void 0},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:this._renderData},lineMetrics:!0}),this.fullPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","full-path"]]}))}})),this.currentPathLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},r),{id:e,source:t._source,filter:["all",["==","$type","LineString"],["==","type","current-path"]]}))}})),this.nodeLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","node"]]}))}})),this.carLayers.forEach((function(e){var i,o;if(!(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))){var r=t.layerPool[e];null===(o=t._map)||void 0===o||o.addLayer(O(O({},r),{id:e,source:t._source,filter:["all",["==","$type","Point"],["==","type","car"]]}))}})))},e.prototype._removeSourceAndLayer=function(){var t=this;this._map&&(this.fullPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.currentPathLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.carLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this.nodeLayers.forEach((function(e){var i;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e))&&t._map.removeLayer(e)})),this._map.getSource(this._source)&&this._map.removeSource(this._source))},e.prototype._calcSplittedPath=function(){var t=this;this._splittedPathData=[],this._fullPathData&&this._data.reduce((function(e,i,o){var r,n,s,a=l(e.coordinates),h=l(i.coordinates),u=y(a,h,{units:"meters"}),p=O({},i);(1===o&&(t._useTimeStamp=!!e.timestamp),t._useTimeStamp)?(r=u/(i.timestamp-e.timestamp),n=e.timestamp,s=i.timestamp):(r=.001,s=(n=1===o?0:e.timestamp)+Math.floor(u/r),p.timestamp=s);return t._splittedPathData.push({speed:r,length:u,startTime:n,endTime:s,start:E([],e.coordinates,!0),end:E([],i.coordinates,!0),bearing:v(a,h)}),p}))},e.prototype._calcFullPath=function(){this._data.length>1?(this._fullPathData=h(this._data.map((function(t){return t.coordinates})),{type:"full-path"}),this._lngLatBounds=r(n(this._fullPathData)).bbox):(this._fullPathData=null,this._lngLatBounds=null)},e.prototype._search=function(t){if(t>=this._splittedPathData[this._splittedPathData.length-1].endTime)return this._splittedPathData.length-1;if(t<=this._splittedPathData[0].startTime)return 0;for(var e=0,i=this._splittedPathData.length-1;e<=i;){var o=Math.floor((i-e)/2)+e,r=this._splittedPathData[o];if(r.startTime<=t&&r.endTime>t)return o;r.startTime>t?i=o-1:e=o+1}return-1},e.prototype._getNodeData=function(t){var e=this;return this._data.map((function(i,o){return l(i.coordinates,{type:"node",nodeType:0===o?"start":o===e._data.length-1?"end":"common",nodeState:o>t?0:1})}))},e.prototype._init=function(t){var e;if(this._map){if(this._fullPathData)if(t)this._trackTimeStamp=t,this._renderData=this._getRenderData();else{this._renderData=E([this._fullPathData],this._getNodeData(0),!0);var i=this._splittedPathData[0],o=i.start,r=i.bearing,n=i.startTime;this._trackTimeStamp=n,this._renderData.push(l(o,{bearing:r,type:"car"}))}else this._renderData=[];var s=null===(e=this._map)||void 0===e?void 0:e.getSource(this._source);null==s||s.setData({type:"FeatureCollection",features:this._renderData})}},e.prototype._animate=function(){if(this._map&&0!==this._state&&2!==this._state){if(this._finished)return this._state=0,this.fire("complete"),void(this._loop&&this.play());var t=Date.now(),e=t-this._realTimeStamp;this._realTimeStamp=t,this._trackTimeStamp+=e*this._speed;var i=this._map.getSource(this._source);this._renderData=this._getRenderData(),null==i||i.setData({type:"FeatureCollection",features:this._renderData}),this._useTimeStamp&&this._firePlayingEvent(),1===this._state&&(this._animationFrame=requestAnimationFrame(this._animate))}},e.prototype._firePlayingEvent=function(){this.fire("moving",{timestamp:this._trackTimeStamp})},e.prototype._getRenderData=function(){var t,e=[this._fullPathData],i=this._search(this._trackTimeStamp),o=this._splittedPathData[i],r=o.start,n=o.end,s=o.startTime,a=o.endTime,u=o.speed,p=o.length,c=o.bearing,_=this._splittedPathData.slice(0,i+1),d=(this._trackTimeStamp-s)*u;this._finished=!1,d>=p?(t=l(n),this._trackTimeStamp=a,this._finished=i===this._splittedPathData.length-1,e.push.apply(e,this._getNodeData(i+1))):(t=m(h([r,n]),d,{units:"meters"}),e.push.apply(e,this._getNodeData(i))),t.properties={bearing:c,type:"car"},e.push(t);var g=h(E(E([],_.map((function(t){return t.start})),!0),[t.geometry.coordinates],!1),{type:"current-path"});return e.push(g),e},e}(t.Evented),ke=[{id:"mapbox-postting-advance-buffer-fill",type:"fill",filter:["all",["==","$type","Polygon"],["==","origin","buffer"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-advance-buffer-border",type:"line",filter:["all",["==","$type","LineString"],["==","origin","buffer"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","origin","polygon"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.3}},{id:"mapbox-postting-advance-buffer-polygon-border-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-vertex-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-advance-buffer-point",type:"circle",filter:["all",["==","origin","point"],["==","$type","Point"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}},{id:"mapbox-postting-advance-buffer-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#44cef6","fill-opacity":.4}},{id:"mapbox-postting-advance-buffer-polygon-border-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","type","border"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"],["==","origin","line"]],paint:{"line-color":"#44cef6","line-opacity":.8,"line-width":2}},{id:"mapbox-postting-advance-buffer-vertex-active",type:"circle",filter:["all",["==","active","true"],["==","$type","Point"],["==","type","vertex"]],paint:{"circle-color":"#fff","circle-radius":3,"circle-stroke-color":"#44cef6","circle-stroke-width":2}}],Me=function(t){function e(){var e=t.call(this)||this;return e._next=0,e._path=[],e}return x(e,t),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),e}(t.Evented);function xe(t,e){void 0===e&&(e={});try{return h(t,O({},e))}catch(t){return null}}var Pe=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(){if(!this._path.length)return{feature:null,renderFeatures:[]};var t=[],e=l(this._path[0],{origin:"point"});return t.push(e),{feature:e,renderFeatures:t}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this.fire("finished",{data:this.getFeatures()}),this._next=0,this._path=[],!1},e.prototype.onMouseMove=function(){return!1},e.prototype.onDblClick=function(){},e.prototype.clear=function(){this._path=[]},e}(Me),Oe=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],i=this._next-1;"false"===t&&(i=this._next);var o=xe(E([],this._path,!0),{active:t,origin:"line"});o&&e.push(o);for(var r=0;r<=i;r++)if(this._path[r]){var n=l(this._path[r],{active:t,type:"vertex",origin:"line"});e.push(n)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<2||(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Me),Ee=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],i=E([],this._path,!0),o=this._next-1;"false"===t&&(i=E(E([],this._path,!0),[this._path[0]],!1),o=this._next);var r=xe(i,{active:t,type:"border",origin:"polygon"});r&&e.push(r);var n=Se(E(E([],this._path,!0),[this._path[0]],!1),t);n&&e.push(n);for(var s=0;s<=o;s++)if(this._path[s]){var a=l(this._path[s],{active:t,type:"vertex",origin:"polygon"});e.push(a)}return{feature:n,renderFeatures:e}},e.prototype.onClick=function(t){return!(0!==this._next&&!this._path[this._next])&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!(this._next>=2&&!Se(E(E([],this._path,!0),[this._path[0]],!1),"true"))&&(this._next++,!0))},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault(),this._next<3||Se(E(E([],this._path,!0),[this._path[0]],!1),"false")&&(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[])},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Me);function Se(t,e){try{var i=void 0,o=u(p([t]));return(i=o.features.length>1?c(o).features[0]:o.features[0]).properties={active:e,origin:"polygon"},i}catch(t){return null}}var Ce,Be=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.getFeatures=function(t){if(void 0===t&&(t="true"),!this._path.length)return{feature:null,renderFeatures:[]};var e=[],o=null;if(2===this._path.length){delete(o=r(n(i([l(this._path[0]),l(this._path[1])])),{properties:{active:t,origin:"polygon"}})).bbox,e.push(o);var s=h(o.geometry.coordinates[0],{active:t,type:"border",origin:"polygon"});e.push(s),o.geometry.coordinates[0].forEach((function(i){var o=l(i,{active:t,type:"vertex",origin:"polygon"});e.push(o)}))}else if(this._path[0]){var a=l(this._path[0],{active:t,type:"vertex",origin:"polygon"});e.push(a)}return{feature:o,renderFeatures:e}},e.prototype.onClick=function(t){return this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],1===this._next?(this.fire("finished",{data:this.getFeatures("false")}),this._next=0,this._path=[],!1):(this._next++,!0)},e.prototype.onMouseMove=function(t){return 0!==this._next&&(this._path[this._next]=[t.lngLat.lng,t.lngLat.lat],!0)},e.prototype.onDblClick=function(t){t.preventDefault()},e.prototype.clear=function(){0!==this._next&&(this._path=[],this._next=0)},e}(Me),Fe={NONE:"NONE",POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON",RECT:"RECT"},De=((Ce={})[Fe.POINT]=Pe,Ce[Fe.LINE]=Oe,Ce[Fe.POLYGON]=Ee,Ce[Fe.RECT]=Be,Ce),Te=["meters","kilometers"],He=function(t){function e(e){var i,o,r,n,s,a=t.call(this)||this;return a._map=null,a._source="mapbox-postting-advance-buffer-source-".concat(k(8)),a._currentModeType=Fe.NONE,a._currentMode=null,a._radius=(null==e?void 0:e.radius)&&e.radius>0?e.radius:1,a._units=(null==e?void 0:e.units)&&Te.includes(e.units)?e.units:"kilometers",a._steps=(null==e?void 0:e.steps)&&e.steps>0?e.steps:16,a._cacheMap=new Map,a._multiple=null!==(i=null==e?void 0:e.multiple)&&void 0!==i&&i,a._layers=(null==e?void 0:e.layers)||ke,a._onClick=(o=a,r=a._onClick,n=250,s=void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s||(r.call.apply(r,E([o],t,!1)),s=setTimeout((function(){s=void 0}),n))}),V(["_OnDblClick","_onClick","_onMousemove","_onData","_onMousedown","_onMouseup"],a),a}return x(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modeType",{get:function(){return this._currentModeType},enumerable:!1,configurable:!0}),e.prototype.addTo=function(t){if(this._map!==t)return this.remove(),this._map=t,this._addSourceAnyLayer(),this._handleEventListener("on"),this},e.prototype.remove=function(){return this._map&&(this._handleEventListener("off"),this._removeSourceAndLayer(),this._map.getContainer().classList.remove("mapbox-postting-advance-buffer-cursor")),this._currentModeType=Fe.NONE,this._currentMode=null,this._map=null,this.clear()},e.prototype.changeMode=function(t){var e,i,r,n=this;if(this._currentModeType!==t)return null===(e=this._currentMode)||void 0===e||e.clear(),this._currentModeType=t,t===Fe.NONE?(this._currentMode=null,null===(i=this._map)||void 0===i||i.getContainer().classList.remove("mapbox-postting-advance-buffer-cursor")):(this._currentMode=new De[t],null===(r=this._map)||void 0===r||r.getContainer().classList.add("mapbox-postting-advance-buffer-cursor"),this._currentMode.on("finished",(function(t){var e=k(8),i=o(t.data.feature);i.properties={};var r=we(i,n._radius,n._steps,n._units),s=r.renderFeatures,a=r.bufferFeature;n._cacheMap.set(e,{bufferRenderFeatures:s,baseRenderFeatures:t.data.renderFeatures,bufferFeature:a,feature:i}),setTimeout((function(){n._render()})),setTimeout((function(){n.fire("add",{data:{id:e,feature:o(i),bufferFeature:o(a)}})}))}))),this._render(),this},e.prototype.clear=function(){var t;return this._cacheMap.clear(),null===(t=this._currentMode)||void 0===t||t.clear(),this._render(),this},e.prototype.add=function(t){var e=this,i=k(8),r=we(t,this._radius,this._steps,this._units),n=r.renderFeatures,s=r.bufferFeature;return this._multiple||this._cacheMap.clear(),this._cacheMap.set(i,{bufferRenderFeatures:n,baseRenderFeatures:je(t),bufferFeature:s,feature:t}),this._map&&setTimeout((function(){e._render()})),{id:i,feature:o(t),bufferFeature:o(s)}},e.prototype.deleteById=function(t){return this._cacheMap.delete(t),this._render(),this},e.prototype.getAll=function(){return Array.from(this._cacheMap).map((function(t){var e=t[0],i=t[1];return{id:e,feature:i.feature,bufferFeature:i.bufferFeature}}))},e.prototype.setBufferOptions=function(t){var e=this;return t.radius&&(this._radius=t.radius),t.units&&Te.includes(t.units)&&(this._units=t.units),t.steps&&t.steps>0&&(this._steps=t.steps),this._cacheMap.forEach((function(t){var i=we(t.feature,e._radius,e._steps,e._units),o=i.renderFeatures,r=i.bufferFeature;t.bufferRenderFeatures=o,t.bufferFeature=r})),this._render(),this},e.prototype.on=function(e,i){return t.prototype.on.call(this,e,i)},e.prototype.fire=function(e,i){return t.prototype.fire.call(this,e,i)},e.prototype.off=function(e,i){return t.prototype.off.call(this,e,i)},e.prototype._handleEventListener=function(t){this._map&&(this._map[t]("dblclick",this._OnDblClick),this._map[t]("click",this._onClick),this._map[t]("mousemove",this._onMousemove),this._map[t]("data",this._onData))},e.prototype._onData=function(t){var e=this;"style"===t.dataType&&setTimeout((function(){e._addSourceAnyLayer()}),10)},e.prototype._OnDblClick=function(t){var e;null===(e=this._currentMode)||void 0===e||e.onDblClick(t)},e.prototype._onMousemove=function(t){var e;(null===(e=this._currentMode)||void 0===e?void 0:e.onMouseMove(t))&&this._render()},e.prototype._onClick=function(t){var e,i;0!==(null===(e=this._currentMode)||void 0===e?void 0:e.next)||this._multiple||this.clear(),(null===(i=this._currentMode)||void 0===i?void 0:i.onClick(t))&&this._render()},e.prototype._render=function(){var t;if(this._map){var e=this._map.getSource(this._source),i=[];this._cacheMap.forEach((function(t){i.push.apply(i,E(E([],t.baseRenderFeatures,!1),t.bufferRenderFeatures,!1))}));var o=null===(t=this._currentMode)||void 0===t?void 0:t.getFeatures();(null==o?void 0:o.renderFeatures)&&i.push.apply(i,o.renderFeatures),e.setData({type:"FeatureCollection",features:i})}},e.prototype._addSourceAnyLayer=function(){var t=this;this._map&&(this._map.getSource(this._source)||(this._map.addSource(this._source,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this._render()),this._layers.forEach((function(e){var i,o;(null===(i=t._map)||void 0===i?void 0:i.getLayer(e.id))||null===(o=t._map)||void 0===o||o.addLayer(O(O({},e),{source:t._source}))})))},e.prototype._removeSourceAndLayer=function(){var t,e=this;this._layers.forEach((function(t){var i,o;(null===(i=e._map)||void 0===i?void 0:i.getLayer(t.id))&&(null===(o=e._map)||void 0===o||o.removeLayer(t.id))})),(null===(t=this._map)||void 0===t?void 0:t.getSource(this._source))&&this._map.removeSource(this._source)},e.MODE_TYPE=Fe,e}(t.Evented);function we(t,e,i,r){var n=[],s=f(L(t,e,{units:r,steps:i})),a=o(s);a.properties={origin:"buffer"};var h=b(a);return"FeatureCollection"===h.type?h.features.forEach((function(t){t.properties={origin:"buffer"},n.push(t)})):(h.properties={origin:"buffer"},n.push(h)),n.push(a),{renderFeatures:n,bufferFeature:s}}function je(t){return"Point"===t.geometry.type||"MultiPoint"===t.geometry.type?function(t){var e=o(t);return e.properties={origin:"point"},[e]}(t):"LineString"===t.geometry.type?function(t){var e=[],i=o(t);return i.properties={active:"false",origin:"line"},e.push(i),t.geometry.coordinates.forEach((function(t){var i=l(t,{active:"false",type:"vertex",origin:"line"});e.push(i)})),e}(t):"MultiLineString"===t.geometry.type?function(t){var e=[],i=o(t);return i.properties={active:"false",origin:"line"},e.push(i),t.geometry.coordinates.forEach((function(t){t.forEach((function(t){var i=l(t,{active:"false",type:"vertex",origin:"line"});e.push(i)}))})),e}(t):"Polygon"===t.geometry.type?function(t){var e=[],i=o(t);i.properties={active:"false",origin:"polygon"},e.push(i);var r=xe(t.geometry.coordinates[0],{active:"false",type:"border",origin:"polygon"});r&&e.push(r);var n=g(t.geometry.coordinates[0]);return f(n).geometry.coordinates.forEach((function(t){var i=l(t,{active:"false",type:"vertex",origin:"polygon"});e.push(i)})),e}(t):"MultiPolygon"===t.geometry.type?function(t){var e=[],i=o(t);i.properties={active:"false",origin:"polygon"},e.push(i),t.geometry.coordinates.forEach((function(t){var i=xe(t[0],{active:"false",type:"border",origin:"polygon"});i&&e.push(i)}));var r=[];t.geometry.coordinates.forEach((function(t){r.push.apply(r,t[0])}));var n=g(r);return f(n).geometry.coordinates.forEach((function(t){var i=l(t,{active:"false",type:"vertex",origin:"polygon"});e.push(i)})),e}(t):[]}export{He as AdvanceBuffer,be as AdvanceCarTrack,Jt as AdvanceLineLayer,Ut as AdvancePointLayer,Qt as AdvancePolygonLayer,z as AnyLayer,ne as AreaMeasurer,Ft as BufferLayer,Nt as CarTrack,Pt as CircleAreaPicker,Tt as CircleClusterLayer,X as CirclePointLayer,ee as DistanceMeasurer,Le as DrawUtil,ut as HeatmapLayer,rt as LineLayer,dt as LinePicker,Gt as MapComparer,it as MarkerPointLayer,pt as PointPicker,vt as PolygonAreaPicker,lt as PolygonLayer,Zt as PrismoidLayer,kt as RectAreaPicker,jt as SymbolClusterLayer,et as SymbolPointLayer};
//# sourceMappingURL=mapbox-postting.esm.js.map
